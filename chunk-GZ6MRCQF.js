import{$a as P,Bb as Z,D as Q,Ha as F,I as L,Ia as q,Ja as t,Ka as H,La as x,Ma as B,Pa as Y,Qa as g,Va as p,Ya as U,_a as j,ab as M,bb as _,c as E,cb as G,fb as V,j as N,k as K,m as v,xa as z,xb as J,yb as W,zb as X}from"./chunk-A6I4HBFG.js";import{g as h,h as k}from"./chunk-ENRHZQ2S.js";function f(o,e="YYYY-MM-DD HH:mm:ss"){let n={YYYY:o.getFullYear().toString(),MM:String(o.getMonth()+1).padStart(2,"0"),DD:String(o.getDate()).padStart(2,"0"),HH:String(o.getHours()).padStart(2,"0"),mm:String(o.getMinutes()).padStart(2,"0"),ss:String(o.getSeconds()).padStart(2,"0")};return e.replace(/YYYY|MM|DD|HH|mm|ss/g,r=>n[r])}var c=class o extends Date{static afterYear(e){return new o(Date.now()+e*365*24*60*60*1e3)}toString(){return f(this)}date(e){return U(e)?this.format("YYYY-MM-DD"):e===!0?this.format("YYYY-MM-DD 00:00:00"):this.format("YYYY-MM-DD 23:59:59")}time(){return this.format("HH:mm:ss")}format(e="YYYY-MM-DD"){return f(this,e)}};var ne=(r=>(r[r.Active=1]="Active",r[r.Lock=2]="Lock",r[r.Delete=3]="Delete",r))(ne||{}),A=(s=>(s[s.Mobile=1]="Mobile",s[s.Card=2]="Card",s[s.Token=3]="Token",s[s.Console=4]="Console",s))(A||{}),ie={1:"Mobile",2:"Card",3:"Token",4:"Console"};var se={customerId:"custom_id",serialNumber:"serial_num",bankCode:"bank_code",bankName:"bank_name",branchName:"branch_name",branchCode:"branch_code",mobile:"mobile",customerName:"custom_name",email:"email",registeredBank:"regist_bank",registeredBankName:"regist_bankname",registeredDate:"resgist_date",lastUseDate:"lastuse_date",status:"status",otpType:"otptype"},C=class extends q{customerId="";bankCode="";bankName="";mobile="";customerName="";email="";registeredBank="";registeredBankName="";branchName="";branchCode="";registeredDate=new c;lastUseDate=new c;status=1;otpType=1;serialNumber="";key;constructor(){super(),this._mapper=new P(se)}getPrimaryKeyName(){return"customerId"}getSoftDelete(){return{status:H(3)}}setRegisteredDate(e){return this.registeredDate=new c(e),this.registeredDate}setLastUseDate(e){return this.lastUseDate=new c(e),this.lastUseDate}getRegisteredDate(){return f(this.registeredDate)}getLastUseDate(){return f(this.lastUseDate)}setOtpType(e){this.otpType=Number(e)}getOtpTypeLabel(){return ie[this.otpType]||"Unknown"}};h([_("custom_id")],C.prototype,"customerId",2),h([G()],C.prototype,"key",2),C=h([M("cifmst")],C);var $=(a=>(a[a.Created=0]="Created",a[a.Registered=1]="Registered",a[a.Enrolled=2]="Enrolled",a[a.Active=3]="Active",a[a.Revoked=4]="Revoked",a[a.Unknown=-1]="Unknown",a))($||{}),ae={otpType:"otptype",bankCode:"bank_cd",branchCode:"branch_cd",sequenceNumber:"seqno",otpKey:"otp_key",createdDate:"create_date",status:"status",manufacturingDispatchDate:"out_date",productDeliveryDate:"in_date",keyAssignedDate:"register_date"},b=class extends q{otpType=2;bankCode="";branchCode="";sequenceNumber=0;otpKey="";createdDate=new c;status=0;manufacturingDispatchDate;productDeliveryDate;keyAssignedDate;constructor(){super(),this._mapper=new P(ae)}getSoftDelete(){}getPrimaryKeyName(){return"sequenceNumber"}setManufacturingDispatchDate(e){if(!e||e&&e.trim()===""){this.manufacturingDispatchDate=void 0;return}this.manufacturingDispatchDate=new c(e)}setProductDeliveryDate(e){if(!e||e&&e.trim()===""){this.productDeliveryDate=void 0;return}this.productDeliveryDate=new c(e)}setKeyAssignedDate(e){if(!e||e&&e.trim()===""){this.keyAssignedDate=void 0;return}this.keyAssignedDate=new c(e)}setCreatedDate(e){this.createdDate=new c(e)}setStatus(e){this.status=Number(e)}setOtpType(e){this.otpType=Number(e)}setSequenceNumber(e){this.sequenceNumber=Number(e)}};h([_("seqno")],b.prototype,"sequenceNumber",2),b=h([M("keymst")],b);var I=class o extends j{constructor(e){super(e,b)}getName(){return"serialkey"}generateKey(e){return this.http.post(this.url(),e,{headers:{service:"OTPSVR"}}).then(n=>{if(n?.result.toLocaleLowerCase()==="error")throw console.error(n),n})}getStats(e,n){return k(this,null,function*(){let r=this.getQueryBuilder();r.aggregate({count:"sequenceNumber"}).where("otpType",t(2)).where("bankCode",t(e)).where("branchCode",t(n));let s=yield this.http.post(this.url(),p(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(2)).where("bankCode",t(e)).where("branchCode",t(n)).where("manufacturingDispatchDate",Y()).where("status",t(0));let u=yield this.http.post(this.url(),p(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(2)).where("bankCode",t(e)).where("branchCode",t(n)).where("manufacturingDispatchDate",g()).where("status",t(1));let a=yield this.http.post(this.url(),p(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(2)).where("bankCode",t(e)).where("branchCode",t(n)).where("productDeliveryDate",g()).where("status",t(2));let m=yield this.http.post(this.url(),p(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(2)).where("bankCode",t(e)).where("branchCode",t(n)).where("keyAssignedDate",g()).where("status",t(3));let l=yield this.http.post(this.url(),p(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(2)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(4));let w=yield this.http.post(this.url(),p(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(3)).where("bankCode",t(e)).where("branchCode",t(n));let D=yield this.http.post(this.url(),p(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(3)).where("bankCode",t(e)).where("branchCode",t(n)).where("manufacturingDispatchDate",Y()).where("status",t(0));let y=yield this.http.post(this.url(),p(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(3)).where("bankCode",t(e)).where("branchCode",t(n)).where("manufacturingDispatchDate",g()).where("status",t(1)),r=this.getQueryBuilder();let T=yield this.http.post(this.url(),p(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(3)).where("bankCode",t(e)).where("branchCode",t(n)).where("productDeliveryDate",g()).where("status",t(2));let d=yield this.http.post(this.url(),p(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(3)).where("bankCode",t(e)).where("branchCode",t(n)).where("keyAssignedDate",g()).where("status",t(3));let S=yield this.http.post(this.url(),p(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(3)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(4));let re=yield this.http.post(this.url(),p(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);return{totalCardCount:s||0,rawCardCount:u||0,registeredCardCount:a||0,enrolledCardCount:m||0,activeCardCount:l||0,inactiveCardCount:w||0,totalTokenCount:D||0,rawTokenCount:y||0,registeredTokenCount:T||0,enrolledTokenCount:d||0,activeTokenCount:S||0,inactiveTokenCount:re||0}})}getCount(e){let r=this.processQueryParams(this.getQueryBuilder(),e).aggregate({count:"sequenceNumber"}).buildParameterized();return this.http.post(this.url(),p(r)).then(s=>Number(s[0].count_sequenceNumber)||0)}getLastMaxCount(e,n,r){let u=this.getQueryBuilder().aggregate({max:"sequenceNumber"}).where("bankCode",t(e)).where("branchCode",t(n)).where("otpType",t(r)).select().buildParameterized();return this.http.post(this.url(),p(u)).then(a=>Number(a[0].max_sequenceNumber)||0)}getAssignableKeys(e,n,r,s){let u=[{status:t(2)},{bankCode:t(e)},{branchCode:t(n)}];return r&&u.push({otpType:t(r)}),s&&u.push({sequenceNumber:t(s)}),this.get(u).then(a=>a.sort((m,l)=>m.sequenceNumber-l.sequenceNumber))}getFreshKeys(e,n){return this.get([{status:t(2)},{bankCode:t(e)},{branchCode:t(n)}]).then(r=>r.sort((s,u)=>s.sequenceNumber-u.sequenceNumber))}getAssignedKeys(e,n,r){return r||(r=[]),this.get([{status:t(3),bankCode:t(e),branchCode:t(n)}]).then(s=>s.sort((u,a)=>u.sequenceNumber-a.sequenceNumber))}getRangesForStatus(e,n,r,s){let a=this.getQueryBuilder().where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(s)).where("otpType",t(r)).aggregate({min:"sequenceNumber",max:"sequenceNumber"}).select().buildParameterized();return this.http.post(this.url(),p(a)).then(m=>m.length>0?isNaN(m[0].min_sequenceNumber)||isNaN(m[0].max_sequenceNumber)?[0,0]:[+m[0].min_sequenceNumber,+m[0].max_sequenceNumber]:[0,0])}sendForManufacturing(e,n,r,s){let a=this.getQueryBuilder().where("sequenceNumber",x(r)).where("sequenceNumber",B(s)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(0)).update({status:1,manufacturingDispatchDate:new c},!1).buildParameterized();return this.http.post(this.url(),p(a)).then()}markAsDelivered(e,n,r,s){let a=this.getQueryBuilder().where("sequenceNumber",x(r)).where("sequenceNumber",B(s)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(1)).update({status:2,productDeliveryDate:new c},!1).buildParameterized();return this.http.post(this.url(),p(a)).then()}markAsAssigned(e,n,r){let u=this.getQueryBuilder().where("sequenceNumber",t(r)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(2)).update({status:3,keyAssignedDate:new c},!1).buildParameterized();return this.http.post(this.url(),p(u)).then()}voidProduct(e,n,r){let u=this.getQueryBuilder().where("sequenceNumber",t(r)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(3)).update({status:4},!1).buildParameterized();return this.http.post(this.url(),p(u)).then()}static \u0275fac=function(n){return new(n||o)(v(V))};static \u0275prov=N({token:o,factory:o.\u0275fac})};var O=class{constructor(e){this.closeFn=e}_closed=new E;closed=this._closed.asObservable();close(e){this._closed.next(e),this._closed.complete(),this.closeFn(e)}};var R=class o{constructor(e){this.appRef=e}getOptions(e){return{clickToClose:e?.clickToClose??!0,className:e?.className??"",width:e?.width??"auto"}}open(e,n,r,s=!0){let{clickToClose:u,className:a}=this.getOptions(r),m=document.createElement("div"),l=document.createElement("div");l.classList.add("modal-dialog"),a&&m.classList.add(...a.split(" ")),r?.width&&(l.style.width=r.width),m.appendChild(l),m.classList.add("dialog-wrapper","tsway-modal","fade-in");let w=()=>k(this,null,function*(){m.classList.remove("fade-in"),yield this.delay(50),m.classList.add("fade-out"),yield this.delay(300),this.appRef.detachView(y.hostView),y.destroy();try{m&&document.body.removeChild(m)}catch{}document.removeEventListener("keyup",D)}),D=d=>{d.key==="Escape"&&(w(),document.removeEventListener("keyup",D))};if(document.addEventListener("keyup",D),s){let d=document.createElement("div");d.classList.add("dialog-overlay","position-fixed","top-0","start-0","w-100","h-100","bg-dark","opacity-50"),m.appendChild(d),u&&m.addEventListener("click",S=>{S.target===d&&w()})}document.body.appendChild(m);let y=this.appRef.bootstrap(e,l);if(n)for(let d in n)y.setInput(d,n[d]);let T=new O(w);return y.instance.dialogRef=T,Promise.resolve(T)}delay(e){return new Promise(n=>setTimeout(n,e))}static \u0275fac=function(n){return new(n||o)(v(L))};static \u0275prov=N({token:o,factory:o.\u0275fac})};var te=class o{static \u0275fac=function(n){return new(n||o)};static \u0275mod=Q({type:o});static \u0275inj=K({providers:[R,X,I],imports:[W,z,F,Z,J]})};export{R as a,c as b,ne as c,A as d,C as e,$ as f,I as g,te as h};
