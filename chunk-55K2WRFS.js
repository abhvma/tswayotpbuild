import{a as se}from"./chunk-ECNNFCQD.js";import{b as M}from"./chunk-THASOWSL.js";import{a as O,b as _e,c as E}from"./chunk-BT4FQVWO.js";import{a as me,b as de}from"./chunk-TZQHAOMF.js";import{b as _}from"./chunk-7ZFS4USX.js";import{b as ce}from"./chunk-BZE4WTPC.js";import{a as le,c as pe}from"./chunk-EZDIJFPR.js";import"./chunk-COTRNXSH.js";import{a as ae}from"./chunk-HVPVQXOI.js";import{A as C,Ab as te,B as U,Bb as re,Ca as Q,Cb as ie,D as B,E as v,Fb as ne,Gb as oe,Ma as y,N as a,Na as b,Oa as z,R as p,U as g,V,Y as j,Z as d,_a as H,aa as l,ab as J,ea as o,fa as r,ga as u,ha as q,ia as G,ja as I,ka as f,la as c,sa as $,ta as s,tb as K,u as D,ua as x,ub as w,va as k,vb as W,wa as L,wb as X,xb as Y,yb as Z,z as A,zb as ee}from"./chunk-RA2IBNNK.js";import{f as be,h as S}from"./chunk-ENRHZQ2S.js";var he=be(_e());function Ue(t,n){if(t&1&&(o(0,"option",21),s(1),r()),t&2){let e=n.$implicit;l("value",e.branchCode),a(),k(" ",e.branchName," ")}}function Ie(t,n){t&1&&(o(0,"div",22),s(1," Branch Name is required "),r())}function we(t,n){t&1&&(o(0,"div",22),s(1," Username is required and must be at least 3 characters long. "),r())}function Se(t,n){t&1&&(o(0,"div",23),s(1," The username already exists. "),r())}function xe(t,n){if(t&1&&(o(0,"div"),s(1),r()),t&2){let e=c().ngIf;a(),k(" Password must be at least ",e.minLength.requiredLength," characters ")}}function ye(t,n){t&1&&(o(0,"div"),s(1," Password must contain at least one uppercase letter "),r())}function Ee(t,n){t&1&&(o(0,"div"),s(1," Password must contain at least one lowercase letter "),r())}function Me(t,n){t&1&&(o(0,"div"),s(1," Password must contain at least one special character "),r())}function Ne(t,n){t&1&&(o(0,"div"),s(1," Password must contain at least one number "),r())}function Te(t,n){if(t&1&&(o(0,"div"),d(1,xe,2,1,"div",24)(2,ye,2,0,"div",24)(3,Ee,2,0,"div",24)(4,Me,2,0,"div",24)(5,Ne,2,0,"div",24),r()),t&2){let e=n.ngIf;a(),l("ngIf",e.minLength),a(),l("ngIf",e.uppercase),a(),l("ngIf",e.lowercase),a(),l("ngIf",e.specialChar),a(),l("ngIf",e.digit)}}function Fe(t,n){if(t&1&&(o(0,"div",22),d(1,Te,6,5,"div",24),r()),t&2){let e,i=c();a(),l("ngIf",(e=i.userForm.get("password"))==null?null:e.errors)}}function ke(t,n){t&1&&(o(0,"div",22),s(1," New Password didn't match "),r())}var N=class t{constructor(n,e,i){this.fb=n;this.authService=e;this.toast=i;this.userForm=this.fb.group({userId:["",w.required],password:["",[w.required,se.password({digit:!0,lower:!0,upper:!0,length:8,special:!0})]],repeatPassword:["",w.required],branchName:[void 0,w.required]})}model;save=new v;cancel=new v;branchOptions=[];setting;authUser;branchMap={};bankMap={};modalTitle="Add User";userForm;eCustomerStatus=me;eOtpType=de;dialogRef;userNotUnique=!1;ngOnInit(){}_createBranchMap(){this.branchOptions.forEach(n=>{this.branchMap[n.branchCode]=n.branchName})}ngOnChanges(n){this._createBranchMap(),this.modalTitle=(this.model,"Edit User");let e=this.model||new O;this.userForm.patchValue({userId:e.userId,branchName:this.authUser.branchName})}onSave(){return S(this,null,function*(){let n=new ae;try{if(n.show(),this.userNotUnique=!1,this.userForm.valid){let e=new O;if(e.fill(this.userForm.value),e.password=(0,he.sha256)(e.password),this.model)yield this.authService.update(e),this.toast.success("Customer information updated successfully.");else{if(!(yield this.authService.verifyUserIsUnique(e))){n.hide(),this.userNotUnique=!0;return}yield this.authService.create(e),this.toast.success("Customer added successfully.")}this.save.emit(this.userForm.value),this.dialogRef.close(e),n.hide()}else this.userForm.markAllAsTouched()}catch{}finally{n.hide()}})}onCancel(){this.dialogRef.close(void 0),this.cancel.emit()}get formControls(){return this.userForm.controls}static \u0275fac=function(e){return new(e||t)(p(ne),p(E),p(le))};static \u0275cmp=g({type:t,selectors:[["app-user-create-modal"]],inputs:{model:"model",branchOptions:"branchOptions",setting:"setting",authUser:"authUser"},outputs:{save:"save",cancel:"cancel"},standalone:!1,features:[L([_]),A],decls:34,vars:8,consts:[[1,"modal-content"],[1,"tsway-modal-header"],[1,"tsway-modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"tsway-modal-body"],[1,"row",3,"formGroup"],[1,"mb-3","col-md-12"],["for","branchName",1,"form-label"],["id","branchName","formControlName","branchName",1,"form-control"],[3,"value",4,"ngFor","ngForOf"],["class","text-danger",4,"ngIf"],["for","userId",1,"form-label"],["id","userId","formControlName","userId","placeholder","Enter Username",1,"form-control"],["class","text-danger","role","alert",4,"ngIf"],["for","password",1,"form-label"],["type","password","id","password","formControlName","password","placeholder","Password",1,"form-control"],["for","repeatPassword",1,"form-label"],["type","password","id","repeatPassword","formControlName","repeatPassword","placeholder","Repeat Password",1,"form-control"],[1,"tsway-modal-footer"],[1,"btn","btn-danger","me-2","text-white",3,"click"],[1,"btn","btn-primary",3,"click","disabled"],[3,"value"],[1,"text-danger"],["role","alert",1,"text-danger"],[4,"ngIf"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"div",1)(2,"h5",2),s(3,"Add User"),r(),o(4,"button",3),f("click",function(){return i.onCancel()}),r()(),o(5,"div",4)(6,"form",5)(7,"div",6)(8,"label",7),s(9,"Branch Name"),r(),o(10,"select",8),d(11,Ue,2,2,"option",9),r(),d(12,Ie,2,0,"div",10),r(),o(13,"div",6)(14,"label",11),s(15,"Username"),r(),u(16,"input",12),d(17,we,2,0,"div",10)(18,Se,2,0,"div",13),r(),o(19,"div",6)(20,"label",14),s(21,"Password"),r(),u(22,"input",15),d(23,Fe,2,1,"div",10),r(),o(24,"div",6)(25,"label",16),s(26,"Repeat Password"),r(),u(27,"input",17),d(28,ke,2,0,"div",10),r()()(),o(29,"div",18)(30,"button",19),f("click",function(){return i.onCancel()}),s(31," Cancel "),r(),o(32,"button",20),f("click",function(){return i.onSave()}),s(33," Save "),r()()()),e&2&&(a(6),l("formGroup",i.userForm),a(5),l("ngForOf",i.branchOptions),a(),l("ngIf",i.formControls.branchName.touched&&i.formControls.branchName.invalid),a(5),l("ngIf",i.formControls.userId.touched&&i.formControls.userId.invalid),a(),l("ngIf",i.userNotUnique),a(5),l("ngIf",i.formControls.password.touched&&i.formControls.password.invalid),a(5),l("ngIf",i.formControls.repeatPassword.touched&&i.formControls.repeatPassword.value!==i.formControls.password.value),a(4),l("disabled",i.userForm.invalid))},dependencies:[y,b,Y,re,ie,K,te,W,X,Z,ee],styles:["[_nghost-%COMP%]{font-size:.875rem!important}"]})};function Oe(t,n){if(t&1&&(o(0,"th",3),s(1),r()),t&2){let e=n.$implicit;l("width",e.width),a(),x(e.label)}}function Pe(t,n){if(t&1){let e=I();o(0,"button",5),f("click",function(){C(e);let m=c(),h=m.$implicit,R=m.index,ge=c();return U(ge.deleteClick.emit({model:h,index:R}))}),u(1,"i",6),s(2," Delete "),r()}}function Re(t,n){if(t&1&&(o(0,"tr")(1,"td"),s(2),r(),o(3,"td"),s(4),r(),o(5,"td"),d(6,Pe,3,0,"button",4),r()()),t&2){let e=n.$implicit,i=c();a(2),x(e.userId),a(2),x(i.branchMaps[e.branchName]||e.branchName),a(2),l("ngIf",i.currentUser.userId!==e.userId)}}var T=class t{models=[];branchMaps={};editClick=new v;deleteClick=new v;currentUser;columns=[{label:"Username",width:"10%"},{label:"Branch",width:"60%"},{label:"Action",width:"15%"}];static \u0275fac=function(e){return new(e||t)};static \u0275cmp=g({type:t,selectors:[["app-user-table"]],inputs:{models:"models",branchMaps:"branchMaps",currentUser:"currentUser"},outputs:{editClick:"editClick",deleteClick:"deleteClick"},standalone:!1,decls:6,vars:2,consts:[[1,"tsway-datatable","striped"],[3,"width",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[3,"width"],["class","btn btn-sm btn-danger btn-long text-white",3,"click",4,"ngIf"],[1,"btn","btn-sm","btn-danger","btn-long","text-white",3,"click"],[1,"bi","bi-trash"]],template:function(e,i){e&1&&(o(0,"table",0)(1,"thead")(2,"tr"),d(3,Oe,2,2,"th",1),r()(),o(4,"tbody"),d(5,Re,7,3,"tr",2),r()()),e&2&&(a(3),l("ngForOf",i.columns),a(2),l("ngForOf",i.models))},dependencies:[y,b],encapsulation:2})};function Ae(t,n){if(t&1){let e=I();q(0),o(1,"app-user-table",8),f("deleteClick",function(m){C(e);let h=c();return U(h.deleteModel(m))}),r(),G()}if(t&2){let e=c();a(),l("models",e.models)("branchMaps",e.branchMaps)("currentUser",e.currentUser)}}function Be(t,n){t&1&&(o(0,"div",9)(1,"div"),u(2,"i",10),o(3,"p",4),s(4,"No Users found."),r()()())}var F=class t extends ce{constructor(e,i,m,h){super(i);this.settingService=m;this.bankService=h;this.modelService=e}currentUser;setting;branches=[];branchMaps={};getFilterParams(){return[{branchName:J(this.currentUser.branchName)}]}ngOnInit(){this.currentUser=this.modelService.authUser(),this.loadModels().then(),this.settingService.get().then(e=>{this.setting=e[0]}),this.bankService.get().then(e=>{this.branches=e,this.branches.forEach(i=>{this.branchMaps[i.branchCode]=i.branchName})})}applyFilters(){}openDialog(e){return S(this,null,function*(){(yield this.dialog.open(N,{model:e,setting:this.setting,authUser:this.currentUser,branchOptions:this.branches},{width:"22.5%"})).closed.subscribe(m=>{m&&m.branchName===this.currentUser.branchName&&this.models.push(m)})})}static \u0275fac=function(i){return new(i||t)(p(E),p(B),p(_),p(M))};static \u0275cmp=g({type:t,selectors:[["app-user"]],standalone:!1,features:[j],decls:11,vars:2,consts:[["button",""],["noData",""],[1,"container-fluid","py-4","d-flex","flex-column","vh-100"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"mb-0"],[1,"btn","btn-danger","text-white",3,"click"],[1,"bi","bi-plus-lg","me-1"],[4,"ngIf","ngIfElse"],[3,"deleteClick","models","branchMaps","currentUser"],[1,"d-flex","justify-content-center","align-items-center","h-100","text-muted","text-center","px-4"],[1,"bi","bi-search","display-6","d-block","mb-2"]],template:function(i,m){if(i&1){let h=I();o(0,"div",2)(1,"div",3)(2,"h2",4),s(3,"Users"),r(),o(4,"button",5,0),f("click",function(){return C(h),U(m.addModel())}),u(6,"i",6),s(7,"Add New User "),r()(),d(8,Ae,2,3,"ng-container",7)(9,Be,5,0,"ng-template",null,1,Q),r()}if(i&2){let h=$(10);a(8),l("ngIf",m.models.length>0)("ngIfElse",h)}},dependencies:[b,T],encapsulation:2})};var Ve=[{path:"",component:F}],ve=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=V({type:t});static \u0275inj=D({providers:[M,_],imports:[pe,z,H.forChild(Ve),oe]})};export{ve as UserModule};
