import{b as de}from"./chunk-3HGAO5UT.js";import{c as me}from"./chunk-QPNZJXBO.js";import{b}from"./chunk-YXGQWUS3.js";import{a as A}from"./chunk-QYNORUED.js";import{b as fe}from"./chunk-5PM44T34.js";import{b as Q,c as g,d as ye}from"./chunk-XSDUOVQH.js";import{a as ce,c as ge}from"./chunk-US63IDYQ.js";import{a as ue}from"./chunk-HVPVQXOI.js";import{a as V,c as D}from"./chunk-SCDNKRCR.js";import{A as W,B as S,Ba as ne,C as h,Db as O,E as X,Eb as f,F as _,Fb as K,Gb as T,Ia as oe,Ib as E,Jb as x,Kb as w,Lb as k,Mb as N,Nb as M,O as s,Ob as I,Rb as q,S as u,Ta as ae,Tb as pe,Ua as le,V as C,W as Y,Z,_ as ee,ba as l,eb as se,fa as r,ga as i,gb as U,ha as c,ia as te,ib as z,ja as ie,jb as B,ka as F,la as d,ma as v,sb as L,ta as re,ua as n,v as J}from"./chunk-PTWT3WXO.js";import{a as H,h as y}from"./chunk-ENRHZQ2S.js";var P=class m{constructor(p,e,t){this.fb=p;this.toast=e;this.serialKeyService=t;this.userForm=this.fb.group({otptype:[2,f.required],count:[1,[f.required,f.min(1),f.max(1e4)]],branch_cd:[void 0,f.required],bank_cd:[void 0,f.required],command:[3],from:[1],status:[0]}),this.userForm.get("otptype")?.valueChanges.subscribe(a=>{this.user&&this.setting&&this.serialKeyService.getLastMaxCount(this.setting.bankCode,this.user.branchName,this.userForm.get("otptype").value).then(o=>{this.lastMaxCount=o})})}user;setting;save=new _;cancel=new _;lastMaxCount;modalTitle="Generate Keys";userForm;eOtpType=D;dialogRef;userNotUnique=!1;ngOnChanges(){this.user&&this.userForm.get("branch_cd").setValue(this.user.branchName),this.setting&&this.userForm.get("bank_cd").setValue(this.setting.bankCode),this.user&&this.setting&&this.serialKeyService.getLastMaxCount(this.setting.bankCode,this.user.branchName,this.userForm.get("otptype").value).then(p=>{this.lastMaxCount=p})}onSave(){return y(this,null,function*(){let p=new ue;try{p.show();let e=H({},this.userForm.value);e.from=this.lastMaxCount,e.to=+e.count+ +e.from,delete e.count,yield this.serialKeyService.generateKey(e),this.dialogRef.close(void 0),this.toast.success(`${this.userForm.get("count")?.value} key generated successfully.`)}catch(e){this.toast.error(e.msg)}finally{p.hide()}})}onCancel(){this.dialogRef.close(void 0),this.cancel.emit()}get formControls(){return this.userForm.controls}static \u0275fac=function(e){return new(e||m)(u(q),u(ce),u(g))};static \u0275cmp=C({type:m,selectors:[["app-otp-serial-key-create-modal"]],inputs:{user:"user",setting:"setting"},outputs:{save:"save",cancel:"cancel"},standalone:!1,features:[ne([b,g]),W],decls:24,vars:4,consts:[[1,"modal-content",3,"formGroup"],[1,"tsway-modal-header"],[1,"tsway-modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"tsway-modal-body"],[1,"row"],[1,"col-md"],["for","otptype",1,"form-label","small","mb-1"],["id","otptype","formControlName","otptype",1,"form-control"],[3,"ngValue"],["for","count",1,"form-label","small","mb-1"],["type","number","formControlName","count","id","count",1,"form-control"],[1,"tsway-modal-footer","d-flex","flex-row-reverse","justify-content-start"],[1,"btn","btn-primary",3,"click","disabled"],[1,"btn","btn-danger","me-2","text-white",3,"click"]],template:function(e,t){e&1&&(r(0,"form",0)(1,"div",1)(2,"h5",2),n(3,"Generate Key"),i(),r(4,"button",3),d("click",function(){return t.onCancel()}),i()(),r(5,"div",4)(6,"div",5)(7,"section",6)(8,"label",7),n(9,"Type"),i(),r(10,"select",8)(11,"option",9),n(12,"Card"),i(),r(13,"option",9),n(14,"Token"),i()()(),r(15,"section",6)(16,"label",10),n(17,"Number of Key to generate?"),i(),c(18,"input",11),i()()(),r(19,"div",12)(20,"button",13),d("click",function(){return t.onSave()}),n(21," Save "),i(),r(22,"button",14),d("click",function(){return t.onCancel()}),n(23," Cancel "),i()()()),e&2&&(l("formGroup",t.userForm),s(11),l("ngValue",t.eOtpType.Card),s(2),l("ngValue",t.eOtpType.Token),s(7),l("disabled",t.userForm.invalid))},dependencies:[E,M,I,O,x,N,K,T,w,k],styles:["[_nghost-%COMP%]{font-size:.875rem!important}"]})};var j=class m{constructor(p){this.fb=p;let e=new V().date();this.filterForm=this.fb.group({type:[null],dateFrom:[e,f.required],dateTo:[e,f.required],status:[void 0],sequenceStart:[],sequenceEnd:[]}),this.dateFrom=this.filterForm.get("dateFrom"),this.dateTo=this.filterForm.get("dateTo")}filterChange=new _;filterForm;eSerialType=D;eStatusType=Q;dateFrom;dateTo;onSubmit(){this.filterChange.emit({type:this.filterForm.get("type").value,dateTo:this.dateFrom.value?new V(this.dateTo.value):void 0,dateFrom:this.dateTo.value?new V(this.dateFrom.value):void 0,status:this.filterForm.get("status").value?this.filterForm.get("status").value:void 0,sequenceStart:this.filterForm.get("sequenceStart").value?this.filterForm.get("sequenceStart").value:void 0,sequenceEnd:this.filterForm.get("sequenceEnd").value?this.filterForm.get("sequenceEnd").value:void 0})}ngOnDestroy(){}static \u0275fac=function(e){return new(e||m)(u(q))};static \u0275cmp=C({type:m,selectors:[["app-serial-key-filterbar"]],outputs:{filterChange:"filterChange"},standalone:!1,decls:48,vars:11,consts:[[1,"filterbar","mb-3"],[1,"row","g-3","align-items-end",3,"formGroup"],[1,"col-md"],["for","type",1,"form-label","small","mb-1"],["id","type","formControlName","type",1,"form-control"],[3,"value"],["for","sequenceStart",1,"form-label","small","mb-1"],["type","number","id","sequenceStart","formControlName","sequenceStart",1,"form-control"],["for","sequenceEnd",1,"form-label","small","mb-1"],["type","number","id","sequenceEnd","formControlName","sequenceEnd",1,"form-control"],["for","dateFrom",1,"form-label","small","mb-1"],["type","date","id","dateFrom","formControlName","dateFrom",1,"form-control"],["for","dateTo",1,"form-label","small","mb-1"],["type","date","id","dateTo","formControlName","dateTo",1,"form-control"],["for","status",1,"form-label","small","mb-1"],["id","status","formControlName","status",1,"form-control"],[3,"ngValue"],[1,"col-auto"],[1,"btn","btn-primary","w-100","d-flex","align-items-center","justify-content-center","gap-2",3,"click","disabled"],[1,"bi","bi-search"]],template:function(e,t){e&1&&(r(0,"div",0)(1,"form",1)(2,"div",2)(3,"label",3),n(4,"Type"),i(),r(5,"select",4)(6,"option",5),n(7,"All"),i(),r(8,"option",5),n(9,"Card"),i(),r(10,"option",5),n(11,"Token"),i()()(),r(12,"div",2)(13,"label",6),n(14,"Sequence Start"),i(),c(15,"input",7),i(),r(16,"div",2)(17,"label",8),n(18,"Sequence End"),i(),c(19,"input",9),i(),r(20,"div",2)(21,"label",10),n(22,"From*"),i(),c(23,"input",11),i(),r(24,"div",2)(25,"label",12),n(26,"To*"),i(),c(27,"input",13),i(),r(28,"div",2)(29,"label",14),n(30,"Status"),i(),r(31,"select",15)(32,"option",16),n(33,"All"),i(),r(34,"option",16),n(35,"Created"),i(),r(36,"option",16),n(37,"Sent For Manufacturing"),i(),r(38,"option",16),n(39,"Delivered"),i(),r(40,"option",16),n(41,"Assigned"),i(),r(42,"option",16),n(43,"Inactive"),i()()(),r(44,"div",17)(45,"button",18),d("click",function(){return t.onSubmit()}),c(46,"i",19),n(47," Search "),i()()()()),e&2&&(s(),l("formGroup",t.filterForm),s(5),l("value",null),s(2),l("value",t.eSerialType.Card),s(2),l("value",t.eSerialType.Token),s(22),l("ngValue",null),s(2),l("ngValue",t.eStatusType.Created),s(2),l("ngValue",t.eStatusType.Manufacturing),s(2),l("ngValue",t.eStatusType.Delivered),s(2),l("ngValue",t.eStatusType.Assigned),s(2),l("ngValue",t.eStatusType.Void),s(3),l("disabled",t.filterForm.invalid))},dependencies:[E,M,I,O,x,N,K,T,w,k],encapsulation:2})};function Fe(m,p){if(m&1){let e=F();te(0),r(1,"app-otp-serial-key-table",10),d("sendForManufacturingAction",function(a){S(e);let o=v();return h(o.onSendForManufacturing(a))})("markAsDeliveredAction",function(a){S(e);let o=v();return h(o.onMarkAsDelivered(a))}),i(),ie()}if(m&2){let e=v();s(),l("models",e.models)}}function Oe(m,p){if(m&1){let e=F();r(0,"div",11)(1,"app-paginator",12),d("pageChange",function(a){S(e);let o=v();return h(o.onPageChange(a))})("pageSizeChange",function(a){S(e);let o=v();return h(o.onPageSizeChange(a))}),i()()}if(m&2){let e=v();s(),l("pageSize",e.paginationOption.pageSize)("total",e.paginationOption.total)("startPage",1)("totalNotKnown",!1)}}function Ke(m,p){m&1&&(r(0,"div",13)(1,"div"),c(2,"i",14),r(3,"p",4),n(4,"Key records not found."),i()()())}var G=class m extends fe{constructor(e,t,a,o){super(o);this.authService=t;this.settingService=a;this.modelService=e}setting;user;hasSearched=!1;getFilterParams(){let e=[],t=this.modelFilters;return t.type&&e.push({otpType:U(t.type)}),Number(t.status)>-1&&e.push({status:U(t.status)}),t.dateFrom&&e.push({createdDate:z(t.dateFrom.date())}),t.dateTo&&e.push({createdDate:B(t.dateTo.date())}),t.sequenceStart&&e.push({sequenceNumber:z(t.sequenceStart)}),t.sequenceEnd&&e.push({sequenceNumber:B(t.sequenceEnd)}),e}ngOnInit(){this.settingService.find().then(e=>{this.setting=e}),this.user=this.authService.authUser()}applyFilters(){return y(this,null,function*(){this.hasSearched=!0,this.paginationOption.total=yield this.modelService.getCount(this.getFilterParams()),yield this.loadModels(!0)})}openDialog(e){return y(this,null,function*(){(yield this.dialog.open(P,{user:this.user,setting:this.setting},{width:"35%"})).closed.subscribe(a=>{})})}onPageChange(e){this.paginationOption.currentPage=e,this.loadModels(!0).then()}onPageSizeChange(e){this.paginationOption.pageSize=e}onSendForManufacturing(e){return y(this,null,function*(){if(yield this.alert.show("Confirm Action","Are you sure you want to send these items for manufacturing?","primary")){let a=L(e.map(o=>o.sequenceNumber));for(let o of a)try{yield this.modelService.sendForManufacturing(this.setting.bankCode,this.user.branchName,o.start,o.end)}catch{this.toast.error("Update status change failed.")}}})}onMarkAsDelivered(e){return y(this,null,function*(){if(yield this.alert.show("Confirm Action","Are you sure you want to send these items as delivered?","primary")){let a=L(e.map(o=>o.sequenceNumber));for(let o of a)try{yield this.modelService.markAsDelivered(this.setting.bankCode,this.user.branchName,o.start,o.end)}catch{this.toast.error("Update status change failed.")}}})}static \u0275fac=function(t){return new(t||m)(u(g),u(me),u(b),u(X))};static \u0275cmp=C({type:m,selectors:[["app-serial-key"]],standalone:!1,features:[Z],decls:13,vars:3,consts:[["button",""],["noData",""],[1,"container-fluid","py-4","d-flex","flex-column","vh-100"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"mb-0"],[1,"btn","btn-danger","text-white",3,"click"],[1,"bi","bi-plus-lg","me-1"],[3,"filterChange"],[4,"ngIf","ngIfElse"],["class","mb-4 fixed",4,"ngIf"],[3,"sendForManufacturingAction","markAsDeliveredAction","models"],[1,"mb-4","fixed"],[3,"pageChange","pageSizeChange","pageSize","total","startPage","totalNotKnown"],[1,"d-flex","justify-content-center","align-items-center","h-100","text-muted","text-center","px-4"],[1,"bi","bi-search","display-6","d-block","mb-2"]],template:function(t,a){if(t&1){let o=F();r(0,"div",2)(1,"div",3)(2,"h2",4),n(3,"OTP Keys"),i(),r(4,"button",5,0),d("click",function(){return S(o),h(a.addModel())}),c(6,"i",6),n(7,"Create Key "),i()(),r(8,"app-serial-key-filterbar",7),d("filterChange",function(ve){return S(o),h(a.onFilterChange(ve))}),i(),ee(9,Fe,2,1,"ng-container",8)(10,Oe,2,4,"div",9)(11,Ke,5,0,"ng-template",null,1,oe),i()}if(t&2){let o=re(12);s(9),l("ngIf",a.models.length>0)("ngIfElse",o),s(),l("ngIf",a.hasSearched)}},dependencies:[de,ae,A,j],encapsulation:2})};var Te=[{path:"",component:G}],he=class m{static \u0275fac=function(e){return new(e||m)};static \u0275mod=Y({type:m});static \u0275inj=J({providers:[b,g],imports:[ye,le,se.forChild(Te),pe,ge,A]})};export{he as OtpSerialKeyModule};
