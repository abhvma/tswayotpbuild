import{a as de,b as fe,c as ge}from"./chunk-B7RSQGP4.js";import{b as me}from"./chunk-5LLL7KMF.js";import{c as pe}from"./chunk-4HWPX7HP.js";import{b as d}from"./chunk-COTRNXSH.js";import{a as ce}from"./chunk-HVPVQXOI.js";import{$a as $,A as C,Ab as re,B as D,D as j,Da as K,E as _,Gb as le,Hb as se,N as a,Na as Q,Oa as B,Pa as H,R as x,U as T,V,Y as R,Z as g,aa as l,ab as J,db as U,ea as r,eb as W,fa as i,ga as m,ha as z,ia as A,ja as S,ka as u,la as p,mb as X,nb as Y,ob as Z,sa as G,t as O,ta as s,tb as ee,u as M,ua as h,ub as te,vb as L,w as k,wb as ne,xb as oe,yb as ie,zb as ae}from"./chunk-4TWJ36SW.js";import"./chunk-FK6H3RFT.js";import{a as P,b as q,g as N}from"./chunk-ENRHZQ2S.js";var he={traceDate:"trace_date",traceSequence:"trace_seq",terminalIp:"terminal_ip",sqlText:"sql_txt"},v=class extends J{traceDate="";traceSequence="";terminalIp="";sqlText="";constructor(){super(),this._mapper=new Y(he)}getPrimaryKeyName(){return""}getSoftDelete(){}};v=N([Z("trlog")],v);var b=class t extends X{constructor(n){super(n,v)}getName(){return"transtactions"}static \u0275fac=function(e){return new(e||t)(k(ee))};static \u0275prov=O({token:t,factory:t.\u0275fac})};function be(t,n){if(t&1&&(r(0,"th",3),s(1),i()),t&2){let e=n.$implicit;l("width",e.width),a(),h(e.label)}}function _e(t,n){if(t&1&&(r(0,"tr")(1,"td"),s(2),i(),r(3,"td"),s(4),i(),r(5,"td"),s(6),i(),r(7,"td"),s(8),i()()),t&2){let e=n.$implicit;a(2),h(e.traceSequence),a(2),h(e.terminalIp),a(2),h(e.sqlText),a(2),h(e.traceDate)}}var y=class t{models=[];editClick=new _;deleteClick=new _;columns=[{label:"Trace Sequence",width:"10%"},{label:"Terminal IP",width:"20%"},{label:"SQL Text",width:"60%"},{label:"Trace Date",width:"20%"}];static \u0275fac=function(e){return new(e||t)};static \u0275cmp=T({type:t,selectors:[["app-transaction-log-table"]],inputs:{models:"models"},outputs:{editClick:"editClick",deleteClick:"deleteClick"},standalone:!1,decls:6,vars:2,consts:[[1,"tsway-datatable","striped"],[3,"width",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[3,"width"]],template:function(e,o){e&1&&(r(0,"table",0)(1,"thead")(2,"tr"),g(3,be,2,2,"th",1),i()(),r(4,"tbody"),g(5,_e,9,4,"tr",2),i()()),e&2&&(a(3),l("ngForOf",o.columns),a(2),l("ngForOf",o.models))},dependencies:[Q],encapsulation:2})};var F=class t{constructor(n){this.fb=n;this.filterForm=this.fb.group({traceDateTo:["",L.required],traceDateFrom:["",L.required],terminalIp:""})}fromDate=new d;toDate=new d;filterChange=new _;filterForm;subscriptions=[];emitFilter(){this.filterChange.emit(this.filterForm.value)}ngOnDestroy(){this.subscriptions.forEach(n=>n.unsubscribe())}static \u0275fac=function(e){return new(e||t)(x(le))};static \u0275cmp=T({type:t,selectors:[["app-transaction-log-filterbar"]],inputs:{fromDate:"fromDate",toDate:"toDate"},outputs:{filterChange:"filterChange"},standalone:!1,decls:14,vars:3,consts:[[1,"filterbar","mb-3"],[1,"row","g-3","align-items-end","filter-form-container",3,"formGroup"],[1,"col-md-2"],["for","traceDateFrom",1,"form-label","small","mb-1"],["type","date","id","traceDateFrom","formControlName","traceDateFrom",1,"form-control",3,"value"],["for","traceDateTo",1,"form-label","small","mb-1"],["value","toDate.date()","type","date","id","traceDateTo","formControlName","traceDateTo",1,"form-control"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"bi","bi-search","me-1"]],template:function(e,o){e&1&&(r(0,"div",0)(1,"form",1)(2,"div",2)(3,"label",3),s(4,"Trace From"),i(),m(5,"input",4),i(),r(6,"div",2)(7,"label",5),s(8,"Trace To"),i(),m(9,"input",6),i(),r(10,"div",2)(11,"button",7),u("click",function(){return o.emitFilter()}),m(12,"i",8),s(13,"Search "),i()()()()),e&2&&(a(),l("formGroup",o.filterForm),a(4),l("value",o.fromDate.date()),a(6),l("disabled",o.filterForm.invalid))},dependencies:[ie,te,ne,oe,ae,re],encapsulation:2})};function xe(t,n){if(t&1){let e=S();r(0,"div",7)(1,"a",8),u("click",function(){C(e);let c=p();return D(c.downloadTable())}),m(2,"i",9),s(3," Download PDF "),i()()}}function Se(t,n){if(t&1&&(z(0),m(1,"app-transaction-log-table",13),A()),t&2){let e=p(2);a(),l("models",e.models)}}function Ie(t,n){if(t&1){let e=S();r(0,"div",10)(1,"app-paginator",11),u("pageChange",function(c){C(e);let f=p(2);return D(f.fetchTransactions(c))}),i()()}if(t&2){let e=p(2);a(),l("pageSize",e.paginationOption.pageSize)("total",e.models.length)("startPage",1)("totalNotKnown",!0)}}function ye(t,n){t&1&&(r(0,"div")(1,"p",3),s(2,"Search for Transaction logs"),i()())}function Fe(t,n){t&1&&(r(0,"div")(1,"p",3),s(2,"No transaction log found."),i()())}function we(t,n){if(t&1&&(r(0,"div",14)(1,"div"),m(2,"i",15),g(3,ye,3,0,"div",16)(4,Fe,3,0,"div",16),i()()),t&2){let e=p(2);a(3),l("ngIf",!e.hasSearched),a(),l("ngIf",e.hasSearched)}}function Le(t,n){if(t&1){let e=S();r(0,"div",10)(1,"app-paginator",11),u("pageChange",function(c){C(e);let f=p();return D(f.fetchTransactions(c))}),i(),g(2,Se,2,1,"ng-container",12)(3,Ie,2,4,"div",6)(4,we,5,2,"ng-template",null,0,K),i()}if(t&2){let e=G(5),o=p();a(),l("pageSize",o.paginationOption.pageSize)("total",o.models.length)("startPage",1)("totalNotKnown",!0),a(),l("ngIf",o.models.length>0)("ngIfElse",e),a(),l("ngIf",o.hasSearched)}}var w=class t extends me{hasSearched=!1;fromDate=new d;toDate=new d;constructor(n){super(n),this.modelService=n.get(b)}ngOnInit(){}fetchTransactions(n=0){let e=new ce;this.paginationOption.currentPage=n;let o=[],c=this.modelFilters.traceDateFrom?new d(this.modelFilters.traceDateFrom).date():this.fromDate.date(),f=this.modelFilters.traceDateTo?new d(this.modelFilters.traceDateTo).date():this.toDate.date();return o.push({traceDate:U(c)}),o.push({traceDate:W(f)}),e.show(),this.modelService.paginate(o,{traceDate:"DESC"},this.paginationOption.currentPage,this.paginationOption.pageSize).then(E=>(this.models=E,this.hasSearched=!0,this.models)).catch(E=>(this.toast.error("Failed to load transaction logs"),[])).finally(()=>{e.hide()})}loadModels(){return this.fetchTransactions(this.paginationOption.currentPage)}openDialog(n){throw new Error("Method not implemented.")}applyFilters(){throw new Error("Method not implemented.")}onFilterChange(n){this.paginationOption=q(P({},this.paginationOption),{currentPage:0}),this.modelFilters=n,this.loadModels()}downloadTable(){let n=new de;n.setFontSize(12);let e=this.models.map(o=>({traceSequence:o.traceSequence,terminalIp:o.terminalIp,sqlText:o.sqlText,traceDate:o.traceDate.toLocaleString()}));fe(n,{head:[["Trace Sequence","Terminal IP","Sql Text","Trace Date"]],body:e.map(o=>[o.traceSequence,o.terminalIp,o.sqlText,o.traceDate])}),n.save(`transaction-log${new Date().toDateString()}.pdf`)}static \u0275fac=function(e){return new(e||t)(x(j))};static \u0275cmp=T({type:t,selectors:[["app-transaction-log"]],standalone:!1,features:[R],decls:7,vars:4,consts:[["noData",""],[1,"container-fluid","py-4","d-flex","flex-column","vh-100"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"mb-0"],[3,"filterChange","fromDate","toDate"],["class","d-flex justify-content-end mb-2",4,"ngIf"],["class","mb-4",4,"ngIf"],[1,"d-flex","justify-content-end","mb-2"],["role","button",1,"btn-link","text-muted","small","text-decoration-none",3,"click"],[1,"bi","bi-file-earmark-pdf","me-1"],[1,"mb-4"],[3,"pageChange","pageSize","total","startPage","totalNotKnown"],[4,"ngIf","ngIfElse"],[3,"models"],[1,"d-flex","justify-content-center","align-items-center","h-100","text-muted","text-center","px-4"],[1,"bi","bi-search","display-6","d-block","mb-2"],[4,"ngIf"]],template:function(e,o){e&1&&(r(0,"div",1)(1,"div",2)(2,"h2",3),s(3,"Transaction Logs"),i()(),r(4,"app-transaction-log-filterbar",4),u("filterChange",function(f){return o.onFilterChange(f)}),i(),g(5,xe,4,0,"div",5)(6,Le,6,7,"div",6),i()),e&2&&(a(4),l("fromDate",o.fromDate)("toDate",o.toDate),a(),l("ngIf",o.models.length>0),a(),l("ngIf",o.hasSearched))},dependencies:[B,ge,y,F],encapsulation:2})};var Ee=[{path:"",component:w}],Te=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=V({type:t});static \u0275inj=M({providers:[b],imports:[pe,H,$.forChild(Ee),se]})};export{Te as TransactionLogModule};
