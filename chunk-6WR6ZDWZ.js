import{a as ce,b as pe,c as de}from"./chunk-CXIGUQN6.js";import{b as se}from"./chunk-7736H4BC.js";import{c as me}from"./chunk-4HWPX7HP.js";import{b as p}from"./chunk-COTRNXSH.js";import{a as le}from"./chunk-HVPVQXOI.js";import{$a as B,A as _,Ab as ie,B as x,D as O,Da as G,E as v,Gb as re,Hb as ae,N as r,Na as z,Oa as K,Pa as Q,R as I,U as d,V as k,Y as j,Z as f,aa as l,ab as H,db as $,ea as a,eb as J,fa as i,ga as c,ha as V,ia as R,ja as S,ka as g,la as u,mb as U,nb as W,ob as X,sa as A,t as P,ta as s,tb as Y,u as N,ua as T,ub as Z,vb as E,w as M,wb as ee,xb as te,yb as ne,zb as oe}from"./chunk-4TWJ36SW.js";import"./chunk-FK6H3RFT.js";import{g as q}from"./chunk-ENRHZQ2S.js";var ue={traceDate:"trace_date",traceSequence:"trace_seq",terminalIp:"terminal_ip",sqlText:"sql_txt"},b=class extends H{traceDate="";traceSequence="";terminalIp="";sqlText="";constructor(){super(),this._mapper=new W(ue)}getPrimaryKeyName(){return""}getSoftDelete(){}};b=q([X("trlog")],b);var h=class t extends U{constructor(n){super(n,b)}getName(){return"transtactions"}static \u0275fac=function(e){return new(e||t)(M(Y))};static \u0275prov=P({token:t,factory:t.\u0275fac})};function be(t,n){if(t&1&&(a(0,"th",3),s(1),i()),t&2){let e=n.$implicit;l("width",e.width),r(),T(e.label)}}function he(t,n){if(t&1&&(a(0,"tr")(1,"td"),s(2),i(),a(3,"td"),s(4),i(),a(5,"td"),s(6),i(),a(7,"td"),s(8),i()()),t&2){let e=n.$implicit;r(2),T(e.traceSequence),r(2),T(e.terminalIp),r(2),T(e.sqlText),r(2),T(e.traceDate)}}var F=class t{models=[];editClick=new v;deleteClick=new v;columns=[{label:"Trace Sequence",width:"10%"},{label:"Terminal IP",width:"20%"},{label:"SQL Text",width:"60%"},{label:"Trace Date",width:"20%"}];static \u0275fac=function(e){return new(e||t)};static \u0275cmp=d({type:t,selectors:[["app-transaction-log-table"]],inputs:{models:"models"},outputs:{editClick:"editClick",deleteClick:"deleteClick"},standalone:!1,decls:6,vars:2,consts:[[1,"tsway-datatable","striped"],[3,"width",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[3,"width"]],template:function(e,o){e&1&&(a(0,"table",0)(1,"thead")(2,"tr"),f(3,be,2,2,"th",1),i()(),a(4,"tbody"),f(5,he,9,4,"tr",2),i()()),e&2&&(r(3),l("ngForOf",o.columns),r(2),l("ngForOf",o.models))},dependencies:[z],encapsulation:2})};var w=class t{constructor(n){this.fb=n;this.filterForm=this.fb.group({traceDateTo:["",E.required],traceDateFrom:["",E.required],terminalIp:""})}fromDate=new p;toDate=new p;filterChange=new v;filterForm;subscriptions=[];emitFilter(){this.filterChange.emit(this.filterForm.value)}ngOnDestroy(){this.subscriptions.forEach(n=>n.unsubscribe())}static \u0275fac=function(e){return new(e||t)(I(re))};static \u0275cmp=d({type:t,selectors:[["app-transaction-log-filterbar"]],inputs:{fromDate:"fromDate",toDate:"toDate"},outputs:{filterChange:"filterChange"},standalone:!1,decls:14,vars:3,consts:[[1,"filterbar","mb-3"],[1,"row","g-3","align-items-end","filter-form-container",3,"formGroup"],[1,"col-md-2"],["for","traceDateFrom",1,"form-label","small","mb-1"],["type","date","id","traceDateFrom","formControlName","traceDateFrom",1,"form-control",3,"value"],["for","traceDateTo",1,"form-label","small","mb-1"],["value","toDate.date()","type","date","id","traceDateTo","formControlName","traceDateTo",1,"form-control"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"bi","bi-search","me-1"]],template:function(e,o){e&1&&(a(0,"div",0)(1,"form",1)(2,"div",2)(3,"label",3),s(4,"Trace From"),i(),c(5,"input",4),i(),a(6,"div",2)(7,"label",5),s(8,"Trace To"),i(),c(9,"input",6),i(),a(10,"div",2)(11,"button",7),g("click",function(){return o.emitFilter()}),c(12,"i",8),s(13,"Search "),i()()()()),e&2&&(r(),l("formGroup",o.filterForm),r(4),l("value",o.fromDate.date()),r(6),l("disabled",o.filterForm.invalid))},dependencies:[ne,Z,ee,te,oe,ie],encapsulation:2})};function De(t,n){if(t&1){let e=S();a(0,"div",8)(1,"a",9),g("click",function(){_(e);let m=u();return x(m.downloadTable())}),c(2,"i",10),s(3," Download PDF "),i()()}}function _e(t,n){if(t&1&&(V(0),c(1,"app-transaction-log-table",11),R()),t&2){let e=u();r(),l("models",e.models)}}function xe(t,n){if(t&1){let e=S();a(0,"div",12)(1,"app-paginator",13),g("pageChange",function(m){_(e);let C=u();return x(C.fetchTransactions(m))}),i()()}if(t&2){let e=u();r(),l("pageSize",e.paginationOption.pageSize)("total",e.models.length)("startPage",1)("totalNotKnown",!0)}}function Ie(t,n){t&1&&(a(0,"div")(1,"p",3),s(2,"Search for Transaction logs"),i()())}function Se(t,n){t&1&&(a(0,"div")(1,"p",3),s(2,"No transaction log found."),i()())}function ye(t,n){if(t&1&&(a(0,"div",14)(1,"div"),c(2,"i",15),f(3,Ie,3,0,"div",16)(4,Se,3,0,"div",16),i()()),t&2){let e=u();r(3),l("ngIf",!e.hasSearched),r(),l("ngIf",e.hasSearched)}}var L=class t extends se{hasSearched=!1;fromDate=new p;toDate=new p;constructor(n){super(n),this.modelService=n.get(h)}ngOnInit(){}fetchTransactions(n=1){let e=new le;this.paginationOption.currentPage=n-1;let o=[],m=this.modelFilters.traceDateFrom?new p(this.modelFilters.traceDateFrom).date():this.fromDate.date(),C=this.modelFilters.traceDateTo?new p(this.modelFilters.traceDateTo).date():this.toDate.date();return o.push({traceDate:$(m)}),o.push({traceDate:J(C)}),e.show(),this.modelService.paginate(o,{traceDate:"DESC"},this.paginationOption.currentPage,this.paginationOption.pageSize).then(D=>(this.models=D,this.hasSearched=!0,this.models)).catch(D=>(this.toast.error("Failed to load transaction logs"),[])).finally(()=>{e.hide()})}loadModels(){return this.fetchTransactions(this.paginationOption.currentPage)}openDialog(n){throw new Error("Method not implemented.")}applyFilters(){throw new Error("Method not implemented.")}onFilterChange(n){this.modelFilters=n,this.loadModels()}downloadTable(){let n=new ce;n.setFontSize(12);let e=this.models.map(o=>({traceSequence:o.traceSequence,terminalIp:o.terminalIp,sqlText:o.sqlText,traceDate:o.traceDate.toLocaleString()}));pe(n,{head:[["Trace Sequence","Terminal IP","Sql Text","Trace Date"]],body:e.map(o=>[o.traceSequence,o.terminalIp,o.sqlText,o.traceDate])}),n.save(`transaction-log${new Date().toDateString()}.pdf`)}static \u0275fac=function(e){return new(e||t)(I(O))};static \u0275cmp=d({type:t,selectors:[["app-transaction-log"]],standalone:!1,features:[j],decls:10,vars:6,consts:[["noData",""],[1,"container-fluid","py-4","d-flex","flex-column","vh-100"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"mb-0"],[3,"filterChange","fromDate","toDate"],["class","d-flex justify-content-end mb-2",4,"ngIf"],[4,"ngIf","ngIfElse"],["class","mb-4",4,"ngIf"],[1,"d-flex","justify-content-end","mb-2"],["role","button",1,"btn-link","text-muted","small","text-decoration-none",3,"click"],[1,"bi","bi-file-earmark-pdf","me-1"],[3,"models"],[1,"mb-4"],[3,"pageChange","pageSize","total","startPage","totalNotKnown"],[1,"d-flex","justify-content-center","align-items-center","h-100","text-muted","text-center","px-4"],[1,"bi","bi-search","display-6","d-block","mb-2"],[4,"ngIf"]],template:function(e,o){if(e&1){let m=S();a(0,"div",1)(1,"div",2)(2,"h2",3),s(3,"Transaction Logs"),i()(),a(4,"app-transaction-log-filterbar",4),g("filterChange",function(D){return _(m),x(o.onFilterChange(D))}),i(),f(5,De,4,0,"div",5)(6,_e,2,1,"ng-container",6)(7,xe,2,4,"div",7)(8,ye,5,2,"ng-template",null,0,G),i()}if(e&2){let m=A(9);r(4),l("fromDate",o.fromDate)("toDate",o.toDate),r(),l("ngIf",o.models.length>0),r(),l("ngIf",o.models.length>0)("ngIfElse",m),r(),l("ngIf",o.hasSearched)}},dependencies:[K,de,F,w],encapsulation:2})};var Fe=[{path:"",component:L}],ge=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=k({type:t});static \u0275inj=N({providers:[h],imports:[me,Q,B.forChild(Fe),ae]})};export{ge as TransactionLogModule};
