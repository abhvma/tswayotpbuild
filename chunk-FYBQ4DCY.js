import{a as xe}from"./chunk-OYIEH6V4.js";import{c as Fe}from"./chunk-FKFP3K5F.js";import{b as C}from"./chunk-GWJSFVBM.js";import{b as h}from"./chunk-ZRACD77Y.js";import{b as _e}from"./chunk-T4OZUYU5.js";import{b as ke}from"./chunk-R35HLCHV.js";import{a as Ie,c as we}from"./chunk-UJRL6OBK.js";import{b as g}from"./chunk-COTRNXSH.js";import{a as qe}from"./chunk-HVPVQXOI.js";import{A as ne,Ab as K,B as z,Ba as w,Bb as O,C as J,Ca as k,Cb as M,Db as P,E as oe,Ea as fe,Eb as V,F as T,Fb as A,Gb as j,Hb as G,Kb as U,Lb as Ee,N as W,O as m,Oa as be,Pa as Se,Qa as ye,S as c,V as S,W as ae,Y as _,Z as me,_ as F,ab as ge,ba as l,bb as ve,cb as y,eb as X,fa as n,fb as Y,ga as r,ha as u,ia as le,ja as se,ka as pe,la as b,ma as ue,ob as he,pb as Ce,qb as Ne,ta as ce,u as te,ua as a,v as re,va as E,vb as Te,x as ie,xa as de,xb as x,yb as d,zb as D}from"./chunk-RHKCHBCJ.js";import{g as ee,h as I}from"./chunk-ENRHZQ2S.js";var q=(p=>(p[p.Created=0]="Created",p[p.Delivered=1]="Delivered",p[p.Assigned=2]="Assigned",p[p.Inactive=3]="Inactive",p[p.Unknown=-1]="Unknown",p))(q||{}),Pe={otpType:"otptype",bankCode:"bank_cd",branchCode:"branch_cd",sequenceNumber:"seqno",otpKey:"otp_key",createdDate:"create_date",status:"status"},N=class extends ve{otpType=2;bankCode="";branchCode="";sequenceNumber=0;otpKey="";createdDate=new g;status=0;constructor(){super(),this._mapper=new Ce(Pe)}getSoftDelete(){}getPrimaryKeyName(){return"sequenceNumber"}setCreatedDate(i){this.createdDate=new g(i)}setStatus(i){switch(i){case"0":this.status=0;break;case"1":this.status=1;break;case"2":this.status=2;break;case"3":this.status=3;break;default:this.status=-1}}};N=ee([Ne("keymst")],N);var f=class o extends he{constructor(i){super(i,N)}getName(){return"serialkey"}generateKey(i){return this.http.post(this.url(),i,{headers:{service:"otpsvr"}})}getAssignableKeys(){return this.get([{status:y(1)}]).then(i=>i.sort((e,t)=>e.sequenceNumber-t.sequenceNumber))}getFreshKeys(){return this.get([{status:y(1)}]).then(i=>i.sort((e,t)=>e.sequenceNumber-t.sequenceNumber))}getAssignedKeys(i){return i||(i=[]),this.get([{status:y(2)}]).then(e=>e.sort((t,s)=>t.sequenceNumber-s.sequenceNumber))}static \u0275fac=function(e){return new(e||o)(ie(Te))};static \u0275prov=te({token:o,factory:o.\u0275fac})};var R=class o{constructor(i,e,t){this.fb=i;this.toast=e;this.serialKeyService=t;this.userForm=this.fb.group({otptype:[2,d.required],count:[1,[d.required,d.min(1),d.max(1e4)]],branch_cd:[void 0,d.required],bank_cd:[void 0,d.required],command:[3]})}user;setting;save=new T;cancel=new T;modalTitle="Generate Keys";userForm;eOtpType=C;dialogRef;userNotUnique=!1;ngOnChanges(){this.user&&this.userForm.get("branch_cd").setValue(this.user.branchName),this.setting&&this.userForm.get("bank_cd").setValue(this.setting.bankCode)}onSave(){return I(this,null,function*(){let i=new qe;try{i.show(),yield this.serialKeyService.generateKey(this.userForm.value),this.dialogRef.close(void 0),this.toast.success(`${this.userForm.value.count} key generated successfully.`)}catch{}finally{i.hide()}})}onCancel(){this.dialogRef.close(void 0),this.cancel.emit()}get formControls(){return this.userForm.controls}static \u0275fac=function(e){return new(e||o)(c(U),c(Ie),c(f))};static \u0275cmp=S({type:o,selectors:[["app-serial-number-create-modal"]],inputs:{user:"user",setting:"setting"},outputs:{save:"save",cancel:"cancel"},standalone:!1,features:[de([h,f]),ne],decls:24,vars:4,consts:[[1,"modal-content",3,"formGroup"],[1,"tsway-modal-header"],[1,"tsway-modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"tsway-modal-body"],[1,"row"],[1,"col-md"],["for","otptype",1,"form-label","small","mb-1"],["id","otptype","formControlName","otptype",1,"form-control"],[3,"ngValue"],["for","count",1,"form-label","small","mb-1"],["type","number","formControlName","count","id","count",1,"form-control"],[1,"tsway-modal-footer","d-flex","flex-row-reverse","justify-content-start"],[1,"btn","btn-primary",3,"click","disabled"],[1,"btn","btn-danger","me-2","text-white",3,"click"]],template:function(e,t){e&1&&(n(0,"form",0)(1,"div",1)(2,"h5",2),a(3,"Generate Key"),r(),n(4,"button",3),b("click",function(){return t.onCancel()}),r()(),n(5,"div",4)(6,"div",5)(7,"section",6)(8,"label",7),a(9,"Type"),r(),n(10,"select",8)(11,"option",9),a(12,"Card"),r(),n(13,"option",9),a(14,"Token"),r()()(),n(15,"section",6)(16,"label",10),a(17,"Number of Key to generate?"),r(),u(18,"input",11),r()()(),n(19,"div",12)(20,"button",13),b("click",function(){return t.onSave()}),a(21," Save "),r(),n(22,"button",14),b("click",function(){return t.onCancel()}),a(23," Cancel "),r()()()),e&2&&(l("formGroup",t.userForm),m(11),l("ngValue",t.eOtpType.Card),m(2),l("ngValue",t.eOtpType.Token),m(7),l("disabled",t.userForm.invalid))},dependencies:[O,j,G,x,M,A,D,K,P,V],styles:["[_nghost-%COMP%]{font-size:.875rem!important}"]})};var B=class o{transform(i,...e){let t="",s="";switch(i){case 0:t="bg-info",s="Created";break;case 1:t="bg-success",s="Delivered";break;case 2:t="bg-primary",s="Assigned";break;case 3:t="bg-secondary",s="Inactive";break;case-1:t="badge-warning",s="Unknown";break}return`<span class='badge badge-pill ${t}'>${s}</span>`}static \u0275fac=function(e){return new(e||o)};static \u0275pipe=_({name:"serialNumberStatus",type:o,pure:!0,standalone:!1})};var H=class o{transform(i,...e){let t="",s="";switch(i){case 2:t="bi-credit-card",s="Card";break;case 3:t="bi-safe",s="Token";break;default:t="bi-exclamation",s="Invalid";break}return`<span class=''><i class="bi ${t} me-1"></i></span>`}static \u0275fac=function(e){return new(e||o)};static \u0275pipe=_({name:"serialKeyType",type:o,pure:!0,standalone:!1})};function Ue(o,i){if(o&1&&(n(0,"th",3),a(1),r()),o&2){let e=i.$implicit;l("width",e.width),m(),E(e.label)}}function Re(o,i){if(o&1&&(n(0,"tr"),u(1,"td",4),w(2,"serialKeyType"),n(3,"td"),a(4),r(),n(5,"td"),a(6),w(7,"keySecret"),r(),n(8,"td"),a(9),r(),u(10,"td",4),w(11,"serialNumberStatus"),r()),o&2){let e=i.$implicit;m(),l("innerHTML",k(2,5,e.otpType),W),m(3),E(e.sequenceNumber),m(2),E(k(7,7,e.otpKey)),m(3),E(e.createdDate.date()),m(),l("innerHTML",k(11,9,e.status),W)}}var $=class o{models=[];columns=[{label:"Type",width:"5%"},{label:"Sequence Number",width:"20%"},{label:"Key",width:"40%"},{label:"Created Date",width:"20%"},{label:"Status",width:"10%"}];static \u0275fac=function(e){return new(e||o)};static \u0275cmp=S({type:o,selectors:[["app-serial-number-table"]],inputs:{models:"models"},standalone:!1,decls:6,vars:2,consts:[[1,"tsway-datatable","striped"],[3,"width",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[3,"width"],[3,"innerHTML"]],template:function(e,t){e&1&&(n(0,"table",0)(1,"thead")(2,"tr"),F(3,Ue,2,2,"th",1),r()(),n(4,"tbody"),F(5,Re,12,11,"tr",2),r()()),e&2&&(m(3),l("ngForOf",t.columns),m(2),l("ngForOf",t.models))},dependencies:[be,xe,B,H],encapsulation:2})};var Q=class o{constructor(i){this.fb=i;let e=new g().date();this.filterForm=this.fb.group({type:[null],dateFrom:[e,d.required],dateTo:[e,d.required],status:[void 0],sequenceStart:[],sequenceEnd:[]}),this.dateFrom=this.filterForm.get("dateFrom"),this.dateTo=this.filterForm.get("dateTo")}filterChange=new T;filterForm;eSerialType=C;eStatusType=q;dateFrom;dateTo;onSubmit(){this.filterChange.emit({type:this.filterForm.get("type").value,dateTo:this.dateFrom.value?new g(this.dateFrom.value):void 0,dateFrom:this.dateTo.value?new g(this.dateTo.value):void 0,status:this.filterForm.get("status").value,sequenceStart:this.filterForm.get("sequenceStart").value,sequenceEnd:this.filterForm.get("sequenceEnd").value})}ngOnDestroy(){}static \u0275fac=function(e){return new(e||o)(c(U))};static \u0275cmp=S({type:o,selectors:[["app-serial-key-filterbar"]],outputs:{filterChange:"filterChange"},standalone:!1,decls:46,vars:10,consts:[[1,"filterbar","mb-3"],[1,"row","g-3","align-items-end",3,"formGroup"],[1,"col-md"],["for","type",1,"form-label","small","mb-1"],["id","type","formControlName","type",1,"form-control"],[3,"ngValue"],["for","sequenceStart",1,"form-label","small","mb-1"],["type","number","id","sequenceStart","formControlName","sequenceStart",1,"form-control"],["for","sequenceEnd",1,"form-label","small","mb-1"],["type","number","id","sequenceEnd","formControlName","sequenceEnd",1,"form-control"],["for","dateFrom",1,"form-label","small","mb-1"],["type","date","id","dateFrom","formControlName","dateFrom",1,"form-control"],["for","dateTo",1,"form-label","small","mb-1"],["type","date","id","dateTo","formControlName","dateTo",1,"form-control"],["for","status",1,"form-label","small","mb-1"],["id","status","formControlName","status",1,"form-control"],[1,"col-auto"],[1,"btn","btn-primary","w-100","d-flex","align-items-center","justify-content-center","gap-2",3,"click","disabled"],[1,"bi","bi-search"]],template:function(e,t){e&1&&(n(0,"div",0)(1,"form",1)(2,"div",2)(3,"label",3),a(4,"Type"),r(),n(5,"select",4)(6,"option",5),a(7,"All"),r(),n(8,"option",5),a(9,"Card"),r(),n(10,"option",5),a(11,"Token"),r()()(),n(12,"div",2)(13,"label",6),a(14,"Sequence Start"),r(),u(15,"input",7),r(),n(16,"div",2)(17,"label",8),a(18,"Sequence End"),r(),u(19,"input",9),r(),n(20,"div",2)(21,"label",10),a(22,"From*"),r(),u(23,"input",11),r(),n(24,"div",2)(25,"label",12),a(26,"To*"),r(),u(27,"input",13),r(),n(28,"div",2)(29,"label",14),a(30,"Status"),r(),n(31,"select",15)(32,"option",5),a(33,"All"),r(),n(34,"option",5),a(35,"Created"),r(),n(36,"option",5),a(37,"Delivered"),r(),n(38,"option",5),a(39,"Assigned"),r(),n(40,"option",5),a(41,"Inactive"),r()()(),n(42,"div",16)(43,"button",17),b("click",function(){return t.onSubmit()}),u(44,"i",18),a(45," Search "),r()()()()),e&2&&(m(),l("formGroup",t.filterForm),m(5),l("ngValue",null),m(2),l("ngValue",t.eSerialType.Card),m(2),l("ngValue",t.eSerialType.Token),m(22),l("ngValue",null),m(2),l("ngValue",t.eStatusType.Created),m(2),l("ngValue",t.eStatusType.Delivered),m(2),l("ngValue",t.eStatusType.Assigned),m(2),l("ngValue",t.eStatusType.Inactive),m(3),l("disabled",t.filterForm.invalid))},dependencies:[O,j,G,x,M,A,D,K,P,V],encapsulation:2})};function $e(o,i){if(o&1&&(le(0),u(1,"app-serial-number-table",9),se()),o&2){let e=ue();m(),l("models",e.models)}}function Qe(o,i){o&1&&(n(0,"div",10)(1,"div"),u(2,"i",11),n(3,"p",4),a(4,"Key records not found."),r()()())}var L=class o extends _e{constructor(e,t,s,p){super(p);this.authService=t;this.settingService=s;this.modelService=e}setting;user;getFilterParams(){let e=[],t=this.modelFilters;return t.type&&e.push({otpType:y(t.type)}),(t.status!==void 0||t.status!==null)&&e.push({status:y(t.status)}),t.dateFrom&&e.push({createdDate:X(t.dateFrom.date())}),t.dateTo&&e.push({createdDate:Y(t.dateTo.date())}),t.sequenceStart&&e.push({sequenceNumber:X(t.sequenceStart)}),t.sequenceEnd&&e.push({sequenceNumber:Y(t.sequenceEnd)}),e}ngOnInit(){this.settingService.find().then(e=>{this.setting=e}),this.user=this.authService.authUser()}applyFilters(){this.loadModels().then()}openDialog(e){return I(this,null,function*(){(yield this.dialog.open(R,{user:this.user,setting:this.setting},{width:"22.5%"})).closed.subscribe(s=>{})})}static \u0275fac=function(t){return new(t||o)(c(f),c(Fe),c(h),c(oe))};static \u0275cmp=S({type:o,selectors:[["app-serial-number"]],standalone:!1,features:[me],decls:12,vars:2,consts:[["button",""],["noData",""],[1,"container-fluid","py-4","d-flex","flex-column","vh-100"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"mb-0"],[1,"btn","btn-danger","text-white",3,"click"],[1,"bi","bi-plus-lg","me-1"],[3,"filterChange"],[4,"ngIf","ngIfElse"],[3,"models"],[1,"d-flex","justify-content-center","align-items-center","h-100","text-muted","text-center","px-4"],[1,"bi","bi-search","display-6","d-block","mb-2"]],template:function(t,s){if(t&1){let p=pe();n(0,"div",2)(1,"div",3)(2,"h2",4),a(3,"OTP Keys"),r(),n(4,"button",5,0),b("click",function(){return z(p),J(s.addModel())}),u(6,"i",6),a(7,"Create Key "),r()(),n(8,"app-serial-key-filterbar",7),b("filterChange",function(Me){return z(p),J(s.onFilterChange(Me))}),r(),F(9,$e,2,1,"ng-container",8)(10,Qe,5,0,"ng-template",null,1,fe),r()}if(t&2){let p=ce(11);m(9),l("ngIf",s.models.length>0)("ngIfElse",p)}},dependencies:[Se,$,Q],encapsulation:2})};var Le=[{path:"",component:L}],Ke=class o{static \u0275fac=function(e){return new(e||o)};static \u0275mod=ae({type:o});static \u0275inj=re({providers:[h,f],imports:[ke,ye,ge.forChild(Le),Ee,we]})};export{Ke as SerialNumberModule};
