import{a as Q,c as B}from"./chunk-US63IDYQ.js";import{a as c}from"./chunk-SCDNKRCR.js";import{$ as O,Ab as F,Sb as _,Tb as j,Ua as I,W as E,c as P,eb as K,fb as x,gb as r,ib as w,jb as q,qb as p,tb as A,u as b,ub as M,v as R,vb as L,wb as S,x as f}from"./chunk-PTWT3WXO.js";import{g as C,h as N}from"./chunk-ENRHZQ2S.js";var z=(i=>(i[i.Created=0]="Created",i[i.Manufacturing=1]="Manufacturing",i[i.Delivered=2]="Delivered",i[i.Assigned=3]="Assigned",i[i.Void=4]="Void",i[i.Unknown=-1]="Unknown",i))(z||{}),U={otpType:"otptype",bankCode:"bank_cd",branchCode:"branch_cd",sequenceNumber:"seqno",otpKey:"otp_key",createdDate:"create_date",status:"status",manufacturingDispatchDate:"out_date",productDeliveryDate:"in_date",keyAssignedDate:"register_date"},d=class extends x{otpType=2;bankCode="";branchCode="";sequenceNumber=0;otpKey="";createdDate=new c;status=0;manufacturingDispatchDate;productDeliveryDate;keyAssignedDate;constructor(){super(),this._mapper=new M(U)}getSoftDelete(){}getPrimaryKeyName(){return"sequenceNumber"}setCreatedDate(e){this.createdDate=new c(e)}setStatus(e){this.status=Number(e)}setOtpType(e){this.otpType=Number(e)}};C([S("seqno")],d.prototype,"sequenceNumber",2),d=C([L("keymst")],d);var g=class a extends A{constructor(e){super(e,d)}getName(){return"serialkey"}generateKey(e){return this.http.post(this.url(),e,{headers:{service:"OTPSVR"}}).then(t=>{if(t?.result.toLocaleLowerCase()==="error")throw console.error(t),t})}getCount(e){let o=this.processQueryParams(this.getQueryBuilder(),e).aggregate({count:"sequenceNumber"}).buildParameterized();return this.http.post(this.url(),p(o)).then(s=>Number(s[0].count_sequenceNumber)||0)}getLastMaxCount(e,t,o){let n=this.getQueryBuilder().aggregate({max:"sequenceNumber"}).where("bankCode",r(e)).where("branchCode",r(t)).where("otpType",r(o)).select().buildParameterized();return this.http.post(this.url(),p(n)).then(i=>Number(i[0].max_sequenceNumber)||0)}getAssignableKeys(e,t,o,s){let n=[{status:r(2)},{bankCode:r(e)},{branchCode:r(t)},{seqNumber:r(s)}];return o&&n.push({otpType:r(o)}),s&&n.push({seqNumber:r(s)}),this.get(n).then(i=>i.sort((u,l)=>u.sequenceNumber-l.sequenceNumber))}getFreshKeys(e,t){return this.get([{status:r(2)},{bankCode:r(e)},{branchCode:r(t)}]).then(o=>o.sort((s,n)=>s.sequenceNumber-n.sequenceNumber))}getAssignedKeys(e,t,o){return o||(o=[]),this.get([{status:r(3),bankCode:r(e),branchCode:r(t)}]).then(s=>s.sort((n,i)=>n.sequenceNumber-i.sequenceNumber))}sendForManufacturing(e,t,o,s){let i=this.getQueryBuilder().where("sequenceNumber",w(o)).where("sequenceNumber",q(s)).where("bankCode",r(e)).where("branchCode",r(t)).update({status:1,manufacturingDispatchDate:new c},!1).buildParameterized();return this.http.post(this.url(),p(i)).then()}markAsDelivered(e,t,o,s){let i=this.getQueryBuilder().where("sequenceNumber",w(o)).where("sequenceNumber",q(s)).where("bankCode",r(e)).where("branchCode",r(t)).update({status:2,productDeliveryDate:new c},!1).buildParameterized();return this.http.post(this.url(),p(i)).then()}markAsAssigned(e,t,o){let n=this.getQueryBuilder().where("sequenceNumber",r(o)).where("bankCode",r(e)).where("branchCode",r(t)).update({status:3,keyAssignedDate:new c},!1).buildParameterized();return this.http.post(this.url(),p(n)).then()}voidProduct(e,t,o){let n=this.getQueryBuilder().where("sequenceNumber",r(o)).where("bankCode",r(e)).where("branchCode",r(t)).update({status:4},!1).buildParameterized();return this.http.post(this.url(),p(n)).then()}static \u0275fac=function(t){return new(t||a)(f(F))};static \u0275prov=b({token:a,factory:a.\u0275fac})};var y=class{constructor(e){this.closeFn=e}_closed=new P;closed=this._closed.asObservable();close(e){this._closed.next(e),this._closed.complete(),this.closeFn(e)}};var v=class a{constructor(e){this.appRef=e}getOptions(e){return{clickToClose:e?.clickToClose??!0,className:e?.className??"",width:e?.width??"auto"}}open(e,t,o,s=!0){let{clickToClose:n,className:i}=this.getOptions(o),u=document.createElement("div"),l=document.createElement("div");l.classList.add("modal-dialog"),i&&u.classList.add(...i.split(" ")),o?.width&&(l.style.width=o.width),u.appendChild(l),u.classList.add("dialog-wrapper","tsway-modal","fade-in");let T=()=>N(this,null,function*(){u.classList.remove("fade-in"),yield this.delay(50),u.classList.add("fade-out"),yield this.delay(300),this.appRef.detachView(h.hostView),h.destroy(),u&&document.body.removeChild(u),document.removeEventListener("keyup",D)}),D=m=>{m.key==="Escape"&&(T(),document.removeEventListener("keyup",D))};if(document.addEventListener("keyup",D),s){let m=document.createElement("div");m.classList.add("dialog-overlay","position-fixed","top-0","start-0","w-100","h-100","bg-dark","opacity-50"),u.appendChild(m),n&&u.addEventListener("click",H=>{H.target===m&&T()})}document.body.appendChild(u);let h=this.appRef.bootstrap(e,l);if(t)for(let m in t)h.setInput(m,t[m]);let k=new y(T);return h.instance.dialogRef=k,Promise.resolve(k)}delay(e){return new Promise(t=>setTimeout(t,e))}static \u0275fac=function(t){return new(t||a)(f(O))};static \u0275prov=b({token:a,factory:a.\u0275fac})};var G=class a{static \u0275fac=function(t){return new(t||a)};static \u0275mod=E({type:a});static \u0275inj=R({providers:[v,Q,g],imports:[j,I,K,B,_]})};export{v as a,z as b,g as c,G as d};
