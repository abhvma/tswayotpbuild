import{$a as q,Bb as W,D as K,Ia as L,J as A,Ja as v,Ka as t,La as z,Ma as I,Na as E,Ua as m,Xa as F,_a as H,ab as P,bb as M,c as B,cb as U,fb as j,j as k,k as Y,m as N,xb as G,ya as Q,yb as V,zb as J}from"./chunk-N56VVWT6.js";import{g as h,h as D}from"./chunk-ENRHZQ2S.js";function y(u,e="YYYY-MM-DD HH:mm:ss"){let n={YYYY:u.getFullYear().toString(),MM:String(u.getMonth()+1).padStart(2,"0"),DD:String(u.getDate()).padStart(2,"0"),HH:String(u.getHours()).padStart(2,"0"),mm:String(u.getMinutes()).padStart(2,"0"),ss:String(u.getSeconds()).padStart(2,"0")};return e.replace(/YYYY|MM|DD|HH|mm|ss/g,r=>n[r])}var c=class u extends Date{static afterYear(e){return new u(Date.now()+e*365*24*60*60*1e3)}toString(){return y(this)}date(e){return F(e)?this.format("YYYY-MM-DD"):e===!0?this.format("YYYY-MM-DD 00:00:00"):this.format("YYYY-MM-DD 23:59:59")}time(){return this.format("HH:mm:ss")}format(e="YYYY-MM-DD"){return y(this,e)}};var te=(r=>(r[r.Active=1]="Active",r[r.Lock=2]="Lock",r[r.Delete=3]="Delete",r))(te||{}),x=(s=>(s[s.Mobile=1]="Mobile",s[s.Card=2]="Card",s[s.Token=3]="Token",s[s.Console=4]="Console",s))(x||{}),re={1:"Mobile",2:"Card",3:"Token",4:"Console"};var ne={customerId:"custom_id",serialNumber:"serial_num",bankCode:"bank_code",bankName:"bank_name",branchName:"branch_name",branchCode:"branch_code",mobile:"mobile",customerName:"custom_name",email:"email",registeredBank:"regist_bank",registeredBankName:"regist_bankname",registeredDate:"resgist_date",lastUseDate:"lastuse_date",status:"status",otpType:"otptype"},f=class extends v{customerId="";bankCode="";bankName="";mobile="";customerName="";email="";registeredBank="";registeredBankName="";branchName="";branchCode="";registeredDate=new c;lastUseDate=new c;status=1;otpType=1;serialNumber="";key;constructor(){super(),this._mapper=new q(ne)}getPrimaryKeyName(){return"customerId"}getSoftDelete(){return{status:z(3)}}setRegisteredDate(e){return this.registeredDate=new c(e),this.registeredDate}setLastUseDate(e){return this.lastUseDate=new c(e),this.lastUseDate}getRegisteredDate(){return y(this.registeredDate)}getLastUseDate(){return y(this.lastUseDate)}setOtpType(e){this.otpType=Number(e)}getOtpTypeLabel(){return re[this.otpType]||"Unknown"}};h([M("custom_id")],f.prototype,"customerId",2),h([U()],f.prototype,"key",2),f=h([P("cifmst")],f);var X=(o=>(o[o.Created=0]="Created",o[o.Registered=1]="Registered",o[o.Enrolled=2]="Enrolled",o[o.Active=3]="Active",o[o.Revoked=4]="Revoked",o[o.Unknown=-1]="Unknown",o))(X||{}),ie={otpType:"otptype",bankCode:"bank_cd",branchCode:"branch_cd",sequenceNumber:"seqno",otpKey:"otp_key",createdDate:"create_date",status:"status",manufacturingDispatchDate:"out_date",productDeliveryDate:"in_date",keyAssignedDate:"register_date"},g=class extends v{otpType=2;bankCode="";branchCode="";sequenceNumber=0;otpKey="";createdDate=new c;status=0;manufacturingDispatchDate;productDeliveryDate;keyAssignedDate;constructor(){super(),this._mapper=new q(ie)}getSoftDelete(){}getPrimaryKeyName(){return"sequenceNumber"}setManufacturingDispatchDate(e){if(!e||e&&e.trim()===""){this.manufacturingDispatchDate=void 0;return}this.manufacturingDispatchDate=new c(e)}setProductDeliveryDate(e){if(!e||e&&e.trim()===""){this.productDeliveryDate=void 0;return}this.productDeliveryDate=new c(e)}setKeyAssignedDate(e){if(!e||e&&e.trim()===""){this.keyAssignedDate=void 0;return}this.keyAssignedDate=new c(e)}setCreatedDate(e){this.createdDate=new c(e)}setStatus(e){this.status=Number(e)}setOtpType(e){this.otpType=Number(e)}setSequenceNumber(e){this.sequenceNumber=Number(e)}};h([M("seqno")],g.prototype,"sequenceNumber",2),g=h([P("keymst")],g);var O=class u extends H{constructor(e){super(e,g)}getName(){return"serialkey"}generateKey(e){return this.http.post(this.url(),e,{headers:{service:"OTPSVR"}}).then(n=>{if(n?.result.toLocaleLowerCase()==="error")throw console.error(n),n})}getStats(e,n){return D(this,null,function*(){let r=this.getQueryBuilder();r.aggregate({count:"sequenceNumber"}).where("otpType",t(2)).where("bankCode",t(e)).where("branchCode",t(n));let s=yield this.http.post(this.url(),m(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(2)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(0));let p=yield this.http.post(this.url(),m(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(2)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(1));let o=yield this.http.post(this.url(),m(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(2)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(2));let a=yield this.http.post(this.url(),m(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(2)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(3));let l=yield this.http.post(this.url(),m(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(2)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(4));let C=yield this.http.post(this.url(),m(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(3)).where("bankCode",t(e)).where("branchCode",t(n));let w=yield this.http.post(this.url(),m(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(3)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(0));let b=yield this.http.post(this.url(),m(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(3)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(1));let T=yield this.http.post(this.url(),m(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(3)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(2));let d=yield this.http.post(this.url(),m(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(3)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(3));let R=yield this.http.post(this.url(),m(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(3)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(4));let ee=yield this.http.post(this.url(),m(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);return{totalCardCount:s||0,rawCardCount:p||0,registeredCardCount:o||0,enrolledCardCount:a||0,activeCardCount:l||0,inactiveCardCount:C||0,totalTokenCount:w||0,rawTokenCount:b||0,registeredTokenCount:T||0,enrolledTokenCount:d||0,activeTokenCount:R||0,inactiveTokenCount:ee||0}})}getCount(e){let r=this.processQueryParams(this.getQueryBuilder(),e).aggregate({count:"sequenceNumber"}).buildParameterized();return this.http.post(this.url(),m(r)).then(s=>Number(s[0].count_sequenceNumber)||0)}getLastMaxCount(e,n,r){let p=this.getQueryBuilder().aggregate({max:"sequenceNumber"}).where("bankCode",t(e)).where("branchCode",t(n)).where("otpType",t(r)).select().buildParameterized();return this.http.post(this.url(),m(p)).then(o=>Number(o[0].max_sequenceNumber)||0)}getAssignableKeys(e,n,r,s){let p=[{status:t(2)},{bankCode:t(e)},{branchCode:t(n)}];return r&&p.push({otpType:t(r)}),s&&p.push({sequenceNumber:t(s)}),this.get(p).then(o=>o.sort((a,l)=>a.sequenceNumber-l.sequenceNumber))}getFreshKeys(e,n,r){return this.get([{otpType:t(r)},{status:t(2)},{bankCode:t(e)},{branchCode:t(n)}]).then(s=>s.sort((p,o)=>p.sequenceNumber-o.sequenceNumber))}getAssignedKeys(e,n,r,s){return s||(s=[]),this.get([{otpType:t(r),status:t(3),bankCode:t(e),branchCode:t(n)}]).then(p=>p.sort((o,a)=>o.sequenceNumber-a.sequenceNumber))}getRangesForStatus(e,n,r,s){let o=this.getQueryBuilder().where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(s)).where("otpType",t(r)).aggregate({min:"sequenceNumber",max:"sequenceNumber"}).select().buildParameterized();return this.http.post(this.url(),m(o)).then(a=>a.length>0?isNaN(a[0].min_sequenceNumber)||isNaN(a[0].max_sequenceNumber)?[0,0]:[+a[0].min_sequenceNumber,+a[0].max_sequenceNumber]:[0,0])}sendForManufacturing(e,n,r,s,p){let a=this.getQueryBuilder().where("sequenceNumber",I(s)).where("sequenceNumber",E(p)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(0)).where("otpType",t(r)).update({status:1,manufacturingDispatchDate:new c},!1).buildParameterized();return this.http.post(this.url(),m(a)).then()}markAsDelivered(e,n,r,s,p){let a=this.getQueryBuilder().where("sequenceNumber",I(s)).where("sequenceNumber",E(p)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(1)).where("otpType",t(r)).update({status:2,productDeliveryDate:new c},!1).buildParameterized();return this.http.post(this.url(),m(a)).then()}markAsAssigned(e,n,r,s){let o=this.getQueryBuilder().where("sequenceNumber",t(s)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(2)).where("otpType",t(r)).update({status:3,keyAssignedDate:new c},!1).buildParameterized();return this.http.post(this.url(),m(o)).then()}voidProduct(e,n,r,s){let o=this.getQueryBuilder().where("sequenceNumber",t(s)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(3)).where("otpType",t(r)).update({status:4},!1).buildParameterized();return this.http.post(this.url(),m(o)).then()}static \u0275fac=function(n){return new(n||u)(N(j))};static \u0275prov=k({token:u,factory:u.\u0275fac})};var _=class{constructor(e){this.closeFn=e}_closed=new B;closed=this._closed.asObservable();close(e){this._closed.next(e),this._closed.complete(),this.closeFn(e)}};var S=class u{constructor(e){this.appRef=e}getOptions(e){return{clickToClose:e?.clickToClose??!0,className:e?.className??"",width:e?.width??"auto"}}open(e,n,r,s=!0){let{clickToClose:p,className:o}=this.getOptions(r),a=document.createElement("div"),l=document.createElement("div");l.classList.add("modal-dialog"),o&&a.classList.add(...o.split(" ")),r?.width&&(l.style.width=r.width),a.appendChild(l),a.classList.add("dialog-wrapper","tsway-modal","fade-in");let C=()=>D(this,null,function*(){a.classList.remove("fade-in"),yield this.delay(50),a.classList.add("fade-out"),yield this.delay(300),this.appRef.detachView(b.hostView),b.destroy();try{a&&document.body.removeChild(a)}catch{}document.removeEventListener("keyup",w)}),w=d=>{d.key==="Escape"&&(C(),document.removeEventListener("keyup",w))};if(document.addEventListener("keyup",w),s){let d=document.createElement("div");d.classList.add("dialog-overlay","position-fixed","top-0","start-0","w-100","h-100","bg-dark","opacity-50"),a.appendChild(d),p&&a.addEventListener("click",R=>{R.target===d&&C()})}document.body.appendChild(a);let b=this.appRef.bootstrap(e,l);if(n)for(let d in n)b.setInput(d,n[d]);let T=new _(C);return b.instance.dialogRef=T,Promise.resolve(T)}delay(e){return new Promise(n=>setTimeout(n,e))}static \u0275fac=function(n){return new(n||u)(N(A))};static \u0275prov=k({token:u,factory:u.\u0275fac})};var $=class u{static \u0275fac=function(n){return new(n||u)};static \u0275mod=K({type:u});static \u0275inj=Y({providers:[S,J,O],imports:[V,Q,L,W,G]})};export{S as a,c as b,te as c,x as d,f as e,X as f,O as g,$ as h};
