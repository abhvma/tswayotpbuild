import{a as ae}from"./chunk-ECNNFCQD.js";import{b as M}from"./chunk-ABQ7LOC7.js";import{a as O,b as _e,c as E}from"./chunk-BT4FQVWO.js";import{a as le,b as me}from"./chunk-YN33KCBA.js";import{b}from"./chunk-7ZFS4USX.js";import{b as de}from"./chunk-BZE4WTPC.js";import{a as se,c as ce}from"./chunk-EZDIJFPR.js";import"./chunk-XFLVNJYL.js";import{a as oe}from"./chunk-HVPVQXOI.js";import{A as C,Ab as ee,B as U,Bb as te,Ca as z,Cb as ie,D as B,E as v,Fb as re,Gb as ne,Ma as y,N as a,Na as _,Oa as H,R as p,U as g,V,Y as j,Z as m,_a as J,aa as l,ea as o,fa as i,ga as u,ha as q,ia as G,ja as I,ka as f,la as c,sa as $,ta as s,tb as K,u as D,ua as x,ub as w,va as F,vb as Q,wa as L,wb as W,xb as X,yb as Y,z as A,zb as Z}from"./chunk-RA2IBNNK.js";import{f as ge,h as S}from"./chunk-ENRHZQ2S.js";var fe=ge(_e());function Ce(t,n){if(t&1&&(o(0,"option",21),s(1),i()),t&2){let e=n.$implicit;l("value",e.branchCode),a(),F(" ",e.branchName," ")}}function Ue(t,n){t&1&&(o(0,"div",22),s(1," Branch Name is required "),i())}function Ie(t,n){t&1&&(o(0,"div",22),s(1," Username is required and must be at least 3 characters long. "),i())}function we(t,n){t&1&&(o(0,"div",23),s(1," The username already exists. "),i())}function Se(t,n){if(t&1&&(o(0,"div"),s(1),i()),t&2){let e=c().ngIf;a(),F(" Password must be at least ",e.minLength.requiredLength," characters ")}}function xe(t,n){t&1&&(o(0,"div"),s(1," Password must contain at least one uppercase letter "),i())}function ye(t,n){t&1&&(o(0,"div"),s(1," Password must contain at least one lowercase letter "),i())}function Ee(t,n){t&1&&(o(0,"div"),s(1," Password must contain at least one special character "),i())}function Me(t,n){t&1&&(o(0,"div"),s(1," Password must contain at least one number "),i())}function Ne(t,n){if(t&1&&(o(0,"div"),m(1,Se,2,1,"div",24)(2,xe,2,0,"div",24)(3,ye,2,0,"div",24)(4,Ee,2,0,"div",24)(5,Me,2,0,"div",24),i()),t&2){let e=n.ngIf;a(),l("ngIf",e.minLength),a(),l("ngIf",e.uppercase),a(),l("ngIf",e.lowercase),a(),l("ngIf",e.specialChar),a(),l("ngIf",e.digit)}}function Te(t,n){if(t&1&&(o(0,"div",22),m(1,Ne,6,5,"div",24),i()),t&2){let e,r=c();a(),l("ngIf",(e=r.userForm.get("password"))==null?null:e.errors)}}function ke(t,n){t&1&&(o(0,"div",22),s(1," New Password didn't match "),i())}var N=class t{constructor(n,e,r){this.fb=n;this.authService=e;this.toast=r;this.userForm=this.fb.group({userId:["",w.required],password:["",[w.required,ae.password({digit:!0,lower:!0,upper:!0,length:8,special:!0})]],repeatPassword:["",w.required],branchName:[void 0,w.required]})}model;save=new v;cancel=new v;branchOptions=[];setting;authUser;branchMap={};bankMap={};modalTitle="Add User";userForm;eCustomerStatus=le;eOtpType=me;dialogRef;userNotUnique=!1;ngOnInit(){}_createBranchMap(){this.branchOptions.forEach(n=>{this.branchMap[n.branchCode]=n.branchName})}ngOnChanges(n){this._createBranchMap(),this.modalTitle=(this.model,"Edit User");let e=this.model||new O;this.userForm.patchValue({userId:e.userId,branchName:this.authUser.branchName})}onSave(){return S(this,null,function*(){let n=new oe;try{if(n.show(),this.userNotUnique=!1,this.userForm.valid){let e=new O;if(e.fill(this.userForm.value),e.password=(0,fe.sha256)(e.password),this.model)yield this.authService.update(e),this.toast.success("Customer information updated successfully.");else{if(!(yield this.authService.verifyUserIsUnique(e))){n.hide(),this.userNotUnique=!0;return}yield this.authService.create(e),this.toast.success("Customer added successfully.")}this.save.emit(this.userForm.value),this.dialogRef.close(e),n.hide()}else this.userForm.markAllAsTouched()}catch{}finally{n.hide()}})}onCancel(){this.dialogRef.close(void 0),this.cancel.emit()}get formControls(){return this.userForm.controls}static \u0275fac=function(e){return new(e||t)(p(re),p(E),p(se))};static \u0275cmp=g({type:t,selectors:[["app-user-create-modal"]],inputs:{model:"model",branchOptions:"branchOptions",setting:"setting",authUser:"authUser"},outputs:{save:"save",cancel:"cancel"},standalone:!1,features:[L([b]),A],decls:34,vars:8,consts:[[1,"modal-content"],[1,"tsway-modal-header"],[1,"tsway-modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"tsway-modal-body"],[1,"row",3,"formGroup"],[1,"mb-3","col-md-12"],["for","branchName",1,"form-label"],["id","branchName","formControlName","branchName",1,"form-control"],[3,"value",4,"ngFor","ngForOf"],["class","text-danger",4,"ngIf"],["for","userId",1,"form-label"],["id","userId","formControlName","userId","placeholder","Enter Username",1,"form-control"],["class","text-danger","role","alert",4,"ngIf"],["for","password",1,"form-label"],["type","password","id","password","formControlName","password","placeholder","Password",1,"form-control"],["for","repeatPassword",1,"form-label"],["type","password","id","repeatPassword","formControlName","repeatPassword","placeholder","Repeat Password",1,"form-control"],[1,"tsway-modal-footer"],[1,"btn","btn-danger","me-2","text-white",3,"click"],[1,"btn","btn-primary",3,"click","disabled"],[3,"value"],[1,"text-danger"],["role","alert",1,"text-danger"],[4,"ngIf"]],template:function(e,r){e&1&&(o(0,"div",0)(1,"div",1)(2,"h5",2),s(3,"Add User"),i(),o(4,"button",3),f("click",function(){return r.onCancel()}),i()(),o(5,"div",4)(6,"form",5)(7,"div",6)(8,"label",7),s(9,"Branch Name"),i(),o(10,"select",8),m(11,Ce,2,2,"option",9),i(),m(12,Ue,2,0,"div",10),i(),o(13,"div",6)(14,"label",11),s(15,"Username"),i(),u(16,"input",12),m(17,Ie,2,0,"div",10)(18,we,2,0,"div",13),i(),o(19,"div",6)(20,"label",14),s(21,"Password"),i(),u(22,"input",15),m(23,Te,2,1,"div",10),i(),o(24,"div",6)(25,"label",16),s(26,"Repeat Password"),i(),u(27,"input",17),m(28,ke,2,0,"div",10),i()()(),o(29,"div",18)(30,"button",19),f("click",function(){return r.onCancel()}),s(31," Cancel "),i(),o(32,"button",20),f("click",function(){return r.onSave()}),s(33," Save "),i()()()),e&2&&(a(6),l("formGroup",r.userForm),a(5),l("ngForOf",r.branchOptions),a(),l("ngIf",r.formControls.branchName.touched&&r.formControls.branchName.invalid),a(5),l("ngIf",r.formControls.userId.touched&&r.formControls.userId.invalid),a(),l("ngIf",r.userNotUnique),a(5),l("ngIf",r.formControls.password.touched&&r.formControls.password.invalid),a(5),l("ngIf",r.formControls.repeatPassword.touched&&r.formControls.repeatPassword.value!==r.formControls.password.value),a(4),l("disabled",r.userForm.invalid))},dependencies:[y,_,X,te,ie,K,ee,Q,W,Y,Z],styles:["[_nghost-%COMP%]{font-size:.875rem!important}"]})};function Fe(t,n){if(t&1&&(o(0,"th",3),s(1),i()),t&2){let e=n.$implicit;l("width",e.width),a(),x(e.label)}}function Oe(t,n){if(t&1){let e=I();o(0,"button",5),f("click",function(){C(e);let d=c(),h=d.$implicit,R=d.index,ve=c();return U(ve.deleteClick.emit({model:h,index:R}))}),u(1,"i",6),s(2," Delete "),i()}}function Pe(t,n){if(t&1&&(o(0,"tr")(1,"td"),s(2),i(),o(3,"td"),s(4),i(),o(5,"td"),m(6,Oe,3,0,"button",4),i()()),t&2){let e=n.$implicit,r=c();a(2),x(e.userId),a(2),x(r.branchMaps[e.branchName]||e.branchName),a(2),l("ngIf",r.currentUser.userId!==e.userId)}}var T=class t{models=[];branchMaps={};editClick=new v;deleteClick=new v;currentUser;columns=[{label:"Username",width:"10%"},{label:"Branch",width:"60%"},{label:"Action",width:"15%"}];static \u0275fac=function(e){return new(e||t)};static \u0275cmp=g({type:t,selectors:[["app-user-table"]],inputs:{models:"models",branchMaps:"branchMaps",currentUser:"currentUser"},outputs:{editClick:"editClick",deleteClick:"deleteClick"},standalone:!1,decls:6,vars:2,consts:[[1,"tsway-datatable","striped"],[3,"width",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[3,"width"],["class","btn btn-sm btn-danger btn-long text-white",3,"click",4,"ngIf"],[1,"btn","btn-sm","btn-danger","btn-long","text-white",3,"click"],[1,"bi","bi-trash"]],template:function(e,r){e&1&&(o(0,"table",0)(1,"thead")(2,"tr"),m(3,Fe,2,2,"th",1),i()(),o(4,"tbody"),m(5,Pe,7,3,"tr",2),i()()),e&2&&(a(3),l("ngForOf",r.columns),a(2),l("ngForOf",r.models))},dependencies:[y,_],encapsulation:2})};function De(t,n){if(t&1){let e=I();q(0),o(1,"app-user-table",8),f("deleteClick",function(d){C(e);let h=c();return U(h.deleteModel(d))}),i(),G()}if(t&2){let e=c();a(),l("models",e.models)("branchMaps",e.branchMaps)("currentUser",e.currentUser)}}function Ae(t,n){t&1&&(o(0,"div",9)(1,"div"),u(2,"i",10),o(3,"p",4),s(4,"No Users found."),i()()())}var k=class t extends de{constructor(e,r,d,h){super(r);this.settingService=d;this.bankService=h;this.modelService=e}currentUser;setting;branches=[];branchMaps={};ngOnInit(){this.loadModels().then(),this.currentUser=this.modelService.authUser(),this.settingService.get().then(e=>{this.setting=e[0]}),this.bankService.get().then(e=>{this.branches=e,this.branches.forEach(r=>{this.branchMaps[r.branchCode]=r.branchName})})}applyFilters(){}openDialog(e){return S(this,null,function*(){(yield this.dialog.open(N,{model:e,setting:this.setting,authUser:this.currentUser,branchOptions:this.branches},{width:"22.5%"})).closed.subscribe(d=>this.models.push(d))})}static \u0275fac=function(r){return new(r||t)(p(E),p(B),p(b),p(M))};static \u0275cmp=g({type:t,selectors:[["app-user"]],standalone:!1,features:[j],decls:11,vars:2,consts:[["button",""],["noData",""],[1,"container-fluid","py-4","d-flex","flex-column","vh-100"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"mb-0"],[1,"btn","btn-danger","text-white",3,"click"],[1,"bi","bi-plus-lg","me-1"],[4,"ngIf","ngIfElse"],[3,"deleteClick","models","branchMaps","currentUser"],[1,"d-flex","justify-content-center","align-items-center","h-100","text-muted","text-center","px-4"],[1,"bi","bi-search","display-6","d-block","mb-2"]],template:function(r,d){if(r&1){let h=I();o(0,"div",2)(1,"div",3)(2,"h2",4),s(3,"Users"),i(),o(4,"button",5,0),f("click",function(){return C(h),U(d.addModel())}),u(6,"i",6),s(7,"Add New User "),i()(),m(8,De,2,3,"ng-container",7)(9,Ae,5,0,"ng-template",null,1,z),i()}if(r&2){let h=$(10);a(8),l("ngIf",d.models.length>0)("ngIfElse",h)}},dependencies:[_,T],encapsulation:2})};var Be=[{path:"",component:k}],he=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=V({type:t});static \u0275inj=D({providers:[M,b],imports:[ce,H,J.forChild(Be),ne]})};export{he as UserModule};
