import{a as fe,b as _e,c as C}from"./chunk-RCHMHXMA.js";import{a as we,b as J,c as L}from"./chunk-OH5PDCZN.js";import"./chunk-KH7BRNI5.js";import{a as j,b as Ce,c as Se}from"./chunk-KCQXTRPB.js";import{a as de}from"./chunk-ZGDWY67E.js";import{a as P}from"./chunk-HVPVQXOI.js";import{$a as se,Ab as D,Bb as A,Cb as ve,Db as ge,E as Y,Eb as he,Hb as B,Ib as be,Ma as N,N as s,Na as ne,Oa as ie,R as l,U as p,V as x,Wa as oe,Ya as re,Z as u,Za as ae,_a as $,aa as d,ca as Z,ea as o,fa as i,ga as m,ib as le,ka as c,la as ee,nb as me,ob as ce,pb as pe,t as W,ta as a,u as M,ua as _,ub as ue,va as h,vb as E,w as X,wa as I,wb as S,xa as te,xb as O,yb as T,zb as F}from"./chunk-WNWZG4BB.js";import{f as xe,g as Q,h as k}from"./chunk-ENRHZQ2S.js";var Ne=()=>({exact:!0});function Ee(t,n){if(t&1&&(o(0,"li",6)(1,"a",11),m(2,"i"),a(3),i()()),t&2){let e=n.$implicit;s(),d("routerLink",e.path)("routerLinkActiveOptions",te(5,Ne)),s(),Z("bi "+e.icon),s(),h(" ",e.label," ")}}var R=class t{constructor(n){this.authService=n}brandName="OTP Management System";navLinks=[{label:"Dashboard",path:"/manage",icon:"bi-speedometer2"},{label:"Customers",path:"/manage/customers",icon:"bi-people"},{label:"Transaction Logs",path:"/manage/transactions",icon:"bi-file-earmark-text"},{label:"OTP Logs",path:"/manage/otplogs",icon:"bi-shield-lock"},{label:"Users",path:"/manage/users",icon:"bi-people"},{label:"Settings",path:"/manage/settings",icon:"bi-gear"}];logoutClick(){this.authService.logout()}static \u0275fac=function(e){return new(e||t)(l(C))};static \u0275cmp=p({type:t,selectors:[["app-navbar"]],standalone:!1,decls:15,vars:2,consts:[[1,"sidebar","d-flex","flex-column","p-3","bg-primary","text-white"],[1,"sidebar-rounded"],[1,"brand-container"],[1,"brandname","fs-5","fw-bold","text-decoration-none"],[1,"nav","nav-pills","flex-column"],["class","nav-item mb-2",4,"ngFor","ngForOf"],[1,"nav-item","mb-2"],["role","button",1,"nav-link","d-flex","align-items-center","gap-2",3,"click"],[1,"bi","bi-box-arrow-right"],["role","button",1,"nav-link","d-flex","align-items-center","gap-2"],[1,"bi","bi-file-earmark-pdf"],["routerLinkActive","active",1,"nav-link","d-flex","align-items-center","gap-2",3,"routerLink","routerLinkActiveOptions"]],template:function(e,r){e&1&&(o(0,"aside",0)(1,"div",1)(2,"div",2)(3,"a",3),a(4),i()(),o(5,"ul",4),u(6,Ee,4,6,"li",5),o(7,"li",6)(8,"a",7),c("click",function(){return r.logoutClick()}),m(9,"i",8),a(10," Logout"),i()(),o(11,"li",6)(12,"a",9),m(13,"i",10),a(14," Download Manual"),i()()()()()),e&2&&(s(4),h(" ",r.brandName," "),s(2),d("ngForOf",r.navLinks))},dependencies:[N,re,ae],styles:[".sidebar[_ngcontent-%COMP%]{position:fixed;height:100vh;width:16rem;top:0;left:0;padding-top:1rem;z-index:1000}.brand-container[_ngcontent-%COMP%]{margin-bottom:2rem}.brandname[_ngcontent-%COMP%]{color:var(--bs-white-rgb);margin-bottom:3rem}.nav-link.active[_ngcontent-%COMP%]{background-color:#0d6efd;color:#fff!important}.nav-link[_ngcontent-%COMP%]{color:var(--bs-white);background-color:transparent;border-radius:.375rem;transition:background-color .2s ease,color .2s ease}.nav-link[_ngcontent-%COMP%]:hover{background-color:rgba(var(--bs-white-rgb),.1);color:var(--bs-white)}.nav-link.active[_ngcontent-%COMP%]{background-color:var(--bs-danger);color:var(--bs-white)!important}.nav-link[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.1rem}"]})};var ke=xe(_e());function De(t,n){if(t&1&&(o(0,"div",17),a(1),i()),t&2){let e=ee();s(),_(e.errorMessage)}}function Ae(t,n){t&1&&(o(0,"div",17),a(1," Old Password is required "),i())}function Be(t,n){t&1&&(o(0,"div",17),a(1," New password is required "),i())}function je(t,n){t&1&&(o(0,"div",17),a(1," New password is required "),i())}function Le(t,n){t&1&&(o(0,"div",17),a(1," New Password didn't match "),i())}var U=class t{constructor(n,e,r){this.fb=n;this.toast=e;this.userService=r;this.form=this.fb.group({oldPassword:["",S.required],newPassword:["",[S.required,S.minLength(8)]],repeatPassword:["",[S.required,S.minLength(8)]]})}model;save=new Y;cancel=new Y;modalTitle="Change Password";errorMessage="";form;dialogRef;customerNotUnique=!1;onSave(){this.errorMessage="";let n=new P;this.form.value.oldPassword!==this.model.plainPassword&&(this.errorMessage="Your old password didn't match. Please try again");let r=new fe;r.fill({userId:this.model?.userId,password:(0,ke.sha256)(this.form.value.newPassword),branchName:this.model?.branchName,plainPassword:this.form.value.newPassword}),n.show(),this.userService.update(r).then(()=>{this.toast.success("Password updated successfully"),this.dialogRef.close(void 0)}).finally(()=>{n.hide()})}onCancel(){this.dialogRef.close(void 0),this.cancel.emit()}get formControls(){return this.form.controls}static \u0275fac=function(e){return new(e||t)(l(B),l(j),l(C))};static \u0275cmp=p({type:t,selectors:[["app-password-change-modal"]],inputs:{model:"model"},outputs:{save:"save",cancel:"cancel"},standalone:!1,features:[I([])],decls:29,vars:6,consts:[[1,"modal-content"],[1,"tsway-modal-header"],[1,"tsway-modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"tsway-modal-body"],["class","text-danger",4,"ngIf"],[1,"row",3,"formGroup"],[1,"mb-3","col-md-12"],["for","oldPasswod",1,"form-label"],["type","password","id","oldPassword","formControlName","oldPassword","placeholder","Old Password",1,"form-control"],["for","newPassword",1,"form-label"],["type","password","id","newPassword","formControlName","newPassword","placeholder","New Password",1,"form-control"],["for","repeatPassword",1,"form-label"],["type","password","id","repeatPassword","formControlName","repeatPassword","placeholder","Repeat Password",1,"form-control"],[1,"tsway-modal-footer"],[1,"btn","btn-danger","me-2","text-white",3,"click"],[1,"btn","btn-primary",3,"click"],[1,"text-danger"]],template:function(e,r){e&1&&(o(0,"div",0)(1,"div",1)(2,"h5",2),a(3,"Change Password"),i(),o(4,"button",3),c("click",function(){return r.onCancel()}),i()(),o(5,"div",4),u(6,De,2,1,"div",5),o(7,"form",6)(8,"div",7)(9,"label",8),a(10,"Old Password"),i(),m(11,"input",9),u(12,Ae,2,0,"div",5),i(),o(13,"div",7)(14,"label",10),a(15,"New Password"),i(),m(16,"input",11),u(17,Be,2,0,"div",5),i(),o(18,"div",7)(19,"label",12),a(20,"Repeat Password"),i(),m(21,"input",13),u(22,je,2,0,"div",5)(23,Le,2,0,"div",5),i()()(),o(24,"div",14)(25,"button",15),c("click",function(){return r.onCancel()}),a(26," Cancel "),i(),o(27,"button",16),c("click",function(){return r.onSave()}),a(28,"Save"),i()()()),e&2&&(s(6),d("ngIf",r.errorMessage),s(),d("formGroup",r.form),s(5),d("ngIf",r.formControls.oldPassword.touched&&r.formControls.oldPassword.invalid),s(5),d("ngIf",r.formControls.newPassword.touched&&r.formControls.newPassword.invalid),s(5),d("ngIf",r.formControls.repeatPassword.touched&&r.formControls.repeatPassword.invalid),s(),d("ngIf",r.formControls.repeatPassword.touched&&r.formControls.repeatPassword.value!==r.formControls.newPassword.value))},dependencies:[F,E,O,T,D,A,ne],styles:["[_nghost-%COMP%]{font-size:.875rem!important}"]})};var V=class t{constructor(n,e,r){this.authService=n;this.ctxMenuService=e;this.dialog=r}username="";navItems=[{label:"Change Password",enabled:!0,icon:"bi bi-key",name:"changepassword"}];ngOnInit(){this.username=this.authService.authUser()?.userId||""}ngAfterViewInit(){this.ctxMenuService.itemSelected.subscribe(n=>{n.name==="changepassword"&&this.dialog.open(U,{model:this.authService.authUser()},{width:"30%"})})}onAvatarClick(n){this.ctxMenuService.show(this.navItems,n.target,"bottom")}static \u0275fac=function(e){return new(e||t)(l(C),l(we),l(Ce))};static \u0275cmp=p({type:t,selectors:[["app-top-navbar"]],standalone:!1,decls:7,vars:2,consts:[[1,"navbar","navbar-light","bg-light"],[1,"container-fluid","justify-content-end"],["role","button",1,"d-flex","align-items-center",3,"click"],[1,"avatar","bg-primary","text-white","rounded-circle","d-flex","align-items-center","justify-content-center","me-2"],[1,"fw-bold"]],template:function(e,r){e&1&&(o(0,"nav",0)(1,"div",1)(2,"div",2),c("click",function(g){return r.onAvatarClick(g)}),o(3,"div",3),a(4),i(),o(5,"span",4),a(6),i()()()()),e&2&&(s(4),h(" ",r.username.charAt(0)," "),s(2),_(r.username))},styles:[".navbar[_ngcontent-%COMP%]{width:100%;position:fixed;padding-left:24px;z-index:900}.navbar[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:40px;height:40px;font-weight:700}"]})};var q=class t{static \u0275fac=function(e){return new(e||t)};static \u0275cmp=p({type:t,selectors:[["app-admin"]],standalone:!1,decls:5,vars:0,consts:[[1,"d-flex","flex-row"],[1,"main-content","flex-fill"]],template:function(e,r){e&1&&(o(0,"div",0),m(1,"app-navbar")(2,"app-top-navbar"),o(3,"div",1),m(4,"router-outlet"),i()())},dependencies:[oe,R,V],styles:[".main-content[_ngcontent-%COMP%]{margin-top:56px;margin-left:17rem}"]})};var Ge={bankCode:"bank_cd",bankName:"bank_name",branchCode:"branch_cd",branchName:"branch_name"},v=class extends se{constructor(){super(),this._mapper=new ce(Ge)}getSoftDelete(){}bankCode="";bankName="";branchCode="";branchName="";getPrimaryKeyName(){return""}};v=Q([pe("bankmst")],v);var y=class t extends de{constructor(n){super(n,v)}getName(){return"bank"}static \u0275fac=function(e){return new(e||t)(X(ue))};static \u0275prov=W({token:t,factory:t.\u0275fac})};function Ve(t,n){if(t&1&&(o(0,"option",22),a(1),i()),t&2){let e=n.$implicit;d("value",e.code),s(),h(" ",e.name," ")}}var H=class t{constructor(n,e,r,f){this.settingService=n;this.toast=r;this.bankService=f;this.formGroup=e.group({id:[""],bankCode:[""],branchCode:[""],otpRetryLimit:[""],smtpServer:[""],smtpPort:[""],smtpUser:[""],smtpPass:[""]})}bankOptions=le;branchOptions=[];settingModel=new J;formGroup;ngOnInit(){return k(this,null,function*(){let n=new P;try{let e=yield this.settingService.get();e.length>0&&(this.settingModel=e[0],this.formGroup.patchValue(this.settingModel))}catch{}finally{n.hide()}})}saveSettings(){return k(this,null,function*(){let n=new P;try{let e=new J;e.fill(this.formGroup.value),e.id=this.settingModel.id,n.show(),e.id?yield this.settingService.update(e):yield this.settingService.create(e),this.toast.success("Settings updated.")}finally{n.hide()}})}uploadBranches(n){return k(this,null,function*(){try{let e=n.target.files?.item(0);if(n.target.value="",!e){this.toast.error("Please select a file to upload.");return}if(e.type!=="text/csv"){this.toast.error("The file type should be a csv file.");return}if(!this.settingModel.bankCode){this.toast.error("You must select a default bank before you can upload branches.");return}let r=yield me(e);if(r.length===0)return;let f=yield this.bankService.get();for(let g of r){if(g.length<2){let K="The csv should have the format of branchCode,BranchName";throw new Error(K)}let w=new v;w.bankCode=this.settingModel.bankCode,w.branchCode=g[0],w.branchName=g[1],w.bankName=this.settingModel.bankCode,!f.find(K=>K.branchCode===w.branchCode)&&(yield this.bankService.create(w))}this.toast.success("Branch information updated successfully.")}catch(e){this.toast.error("Failed upload.  "+e)}})}static \u0275fac=function(e){return new(e||t)(l(L),l(B),l(j),l(y))};static \u0275cmp=p({type:t,selectors:[["app-settings"]],standalone:!1,features:[I([L,y])],decls:38,vars:2,consts:[[1,"container","py-5",3,"formGroup"],[1,"mb-4","fw-semibold"],[1,"d-flex","justify-content-end","mb-2"],["role","button","for","uploadBranch",1,"btn-link","text-muted","small","text-decoration-none"],["id","uploadBranch","type","file","hidden","","accept","text/csv",3,"change"],[1,"bi","bi-filetype-csv","me-1"],["title","The content of the file should be branchcode,branchname.",1,"bi","bi-question-circle","ms-2"],[1,"mb-5"],[1,"tsway-card"],[1,"tsway-card-header"],[1,"mb-0"],[1,"tsway-card-body","pt-3","pe-3","ps-3"],[1,"mb-3","row"],[1,"col-sm-4","col-form-label"],[1,"col-sm-8"],["formControlName","otpRetryLimit","type","text","placeholder","Enter max retry limit",1,"form-control"],[1,"tsway-card","tsway-card"],["formControlName","bankCode","placeholder","Enter default bank name or code",1,"form-control"],["disabled",""],[3,"value",4,"ngFor","ngForOf"],[1,"text-end"],[1,"btn","btn-primary","btn-lg","px-5",3,"click"],[3,"value"]],template:function(e,r){e&1&&(o(0,"form",0)(1,"div")(2,"h2",1),a(3,"Settings"),i(),o(4,"div",2)(5,"label",3)(6,"input",4),c("change",function(g){return r.uploadBranches(g)}),i(),m(7,"i",5),a(8,"Upload Branch"),i(),m(9,"i",6),i()(),o(10,"section",7)(11,"div",8)(12,"div",9)(13,"h6",10),a(14,"OTP Settings"),i()(),o(15,"div",11)(16,"div",12)(17,"label",13),a(18,"Max Retry Limit for OTPs"),i(),o(19,"div",14),m(20,"input",15),i()()()()(),o(21,"section",7)(22,"div",16)(23,"div",9)(24,"h6",10),a(25,"Bank Settings"),i()(),o(26,"div",11)(27,"div",12)(28,"label",13),a(29,"Default Bank"),i(),o(30,"div",14)(31,"select",17)(32,"option",18),a(33,"Select One"),i(),u(34,Ve,2,2,"option",19),i()()()()()(),o(35,"div",20)(36,"button",21),c("click",function(){return r.saveSettings()}),a(37,"Save Settings"),i()()()),e&2&&(d("formGroup",r.formGroup),s(34),d("ngForOf",r.bankOptions))},dependencies:[N,F,ge,he,E,ve,O,T,D,A],encapsulation:2})};var qe=[{path:"",component:q,children:[{path:"",loadChildren:()=>import("./chunk-J7GCW5UI.js").then(t=>t.DashboardModule)},{path:"customers",loadChildren:()=>import("./chunk-LUFBV4EN.js").then(t=>t.HomeModule)},{path:"transactions",loadChildren:()=>import("./chunk-4HCU3UBN.js").then(t=>t.TransactionLogModule)},{path:"otplogs",loadChildren:()=>import("./chunk-3GDB7NAV.js").then(t=>t.OtpCheckModule)},{path:"users",loadChildren:()=>import("./chunk-LBV2C3KC.js").then(t=>t.UserModule)},{path:"settings",component:H}]}],z=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=x({type:t});static \u0275inj=M({imports:[$.forChild(qe),$]})};var Me=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=x({type:t});static \u0275inj=M({imports:[z,Se,ie,be]})};export{Me as AdminModule};
