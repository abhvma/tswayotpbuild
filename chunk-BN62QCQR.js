import{a as _,c as Q}from"./chunk-4Z63NVIN.js";import{a as q}from"./chunk-RPRG3IN3.js";import{$ as O,Lb as F,Qa as x,W as I,ab as K,bb as M,c as P,cb as o,eb as D,fb as w,mb as b,ob as E,pb as L,qb as A,rb as S,u as l,v as R,vb as j,x as f}from"./chunk-673N427S.js";import{g as C,h as N}from"./chunk-ENRHZQ2S.js";var B=(r=>(r[r.Created=0]="Created",r[r.Manufacturing=1]="Manufacturing",r[r.Delivered=2]="Delivered",r[r.Assigned=3]="Assigned",r[r.Void=4]="Void",r[r.Unknown=-1]="Unknown",r))(B||{}),H={otpType:"otptype",bankCode:"bank_cd",branchCode:"branch_cd",sequenceNumber:"seqno",otpKey:"otp_key",createdDate:"create_date",status:"status",manufacturingDispatchDate:"out_date",productDeliveryDate:"in_date",keyAssignedDate:"register_date"},m=class extends M{otpType=2;bankCode="";branchCode="";sequenceNumber=0;otpKey="";createdDate=new q;status=0;manufacturingDispatchDate;productDeliveryDate;keyAssignedDate;constructor(){super(),this._mapper=new L(H)}getSoftDelete(){}getPrimaryKeyName(){return"sequenceNumber"}setCreatedDate(e){this.createdDate=new q(e)}setStatus(e){this.status=Number(e)}setOtpType(e){this.otpType=Number(e)}};C([S("seqno")],m.prototype,"sequenceNumber",2),m=C([A("keymst")],m);var g=class s extends E{constructor(e){super(e,m)}getName(){return"serialkey"}generateKey(e){return this.http.post(this.url(),e,{headers:{service:"OTPSVR"}}).then(t=>{if(t?.result.toLocaleLowerCase()==="error")throw console.error(t),t})}getLastMaxCount(e,t,i){let a=this.getQueryBuilder().aggregate({max:"sequenceNumber"}).where("bankCode",o(e)).where("branchCode",o(t)).where("otpType",o(i)).select().buildParameterized();return this.http.post(this.url(),b(a)).then(r=>Number(r[0].max_sequenceNumber)||0)}getAssignableKeys(e,t,i){let n=[{status:o(2)},{bankCode:o(e)},{branchCode:o(t)}];return i&&n.push({otpType:o(i)}),this.get(n).then(a=>a.sort((r,c)=>r.sequenceNumber-c.sequenceNumber))}getFreshKeys(e,t){return this.get([{status:o(2)},{bankCode:o(e)},{branchCode:o(t)}]).then(i=>i.sort((n,a)=>n.sequenceNumber-a.sequenceNumber))}getAssignedKeys(e,t,i){return i||(i=[]),this.get([{status:o(3),bankCode:o(e),branchCode:o(t)}]).then(n=>n.sort((a,r)=>a.sequenceNumber-r.sequenceNumber))}sendForManufacturing(e,t,i,n){let r=this.getQueryBuilder().where("sequenceNumber",D(i)).where("sequenceNumber",w(n)).where("bankCode",o(e)).where("branchCode",o(t)).update({status:1},!1).buildParameterized();return this.http.post(this.url(),b(r)).then()}receiveProducts(e,t,i,n){let r=this.getQueryBuilder().where("sequenceNumber",D(i)).where("sequenceNumber",w(n)).where("bankCode",o(e)).where("branchCode",o(t)).update({status:2},!1).buildParameterized();return this.http.post(this.url(),b(r)).then()}static \u0275fac=function(t){return new(t||s)(f(j))};static \u0275prov=l({token:s,factory:s.\u0275fac})};var y=class{constructor(e){this.closeFn=e}_closed=new P;closed=this._closed.asObservable();close(e){this._closed.next(e),this._closed.complete(),this.closeFn(e)}};var h=class s{constructor(e){this.appRef=e}getOptions(e){return{clickToClose:e?.clickToClose??!0,className:e?.className??"",width:e?.width??"auto"}}open(e,t,i,n=!0){let{clickToClose:a,className:r}=this.getOptions(i),c=document.createElement("div"),u=document.createElement("div");u.classList.add("modal-dialog"),r&&c.classList.add(...r.split(" ")),i?.width&&(u.style.width=i.width),c.appendChild(u),c.classList.add("dialog-wrapper","tsway-modal","fade-in");let T=()=>N(this,null,function*(){c.classList.remove("fade-in"),yield this.delay(50),c.classList.add("fade-out"),yield this.delay(300),this.appRef.detachView(d.hostView),d.destroy(),document.body.removeChild(c),document.removeEventListener("keyup",v)}),v=p=>{p.key==="Escape"&&(T(),document.removeEventListener("keyup",v))};if(document.addEventListener("keyup",v),n){let p=document.createElement("div");p.classList.add("dialog-overlay","position-fixed","top-0","start-0","w-100","h-100","bg-dark","opacity-50"),c.appendChild(p),a&&c.addEventListener("click",G=>{G.target===p&&T()})}document.body.appendChild(c);let d=this.appRef.bootstrap(e,u);if(t)for(let p in t)d.setInput(p,t[p]);let k=new y(T);return d.instance.dialogRef=k,Promise.resolve(k)}delay(e){return new Promise(t=>setTimeout(t,e))}static \u0275fac=function(t){return new(t||s)(f(O))};static \u0275prov=l({token:s,factory:s.\u0275fac})};var z=class s{static \u0275fac=function(t){return new(t||s)};static \u0275mod=I({type:s});static \u0275inj=R({providers:[h,_,g],imports:[F,x,K,Q]})};export{h as a,B as b,g as c,z as d};
