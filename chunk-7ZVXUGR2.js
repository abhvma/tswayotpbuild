import{$a as M,D as K,Ha as L,I as A,Ia as v,Ja as t,Ka as z,La as R,Ma as x,Ta as p,Wa as F,Ya as H,Za as q,_a as P,ab as U,c as Y,db as j,j as N,k as E,m as k,vb as G,wb as V,xa as Q,xb as J,zb as W}from"./chunk-RTONY4FF.js";import{g as h,h as D}from"./chunk-ENRHZQ2S.js";function y(a,e="YYYY-MM-DD HH:mm:ss"){let n={YYYY:a.getFullYear().toString(),MM:String(a.getMonth()+1).padStart(2,"0"),DD:String(a.getDate()).padStart(2,"0"),HH:String(a.getHours()).padStart(2,"0"),mm:String(a.getMinutes()).padStart(2,"0"),ss:String(a.getSeconds()).padStart(2,"0")};return e.replace(/YYYY|MM|DD|HH|mm|ss/g,r=>n[r])}var c=class a extends Date{static afterYear(e){return new a(Date.now()+e*365*24*60*60*1e3)}toString(){return y(this)}date(e){return F(e)?this.format("YYYY-MM-DD"):e===!0?this.format("YYYY-MM-DD 00:00:00"):this.format("YYYY-MM-DD 23:59:59")}time(){return this.format("HH:mm:ss")}format(e="YYYY-MM-DD"){return y(this,e)}};var te=(r=>(r[r.Active=1]="Active",r[r.Lock=2]="Lock",r[r.Delete=3]="Delete",r))(te||{}),B=(s=>(s[s.Mobile=1]="Mobile",s[s.Card=2]="Card",s[s.Token=3]="Token",s[s.Console=4]="Console",s))(B||{}),re={1:"Mobile",2:"Card",3:"Token",4:"Console"};var ne={customerId:"custom_id",serialNumber:"serial_num",bankCode:"bank_code",bankName:"bank_name",branchName:"branch_name",branchCode:"branch_code",mobile:"mobile",customerName:"custom_name",email:"email",registeredBank:"regist_bank",registeredBankName:"regist_bankname",registeredDate:"resgist_date",lastUseDate:"lastuse_date",status:"status",otpType:"otptype"},f=class extends v{customerId="";bankCode="";bankName="";mobile="";customerName="";email="";registeredBank="";registeredBankName="";branchName="";branchCode="";registeredDate=new c;lastUseDate=new c;status=1;otpType=1;serialNumber="";key;constructor(){super(),this._mapper=new q(ne)}getPrimaryKeyName(){return"customerId"}getSoftDelete(){return{status:z(3)}}setRegisteredDate(e){return this.registeredDate=new c(e),this.registeredDate}setLastUseDate(e){return this.lastUseDate=new c(e),this.lastUseDate}getRegisteredDate(){return y(this.registeredDate)}getLastUseDate(){return y(this.lastUseDate)}setOtpType(e){this.otpType=Number(e)}getOtpTypeLabel(){return re[this.otpType]||"Unknown"}};h([M("custom_id")],f.prototype,"customerId",2),h([U()],f.prototype,"key",2),f=h([P("cifmst")],f);var X=(o=>(o[o.Created=0]="Created",o[o.Registered=1]="Registered",o[o.Enrolled=2]="Enrolled",o[o.Active=3]="Active",o[o.Revoked=4]="Revoked",o[o.Unknown=-1]="Unknown",o))(X||{}),ie={otpType:"otptype",bankCode:"bank_cd",branchCode:"branch_cd",sequenceNumber:"seqno",otpKey:"otp_key",createdDate:"create_date",status:"status",manufacturingDispatchDate:"out_date",productDeliveryDate:"in_date",keyAssignedDate:"register_date"},g=class extends v{otpType=2;bankCode="";branchCode="";sequenceNumber=0;otpKey="";createdDate=new c;status=0;manufacturingDispatchDate;productDeliveryDate;keyAssignedDate;constructor(){super(),this._mapper=new q(ie)}getSoftDelete(){}getPrimaryKeyName(){return"sequenceNumber"}setManufacturingDispatchDate(e){if(!e||e&&e.trim()===""){this.manufacturingDispatchDate=void 0;return}this.manufacturingDispatchDate=new c(e)}setProductDeliveryDate(e){if(!e||e&&e.trim()===""){this.productDeliveryDate=void 0;return}this.productDeliveryDate=new c(e)}setKeyAssignedDate(e){if(!e||e&&e.trim()===""){this.keyAssignedDate=void 0;return}this.keyAssignedDate=new c(e)}setCreatedDate(e){this.createdDate=new c(e)}setStatus(e){this.status=Number(e)}setOtpType(e){this.otpType=Number(e)}setSequenceNumber(e){this.sequenceNumber=Number(e)}};h([M("seqno")],g.prototype,"sequenceNumber",2),g=h([P("keymst")],g);var _=class a extends H{constructor(e){super(e,g)}getName(){return"serialkey"}generateKey(e){return this.http.post(this.url(),e,{headers:{service:"OTPSVR"}}).then(n=>{if(n?.result.toLocaleLowerCase()==="error")throw console.error(n),n})}getStats(e,n){return D(this,null,function*(){let r=this.getQueryBuilder();r.aggregate({count:"sequenceNumber"}).where("otpType",t(2)).where("bankCode",t(e)).where("branchCode",t(n));let s=yield this.http.post(this.url(),p(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(2)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(0));let u=yield this.http.post(this.url(),p(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(2)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(1));let o=yield this.http.post(this.url(),p(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(2)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(2));let m=yield this.http.post(this.url(),p(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(2)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(3));let l=yield this.http.post(this.url(),p(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(2)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(4));let C=yield this.http.post(this.url(),p(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(3)).where("bankCode",t(e)).where("branchCode",t(n));let w=yield this.http.post(this.url(),p(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(3)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(0));let b=yield this.http.post(this.url(),p(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(3)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(1));let T=yield this.http.post(this.url(),p(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(3)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(2));let d=yield this.http.post(this.url(),p(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(3)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(3));let O=yield this.http.post(this.url(),p(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);r=this.getQueryBuilder(),r.aggregate({count:"sequenceNumber"}).where("otpType",t(3)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(4));let ee=yield this.http.post(this.url(),p(r.buildParameterized())).then(i=>i.length===0?0:i[0].count_sequenceNumber);return{totalCardCount:s||0,rawCardCount:u||0,registeredCardCount:o||0,enrolledCardCount:m||0,activeCardCount:l||0,inactiveCardCount:C||0,totalTokenCount:w||0,rawTokenCount:b||0,registeredTokenCount:T||0,enrolledTokenCount:d||0,activeTokenCount:O||0,inactiveTokenCount:ee||0}})}getCount(e){let r=this.processQueryParams(this.getQueryBuilder(),e).aggregate({count:"sequenceNumber"}).buildParameterized();return this.http.post(this.url(),p(r)).then(s=>Number(s[0].count_sequenceNumber)||0)}getLastMaxCount(e,n,r){let u=this.getQueryBuilder().aggregate({max:"sequenceNumber"}).where("bankCode",t(e)).where("branchCode",t(n)).where("otpType",t(r)).select().buildParameterized();return this.http.post(this.url(),p(u)).then(o=>Number(o[0].max_sequenceNumber)||0)}getAssignableKeys(e,n,r,s){let u=[{status:t(2)},{bankCode:t(e)},{branchCode:t(n)}];return r&&u.push({otpType:t(r)}),s&&u.push({sequenceNumber:t(s)}),this.get(u).then(o=>o.sort((m,l)=>m.sequenceNumber-l.sequenceNumber))}getFreshKeys(e,n){return this.get([{status:t(2)},{bankCode:t(e)},{branchCode:t(n)}]).then(r=>r.sort((s,u)=>s.sequenceNumber-u.sequenceNumber))}getAssignedKeys(e,n,r){return r||(r=[]),this.get([{status:t(3),bankCode:t(e),branchCode:t(n)}]).then(s=>s.sort((u,o)=>u.sequenceNumber-o.sequenceNumber))}getRangesForStatus(e,n,r,s){let o=this.getQueryBuilder().where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(s)).where("otpType",t(r)).aggregate({min:"sequenceNumber",max:"sequenceNumber"}).select().buildParameterized();return this.http.post(this.url(),p(o)).then(m=>m.length>0?isNaN(m[0].min_sequenceNumber)||isNaN(m[0].max_sequenceNumber)?[0,0]:[+m[0].min_sequenceNumber,+m[0].max_sequenceNumber]:[0,0])}sendForManufacturing(e,n,r,s){let o=this.getQueryBuilder().where("sequenceNumber",R(r)).where("sequenceNumber",x(s)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(0)).update({status:1,manufacturingDispatchDate:new c},!1).buildParameterized();return this.http.post(this.url(),p(o)).then()}markAsDelivered(e,n,r,s){let o=this.getQueryBuilder().where("sequenceNumber",R(r)).where("sequenceNumber",x(s)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(1)).update({status:2,productDeliveryDate:new c},!1).buildParameterized();return this.http.post(this.url(),p(o)).then()}markAsAssigned(e,n,r){let u=this.getQueryBuilder().where("sequenceNumber",t(r)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(2)).update({status:3,keyAssignedDate:new c},!1).buildParameterized();return this.http.post(this.url(),p(u)).then()}voidProduct(e,n,r){let u=this.getQueryBuilder().where("sequenceNumber",t(r)).where("bankCode",t(e)).where("branchCode",t(n)).where("status",t(3)).update({status:4},!1).buildParameterized();return this.http.post(this.url(),p(u)).then()}static \u0275fac=function(n){return new(n||a)(k(j))};static \u0275prov=N({token:a,factory:a.\u0275fac})};var S=class{constructor(e){this.closeFn=e}_closed=new Y;closed=this._closed.asObservable();close(e){this._closed.next(e),this._closed.complete(),this.closeFn(e)}};var I=class a{constructor(e){this.appRef=e}getOptions(e){return{clickToClose:e?.clickToClose??!0,className:e?.className??"",width:e?.width??"auto"}}open(e,n,r,s=!0){let{clickToClose:u,className:o}=this.getOptions(r),m=document.createElement("div"),l=document.createElement("div");l.classList.add("modal-dialog"),o&&m.classList.add(...o.split(" ")),r?.width&&(l.style.width=r.width),m.appendChild(l),m.classList.add("dialog-wrapper","tsway-modal","fade-in");let C=()=>D(this,null,function*(){m.classList.remove("fade-in"),yield this.delay(50),m.classList.add("fade-out"),yield this.delay(300),this.appRef.detachView(b.hostView),b.destroy();try{m&&document.body.removeChild(m)}catch{}document.removeEventListener("keyup",w)}),w=d=>{d.key==="Escape"&&(C(),document.removeEventListener("keyup",w))};if(document.addEventListener("keyup",w),s){let d=document.createElement("div");d.classList.add("dialog-overlay","position-fixed","top-0","start-0","w-100","h-100","bg-dark","opacity-50"),m.appendChild(d),u&&m.addEventListener("click",O=>{O.target===d&&C()})}document.body.appendChild(m);let b=this.appRef.bootstrap(e,l);if(n)for(let d in n)b.setInput(d,n[d]);let T=new S(C);return b.instance.dialogRef=T,Promise.resolve(T)}delay(e){return new Promise(n=>setTimeout(n,e))}static \u0275fac=function(n){return new(n||a)(k(A))};static \u0275prov=N({token:a,factory:a.\u0275fac})};var $=class a{static \u0275fac=function(n){return new(n||a)};static \u0275mod=K({type:a});static \u0275inj=E({providers:[I,J,_],imports:[V,Q,L,W,G]})};export{I as a,c as b,te as c,B as d,f as e,X as f,_ as g,$ as h};
