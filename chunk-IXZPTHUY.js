import{a as fe,b as ge}from"./chunk-TFFLQK24.js";import{a as de}from"./chunk-VMBGR2WL.js";import{b as ce}from"./chunk-75NQJRGJ.js";import{d as pe}from"./chunk-2Y3AYROZ.js";import"./chunk-7VL2AYZC.js";import{a as se}from"./chunk-HVPVQXOI.js";import{a as c}from"./chunk-ZGLSKZPV.js";import{B as M,C as N,Cb as ee,E as k,F as T,Fb as te,Gb as F,Hb as ne,Ia as B,Ib as oe,Kb as ie,Mb as re,Nb as ae,O as r,S as D,Sa as H,Ta as $,Tb as le,Ua as z,V as d,Vb as me,W as j,Z as R,_ as p,ba as l,eb as K,fa as a,fb as J,ga as i,ha as s,ia as A,ib as U,ja as G,jb as W,ka as V,la as b,ma as h,ta as Q,u as q,ua as m,v as O,va as v,vb as X,wb as Y,x as P,xb as Z}from"./chunk-Y6X5IISN.js";import"./chunk-FK6H3RFT.js";import{a as L,b as w,g as E}from"./chunk-ENRHZQ2S.js";var be={traceDate:"trace_date",traceSequence:"trace_seq",terminalIp:"terminal_ip",sqlText:"sql_txt"},f=class extends J{traceDate="";traceSequence="";terminalIp="";sqlText="";constructor(){super(),this._mapper=new Y(be)}getPrimaryKeyName(){return""}getSoftDelete(){}};f=E([Z("trlog")],f);var g=class t extends X{constructor(n){super(n,f)}getName(){return"transtactions"}static \u0275fac=function(e){return new(e||t)(P(ee))};static \u0275prov=q({token:t,factory:t.\u0275fac})};function ve(t,n){if(t&1&&(a(0,"th",3),m(1),i()),t&2){let e=n.$implicit;l("width",e.width),r(),v(e.label)}}function De(t,n){if(t&1&&(a(0,"tr")(1,"td"),m(2),i(),a(3,"td"),m(4),i(),a(5,"td"),m(6),i()()),t&2){let e=n.$implicit;r(2),v(e.terminalIp),r(2),v(e.sqlText),r(2),v(e.traceDate)}}var _=class t{models=[];editClick=new T;deleteClick=new T;columns=[{label:"Terminal IP",width:"10%"},{label:"SQL Text",width:"70%"},{label:"Trace Date",width:"20%"}];static \u0275fac=function(e){return new(e||t)};static \u0275cmp=d({type:t,selectors:[["app-transaction-log-table"]],inputs:{models:"models"},outputs:{editClick:"editClick",deleteClick:"deleteClick"},standalone:!1,decls:6,vars:2,consts:[[1,"tsway-datatable","striped"],[3,"width",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[3,"width"]],template:function(e,o){e&1&&(a(0,"table",0)(1,"thead")(2,"tr"),p(3,ve,2,2,"th",1),i()(),a(4,"tbody"),p(5,De,7,3,"tr",2),i()()),e&2&&(r(3),l("ngForOf",o.columns),r(2),l("ngForOf",o.models))},dependencies:[H],encapsulation:2})};var x=class t{constructor(n){this.fb=n;this.filterForm=this.fb.group({traceDateTo:[this.toDate.date(),F.required],traceDateFrom:[this.fromDate.date(),F.required],terminalIp:""})}fromDate=new c;toDate=new c;filterChange=new T;filterForm;subscriptions=[];emitFilter(){this.filterChange.emit(this.filterForm.value)}ngOnDestroy(){this.subscriptions.forEach(n=>n.unsubscribe())}static \u0275fac=function(e){return new(e||t)(D(le))};static \u0275cmp=d({type:t,selectors:[["app-transaction-log-filterbar"]],inputs:{fromDate:"fromDate",toDate:"toDate"},outputs:{filterChange:"filterChange"},standalone:!1,decls:14,vars:3,consts:[[1,"filterbar","mb-3"],[1,"row","g-3","align-items-end","filter-form-container",3,"formGroup"],[1,"col-md-2"],["for","traceDateFrom",1,"form-label","small","mb-1"],["type","date","id","traceDateFrom","formControlName","traceDateFrom",1,"form-control",3,"value"],["for","traceDateTo",1,"form-label","small","mb-1"],["value","toDate.date()","type","date","id","traceDateTo","formControlName","traceDateTo",1,"form-control"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"bi","bi-search","me-1"]],template:function(e,o){e&1&&(a(0,"div",0)(1,"form",1)(2,"div",2)(3,"label",3),m(4,"Trace From"),i(),s(5,"input",4),i(),a(6,"div",2)(7,"label",5),m(8,"Trace To"),i(),s(9,"input",6),i(),a(10,"div",2)(11,"button",7),b("click",function(){return o.emitFilter()}),s(12,"i",8),m(13,"Search "),i()()()()),e&2&&(r(),l("formGroup",o.filterForm),r(4),l("value",o.fromDate.date()),r(6),l("disabled",o.filterForm.invalid))},dependencies:[ie,te,ne,oe,re,ae],encapsulation:2})};function xe(t,n){if(t&1){let e=V();a(0,"div",7)(1,"a",8),b("click",function(){M(e);let u=h();return N(u.downloadTable())}),s(2,"i",9),m(3," Download PDF "),i()()}}function Ie(t,n){if(t&1&&(A(0),s(1,"app-transaction-log-table",12),G()),t&2){let e=h(2);r(),l("models",e.models)}}function ye(t,n){t&1&&(a(0,"div")(1,"p",3),m(2,"Search for Transaction logs"),i()())}function Fe(t,n){t&1&&(a(0,"div")(1,"p",3),m(2,"No transaction log found."),i()())}function Se(t,n){if(t&1&&(a(0,"div",13)(1,"div"),s(2,"i",14),p(3,ye,3,0,"div",15)(4,Fe,3,0,"div",15),i()()),t&2){let e=h(2);r(3),l("ngIf",!e.hasSearched),r(),l("ngIf",e.hasSearched)}}function Le(t,n){if(t&1&&(a(0,"div",10),p(1,Ie,2,1,"ng-container",11)(2,Se,5,2,"ng-template",null,0,B),i()),t&2){let e=Q(3),o=h();r(),l("ngIf",o.models.length>0)("ngIfElse",e)}}var I=class t extends ce{hasSearched=!1;fromDate=new c;toDate=new c;constructor(n){super(n),this.modelService=n.get(g)}ngOnInit(){}fetchTransactions(n=0){let e=new se;this.paginationOption.currentPage=n;let o=[],u=this.modelFilters.traceDateFrom?new c(this.modelFilters.traceDateFrom).date():this.fromDate.date(),y=this.modelFilters.traceDateTo?new c(this.modelFilters.traceDateTo).date():this.toDate.date();return o.push({traceDate:U(u)}),o.push({traceDate:W(y)}),e.show(),this.modelService.paginate(o,{traceDate:"DESC"},this.paginationOption.currentPage,this.paginationOption.pageSize).then(S=>(this.models=S,this.hasSearched=!0,this.models)).catch(S=>(this.toast.error("Failed to load transaction logs"),[])).finally(()=>{e.hide()})}loadModels(){return this.fetchTransactions(this.paginationOption.currentPage)}openDialog(n){throw new Error("Method not implemented.")}applyFilters(){throw new Error("Method not implemented.")}onFilterChange(n){this.paginationOption=w(L({},this.paginationOption),{currentPage:0}),this.modelFilters=n,this.loadModels()}downloadTable(){let n=new fe;n.setFontSize(12);let e=this.models.map(o=>({traceSequence:o.traceSequence,terminalIp:o.terminalIp,sqlText:o.sqlText,traceDate:o.traceDate.toLocaleString()}));ge(n,{head:[["Trace Sequence","Terminal IP","Sql Text","Trace Date"]],body:e.map(o=>[o.traceSequence,o.terminalIp,o.sqlText,o.traceDate])}),n.save(`transaction-log${new Date().toDateString()}.pdf`)}static \u0275fac=function(e){return new(e||t)(D(k))};static \u0275cmp=d({type:t,selectors:[["app-transaction-log"]],standalone:!1,features:[R],decls:7,vars:4,consts:[["noData",""],[1,"container-fluid","py-4","d-flex","flex-column","vh-100"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"mb-0"],[3,"filterChange","fromDate","toDate"],["class","d-flex justify-content-end mb-2",4,"ngIf"],["class","mb-4",4,"ngIf"],[1,"d-flex","justify-content-end","mb-2"],["role","button",1,"btn-link","text-muted","small","text-decoration-none",3,"click"],[1,"bi","bi-file-earmark-pdf","me-1"],[1,"mb-4"],[4,"ngIf","ngIfElse"],[3,"models"],[1,"d-flex","justify-content-center","align-items-center","h-100","text-muted","text-center","px-4"],[1,"bi","bi-search","display-6","d-block","mb-2"],[4,"ngIf"]],template:function(e,o){e&1&&(a(0,"div",1)(1,"div",2)(2,"h2",3),m(3,"Transaction Logs"),i()(),a(4,"app-transaction-log-filterbar",4),b("filterChange",function(y){return o.onFilterChange(y)}),i(),p(5,xe,4,0,"div",5)(6,Le,4,2,"div",6),i()),e&2&&(r(4),l("fromDate",o.fromDate)("toDate",o.toDate),r(),l("ngIf",o.models.length>0),r(),l("ngIf",o.hasSearched))},dependencies:[$,_,x],styles:[".fixed[_ngcontent-%COMP%]{position:fixed;bottom:-30px;left:50%;transform:translate(-50%)}"]})};var we=[{path:"",component:I}],Te=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=j({type:t});static \u0275inj=O({providers:[g],imports:[pe,z,K.forChild(we),me,de]})};export{Te as TransactionLogModule};
