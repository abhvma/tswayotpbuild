import{c as N}from"./chunk-6M7X5SQT.js";import{c as gt}from"./chunk-US7JWHAK.js";import"./chunk-KH7BRNI5.js";import{b as m}from"./chunk-44S3GGHA.js";import{a as _}from"./chunk-HVPVQXOI.js";import{A as Z,Ab as dt,B as W,Ba as nt,Bb as pt,E as C,F as K,G as X,Hb as mt,Ib as ut,N as o,Oa as rt,R as l,U as f,V as S,W as Y,X as J,_a as st,a as U,aa as h,b as k,c as j,ca as tt,e as P,ea as r,f as q,fa as s,ga as c,gb as p,ja as et,ka as D,lb as b,mb as z,p as V,pa as T,qa as L,r as H,ra as M,ta as d,tb as x,u as O,ub as ot,v as $,va as A,wb as ct,xa as it,xb as ht,yb as lt,z as E,za as at}from"./chunk-IKBPWLY7.js";import{a as B,h as w}from"./chunk-ENRHZQ2S.js";var R=class n{transform(i,t){if(i==null||i==="")return"";let e=Number(i);if(isNaN(e))return i.toString();let a=t?.locale??"np";return t?.shorten??!1?this.shortenNumber(e):a==="np"?this.formatIndian(e):this.formatWestern(e)}formatWestern(i){return new Intl.NumberFormat("en-US").format(i)}formatIndian(i){let t=i.toString().split("."),e=t[0],a=t[1]?`.${t[1]}`:"",u=e.slice(-3),g=e.slice(0,-3),y=g.replace(/\B(?=(\d{2})+(?!\d))/g,",");return(g?y+",":"")+u+a}shortenNumber(i){let t=Math.abs(i),e;return t>=1e9?e=(i/1e9).toFixed(2)+"B":t>=1e6?e=(i/1e6).toFixed(2)+"M":t>=1e3?e=(i/1e3).toFixed(2)+"K":e=i.toString(),e.replace(/\.00([KMB])$/,"$1")}static \u0275fac=function(t){return new(t||n)};static \u0275pipe=J({name:"numberLocale",type:n,pure:!0})};var Et=["card"],St=()=>({shorten:!0}),F=class n{constructor(i){this.http=i}title="";value="";changeText="";iconClass="";qb;container;ngAfterViewInit(){let i=new _(this.container.nativeElement),t=z(this.qb.buildParameterized(),b.terminalIp,"");i.show(),this.http.post(b.api,t).then(e=>{e.length>0?this.value=""+(e[0].count||"NA"):this.value="NA"}).finally(()=>i.hide())}static \u0275fac=function(t){return new(t||n)(l(x))};static \u0275cmp=f({type:n,selectors:[["app-stat-card"]],viewQuery:function(t,e){if(t&1&&T(Et,5),t&2){let a;L(a=M())&&(e.container=a.first)}},inputs:{title:"title",value:"value",changeText:"changeText",iconClass:"iconClass",qb:"qb"},standalone:!1,decls:11,vars:8,consts:[["card",""],[1,"stat-card","card","border-0","p-3"],[1,"d-flex","align-items-center"],[1,"icon-wrapper","d-flex","align-items-center","justify-content-center","flex-shrink-0","me-3"],[1,"d-flex","flex-column"],[1,"stat-title","text-muted"],[1,"stat-value","fw-bold"]],template:function(t,e){t&1&&(r(0,"div",1,0)(2,"div",2)(3,"div",3),c(4,"i"),s(),r(5,"div",4)(6,"span",5),d(7),s(),r(8,"span",6),d(9),at(10,"numberLocale"),s()()()()),t&2&&(o(4),tt("bi "+e.iconClass),o(3),A(" ",e.title," "),o(2),A(" ",nt(10,4,e.value,it(7,St))," "))},dependencies:[R],styles:[".stat-card[_ngcontent-%COMP%]{background-color:#f1f1f1}.stat-card[_ngcontent-%COMP%]   .icon-wrapper[_ngcontent-%COMP%]{width:72px;height:72px;border-radius:30px;background-color:#c7e6f9}.stat-card[_ngcontent-%COMP%]   .icon-wrapper[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:44px;color:var(--bs-primary)}.stat-card[_ngcontent-%COMP%]   .stat-title[_ngcontent-%COMP%]{font-size:16px}.stat-card[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{font-size:32px}.stat-card[_ngcontent-%COMP%]   .stat-change[_ngcontent-%COMP%]{font-size:14px}"]})};var G=class{constructor(){this.subject=new P(1),this.subscriptions=new U}doFilter(i){this.subject.next(i)}dispose(){this.subscriptions.unsubscribe()}notEmpty(i,t){this.subscriptions.add(this.subject.subscribe(e=>{if(e[i]){let a=e[i].currentValue;a!=null&&t(a)}}))}has(i,t){this.subscriptions.add(this.subject.subscribe(e=>{if(e[i]){let a=e[i].currentValue;t(a)}}))}notFirst(i,t){this.subscriptions.add(this.subject.subscribe(e=>{if(e[i]&&!e[i].isFirstChange()){let a=e[i].currentValue;t(a)}}))}notFirstAndEmpty(i,t){this.subscriptions.add(this.subject.subscribe(e=>{if(e[i]&&!e[i].isFirstChange()){let a=e[i].currentValue;a!=null&&t(a)}}))}},bt=new $("NGX_ECHARTS_CONFIG"),Ct=(()=>{class n{constructor(t,e,a){this.el=e,this.ngZone=a,this.options=null,this.theme=null,this.initOpts=null,this.merge=null,this.autoResize=!0,this.loading=!1,this.loadingType="default",this.loadingOpts=null,this.chartInit=new C,this.optionsError=new C,this.chartClick=this.createLazyEvent("click"),this.chartDblClick=this.createLazyEvent("dblclick"),this.chartMouseDown=this.createLazyEvent("mousedown"),this.chartMouseMove=this.createLazyEvent("mousemove"),this.chartMouseUp=this.createLazyEvent("mouseup"),this.chartMouseOver=this.createLazyEvent("mouseover"),this.chartMouseOut=this.createLazyEvent("mouseout"),this.chartGlobalOut=this.createLazyEvent("globalout"),this.chartContextMenu=this.createLazyEvent("contextmenu"),this.chartHighlight=this.createLazyEvent("highlight"),this.chartDownplay=this.createLazyEvent("downplay"),this.chartSelectChanged=this.createLazyEvent("selectchanged"),this.chartLegendSelectChanged=this.createLazyEvent("legendselectchanged"),this.chartLegendSelected=this.createLazyEvent("legendselected"),this.chartLegendUnselected=this.createLazyEvent("legendunselected"),this.chartLegendLegendSelectAll=this.createLazyEvent("legendselectall"),this.chartLegendLegendInverseSelect=this.createLazyEvent("legendinverseselect"),this.chartLegendScroll=this.createLazyEvent("legendscroll"),this.chartDataZoom=this.createLazyEvent("datazoom"),this.chartDataRangeSelected=this.createLazyEvent("datarangeselected"),this.chartGraphRoam=this.createLazyEvent("graphroam"),this.chartGeoRoam=this.createLazyEvent("georoam"),this.chartTreeRoam=this.createLazyEvent("treeroam"),this.chartTimelineChanged=this.createLazyEvent("timelinechanged"),this.chartTimelinePlayChanged=this.createLazyEvent("timelineplaychanged"),this.chartRestore=this.createLazyEvent("restore"),this.chartDataViewChanged=this.createLazyEvent("dataviewchanged"),this.chartMagicTypeChanged=this.createLazyEvent("magictypechanged"),this.chartGeoSelectChanged=this.createLazyEvent("geoselectchanged"),this.chartGeoSelected=this.createLazyEvent("geoselected"),this.chartGeoUnselected=this.createLazyEvent("geounselected"),this.chartAxisAreaSelected=this.createLazyEvent("axisareaselected"),this.chartBrush=this.createLazyEvent("brush"),this.chartBrushEnd=this.createLazyEvent("brushend"),this.chartBrushSelected=this.createLazyEvent("brushselected"),this.chartGlobalCursorTaken=this.createLazyEvent("globalcursortaken"),this.chartRendered=this.createLazyEvent("rendered"),this.chartFinished=this.createLazyEvent("finished"),this.animationFrameID=null,this.chart$=new P(1),this.resize$=new j,this.changeFilter=new G,this.resizeObFired=!1,this.echarts=t.echarts,this.theme=t.theme||null}ngOnChanges(t){this.changeFilter.doFilter(t)}ngOnInit(){if(!window.ResizeObserver)throw new Error("please install a polyfill for ResizeObserver");this.resizeSub=this.resize$.pipe(H(100,q,{leading:!1,trailing:!0})).subscribe(()=>this.resize()),this.autoResize&&(this.resizeOb=this.ngZone.runOutsideAngular(()=>new window.ResizeObserver(t=>{for(let e of t)e.target===this.el.nativeElement&&(this.resizeObFired?this.animationFrameID=window.requestAnimationFrame(()=>{this.resize$.next()}):this.resizeObFired=!0)})),this.resizeOb.observe(this.el.nativeElement)),this.changeFilter.notFirstAndEmpty("options",t=>this.onOptionsChange(t)),this.changeFilter.notFirstAndEmpty("merge",t=>this.setOption(t)),this.changeFilter.has("loading",t=>this.toggleLoading(!!t)),this.changeFilter.notFirst("theme",()=>this.refreshChart())}ngOnDestroy(){window.clearTimeout(this.initChartTimer),this.resizeSub&&this.resizeSub.unsubscribe(),this.animationFrameID&&window.cancelAnimationFrame(this.animationFrameID),this.resizeOb&&this.resizeOb.unobserve(this.el.nativeElement),this.loadingSub&&this.loadingSub.unsubscribe(),this.changeFilter.dispose(),this.dispose()}ngAfterViewInit(){this.initChartTimer=window.setTimeout(()=>this.initChart())}dispose(){this.chart&&(this.chart.isDisposed()||this.chart.dispose(),this.chart=null)}resize(){this.chart&&this.chart.resize()}toggleLoading(t){this.chart?t?this.chart.showLoading(this.loadingType,this.loadingOpts):this.chart.hideLoading():this.loadingSub=this.chart$.subscribe(e=>t?e.showLoading(this.loadingType,this.loadingOpts):e.hideLoading())}setOption(t,e){if(this.chart)try{this.chart.setOption(t,e)}catch(a){console.error(a),this.optionsError.emit(a)}}refreshChart(){return w(this,null,function*(){this.dispose(),yield this.initChart()})}createChart(){let t=this.el.nativeElement;if(window&&window.getComputedStyle){let e=window.getComputedStyle(t,null).getPropertyValue("height");(!e||e==="0px")&&(!t.style.height||t.style.height==="0px")&&(t.style.height="400px")}return this.ngZone.runOutsideAngular(()=>(typeof this.echarts=="function"?this.echarts:()=>Promise.resolve(this.echarts))().then(({init:a})=>a(t,this.theme,this.initOpts)))}initChart(){return w(this,null,function*(){yield this.onOptionsChange(this.options),this.merge&&this.chart&&this.setOption(this.merge)})}onOptionsChange(t){return w(this,null,function*(){t&&(this.chart?this.setOption(this.options,!0):(this.chart=yield this.createChart(),this.chart$.next(this.chart),this.chartInit.emit(this.chart),this.setOption(this.options,!0)))})}createLazyEvent(t){return this.chartInit.pipe(V(e=>new k(a=>(e.on(t,u=>this.ngZone.run(()=>a.next(u))),()=>{this.chart&&(this.chart.isDisposed()||e.off(t))}))))}static{this.\u0275fac=function(e){return new(e||n)(l(bt),l(X),l(K))}}static{this.\u0275dir=Y({type:n,selectors:[["echarts"],["","echarts",""]],inputs:{options:"options",theme:"theme",initOpts:"initOpts",merge:"merge",autoResize:"autoResize",loading:"loading",loadingType:"loadingType",loadingOpts:"loadingOpts"},outputs:{chartInit:"chartInit",optionsError:"optionsError",chartClick:"chartClick",chartDblClick:"chartDblClick",chartMouseDown:"chartMouseDown",chartMouseMove:"chartMouseMove",chartMouseUp:"chartMouseUp",chartMouseOver:"chartMouseOver",chartMouseOut:"chartMouseOut",chartGlobalOut:"chartGlobalOut",chartContextMenu:"chartContextMenu",chartHighlight:"chartHighlight",chartDownplay:"chartDownplay",chartSelectChanged:"chartSelectChanged",chartLegendSelectChanged:"chartLegendSelectChanged",chartLegendSelected:"chartLegendSelected",chartLegendUnselected:"chartLegendUnselected",chartLegendLegendSelectAll:"chartLegendLegendSelectAll",chartLegendLegendInverseSelect:"chartLegendLegendInverseSelect",chartLegendScroll:"chartLegendScroll",chartDataZoom:"chartDataZoom",chartDataRangeSelected:"chartDataRangeSelected",chartGraphRoam:"chartGraphRoam",chartGeoRoam:"chartGeoRoam",chartTreeRoam:"chartTreeRoam",chartTimelineChanged:"chartTimelineChanged",chartTimelinePlayChanged:"chartTimelinePlayChanged",chartRestore:"chartRestore",chartDataViewChanged:"chartDataViewChanged",chartMagicTypeChanged:"chartMagicTypeChanged",chartGeoSelectChanged:"chartGeoSelectChanged",chartGeoSelected:"chartGeoSelected",chartGeoUnselected:"chartGeoUnselected",chartAxisAreaSelected:"chartAxisAreaSelected",chartBrush:"chartBrush",chartBrushEnd:"chartBrushEnd",chartBrushSelected:"chartBrushSelected",chartGlobalCursorTaken:"chartGlobalCursorTaken",chartRendered:"chartRendered",chartFinished:"chartFinished"},exportAs:["echarts"],features:[E]})}}return n})(),Tt=n=>({provide:bt,useValue:n}),vt=(()=>{class n{static forRoot(t){return{ngModule:n,providers:[Tt(t)]}}static forChild(){return{ngModule:n}}static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275mod=S({type:n})}static{this.\u0275inj=O({})}}return n})();var Q=class n{constructor(i){this.formBuilder=i}dateChange=new C;data=[];formGroup;lineChartOptions={backgroundColor:"#F1F1F1",title:{text:"Transactions",left:"left",padding:[10,0,0,10]},tooltip:{trigger:"axis"},grid:{left:10,right:10,top:60,bottom:40,containLabel:!0},xAxis:{type:"category",data:["Jan"]},yAxis:{type:"value"},series:[{name:"Total Transaction",type:"line",data:[1],smooth:!0,lineStyle:{width:3,color:"#096DAA"},itemStyle:{color:"#096DAA"},areaStyle:{opacity:.2,color:"#096DAA"}}]};dateRange=[new m(m.now()-30*24*60*60*1e3),new m];ngOnInit(){this.formGroup=this.formBuilder.group({fromDate:[this.dateRange[0].toString().split(" ")[0]],toDate:[this.dateRange[1].toString().split(" ")[0]]}),this.formGroup.get("fromDate").valueChanges.subscribe(i=>{this.dateRange[0]=new m(i)}),this.formGroup.get("toDate").valueChanges.subscribe(i=>{this.dateRange[1]=new m(i)})}ngOnChanges(i){i.data&&i.data.currentValue!==i.data.previousValue&&this.generateLineChartOptions()}generateLineChartOptions(){this.lineChartOptions=B({},this.lineChartOptions),this.lineChartOptions.xAxis.data=this.data.map(i=>i[0].toString().split(" ")[0]),this.lineChartOptions.series[0].data=this.data.map(i=>i[1])}submitDate(){this.dateChange.emit(this.dateRange)}static \u0275fac=function(t){return new(t||n)(l(mt))};static \u0275cmp=f({type:n,selectors:[["app-transaction-chart"]],inputs:{data:"data"},outputs:{dateChange:"dateChange"},standalone:!1,features:[E],decls:16,vars:2,consts:[[1,"d-flex","justify-content-between","align-items-center","mb-3","chart-header"],[1,"row","g-2","align-items-end",3,"submit","formGroup"],[1,"col-auto"],["for","fromDate",1,"form-label","mb-1"],["type","date","id","fromDate","formControlName","fromDate",1,"form-control","form-control-sm"],["for","toDate",1,"form-label","mb-1"],["type","date","id","toDate","formControlName","toDate",1,"form-control","form-control-sm"],["type","submit",1,"btn","btn-primary","btn-sm","mt-4"],[1,"bi","bi-funnel"],["echarts","",1,"chart",2,"width","100%","height","400px",3,"options"]],template:function(t,e){t&1&&(r(0,"div",0),c(1,"div"),r(2,"form",1),D("submit",function(){return e.submitDate()}),r(3,"div",2)(4,"label",3),d(5,"From"),s(),c(6,"input",4),s(),r(7,"div",2)(8,"label",5),d(9,"To"),s(),c(10,"input",6),s(),r(11,"div",2)(12,"button",7),c(13,"i",8),d(14," Filter "),s()()()(),c(15,"div",9)),t&2&&(o(2),h("formGroup",e.formGroup),o(13),h("options",e.lineChartOptions))},dependencies:[lt,ot,ct,ht,dt,pt,Ct],styles:[".chart-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.chart-title[_ngcontent-%COMP%]{margin:0;font-size:1.2rem;font-weight:500}.date-inputs[_ngcontent-%COMP%]   input[type=date][_ngcontent-%COMP%]{padding:4px 6px;font-size:.9rem}.chart-title[_ngcontent-%COMP%]{font-weight:600}.chart-header[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{margin:0}"]})};var zt=["chartContainer"],I=class n{constructor(i){this.http=i}totalUserQb;OtpCardUserQb;OtpAppUserQb;OtherUserQb;totalTransactionsQb;totalMobileTransactionQb;internetTransactionQb;totalOtherTransactionQb;chartData=[];chartContainer;initCardDataQBs(){let i=new gt;this.totalUserQb=new p(i),this.totalUserQb.raw("SELECT count(*) as count from cifmst"),this.OtpAppUserQb=new p(i),this.OtpAppUserQb.raw("SELECT count(*) as count from cifmst where otptype=?",[1]),this.OtpCardUserQb=new p(i),this.OtpCardUserQb.raw("SELECT count(*) as count from cifmst where otptype=?",[2]),this.OtherUserQb=new p(i),this.OtherUserQb.raw("SELECT count(*) as count from cifmst where otptype=?",[3]);let t=new N;this.totalTransactionsQb=new p(t),this.totalTransactionsQb.raw("SELECT count(*) as count from otpchk where status=?",[1]),this.internetTransactionQb=new p(t),this.internetTransactionQb.raw("SELECT count(*) as count from otpchk where status=? and trace_type=?",[1,2]),this.totalMobileTransactionQb=new p(t),this.totalMobileTransactionQb.raw("SELECT count(*) as count from otpchk where status=? and trace_type=?",[1,1]),this.totalOtherTransactionQb=new p(t),this.totalOtherTransactionQb.raw("SELECT count(*) as count from otpchk where status=? and trace_type=?",[1,3])}ngOnInit(){this.initCardDataQBs()}ngAfterViewInit(){this.getChartData(new m(2025,6,1),new m(2025,6,31))}getChartData(i,t){let e=new _(this.chartContainer.nativeElement),a=new p(new N);a.raw("SELECT DATE(trace_date) as day, COUNT(*) as count FROM otpchk WHERE trace_date BETWEEN ? and ? GROUP BY DATE(trace_date) ORDER BY day",[i,t]);let u=z(a.buildParameterized(),b.terminalIp,"");e.show(),this.http.post(b.api,u).then(g=>{this.chartData=g.map(y=>[new m(y[0]),y[1]])}).finally(()=>{e.hide()})}onChartDateChange(i){this.getChartData(i[0],i[1])}static \u0275fac=function(t){return new(t||n)(l(x))};static \u0275cmp=f({type:n,selectors:[["app-dashboard"]],viewQuery:function(t,e){if(t&1&&T(zt,5),t&2){let a;L(a=M())&&(e.chartContainer=a.first)}},standalone:!1,decls:27,vars:9,consts:[["chartContainer",""],[1,"container-fluid","vh-100"],[1,"py-4","d-flex","flex-column"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"mb-0"],[1,"text-muted","mb-4"],[1,"row","g-3"],[1,"col-md-3"],["title","Total Users","value","0","iconClass","bi-people-fill",3,"qb"],["title","OTP Card Users","value","0","iconClass","bi-credit-card-2-front-fill",3,"qb"],["title","OTP App Users","value","0","iconClass","bi-phone-vibrate-fill",3,"qb"],["title","Other Users","value","0","iconClass","bi-person-lines-fill",3,"qb"],["title","Total Transactions","value","0","iconClass","bi-arrow-repeat",3,"qb"],["title","OTP Transactions","value","0","iconClass","bi-shield-lock-fill",3,"qb"],["title","Mobile Transactions","value","0","iconClass","bi-phone-flip",3,"qb"],["title","Other Transactions","value","0","iconClass","bi-box-arrow-left",3,"qb"],[1,"py-4"],[3,"dateChange","data"]],template:function(t,e){if(t&1){let a=et();r(0,"section",1)(1,"div",2)(2,"div",3)(3,"h2",4),d(4,"Dashboard"),s()(),r(5,"h5",5),d(6,"Insights"),s(),r(7,"div",6)(8,"div",7),c(9,"app-stat-card",8),s(),r(10,"div",7),c(11,"app-stat-card",9),s(),r(12,"div",7),c(13,"app-stat-card",10),s(),r(14,"div",7),c(15,"app-stat-card",11),s(),r(16,"div",7),c(17,"app-stat-card",12),s(),r(18,"div",7),c(19,"app-stat-card",13),s(),r(20,"div",7),c(21,"app-stat-card",14),s(),r(22,"div",7),c(23,"app-stat-card",15),s()()(),r(24,"div",16,0)(26,"app-transaction-chart",17),D("dateChange",function(g){return Z(a),W(e.onChartDateChange(g))}),s()()()}t&2&&(o(9),h("qb",e.totalUserQb),o(2),h("qb",e.OtpCardUserQb),o(2),h("qb",e.OtpAppUserQb),o(2),h("qb",e.OtherUserQb),o(2),h("qb",e.totalTransactionsQb),o(2),h("qb",e.totalTransactionsQb),o(2),h("qb",e.totalMobileTransactionQb),o(2),h("qb",e.totalOtherTransactionQb),o(3),h("data",e.chartData))},dependencies:[F,Q],styles:[".stat-card[_ngcontent-%COMP%]{background-color:#fff;border-radius:8px}.icon[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:50%;display:flex;justify-content:center;align-items:center}.bg-light-blue[_ngcontent-%COMP%]{background-color:#e6f2fe}.bg-light-orange[_ngcontent-%COMP%]{background-color:#fff4e5}.bg-light-purple[_ngcontent-%COMP%]{background-color:#eef3fd}.bg-light-red[_ngcontent-%COMP%]{background-color:#ffecec}"]})};var xt=[{path:"",component:I}],yt=class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=S({type:n});static \u0275inj=O({imports:[rt,st.forChild(xt),ut,vt.forRoot({echarts:()=>import("./chunk-IYA3LGM3.js")})]})};export{yt as DashboardModule};
