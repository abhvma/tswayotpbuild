import{a as ne}from"./chunk-ECNNFCQD.js";import{a as ae}from"./chunk-MP5KT637.js";import{b as E}from"./chunk-WRNHRDHX.js";import{a as y,b as _e,c as M}from"./chunk-PPYA3SWL.js";import{b as C}from"./chunk-32H7AQ3L.js";import{b as me}from"./chunk-FLORP3SG.js";import{d as ce}from"./chunk-ESJBOZRO.js";import{a as oe,c as de}from"./chunk-7VL2AYZC.js";import{a as ie}from"./chunk-HVPVQXOI.js";import{b as se,c as le}from"./chunk-ZGLSKZPV.js";import{A as D,B as U,Ba as L,C as w,E as R,F as v,Fb as K,Gb as S,Hb as W,Ia as $,Ib as X,Kb as Y,Mb as Z,Nb as ee,O as s,S as p,Sa as Q,Ta as g,Tb as te,Ua as z,V as b,Vb as re,W as A,Z as j,_ as d,ba as l,eb as H,fa as n,ga as i,gb as J,ha as u,ia as V,ja as B,ka as I,la as f,ma as c,ta as q,ua as a,v as O,va as _,wa as G}from"./chunk-Y6X5IISN.js";import{f as be,h as x}from"./chunk-ENRHZQ2S.js";var fe=be(_e());function Ce(t,o){t&1&&(n(0,"div",20),a(1," Branch Name is required "),i())}function Ue(t,o){t&1&&(n(0,"div",20),a(1," Username is required and must be at least 3 characters long. "),i())}function we(t,o){t&1&&(n(0,"div",21),a(1," The username already exists. "),i())}function Ie(t,o){if(t&1&&(n(0,"div"),a(1),i()),t&2){let e=c().ngIf;s(),G(" Password must be at least ",e.minLength.requiredLength," characters ")}}function Se(t,o){t&1&&(n(0,"div"),a(1," Password must contain at least one uppercase letter "),i())}function xe(t,o){t&1&&(n(0,"div"),a(1," Password must contain at least one lowercase letter "),i())}function ye(t,o){t&1&&(n(0,"div"),a(1," Password must contain at least one special character "),i())}function Me(t,o){t&1&&(n(0,"div"),a(1," Password must contain at least one number "),i())}function Ee(t,o){if(t&1&&(n(0,"div"),d(1,Ie,2,1,"div",22)(2,Se,2,0,"div",22)(3,xe,2,0,"div",22)(4,ye,2,0,"div",22)(5,Me,2,0,"div",22),i()),t&2){let e=o.ngIf;s(),l("ngIf",e.minLength),s(),l("ngIf",e.uppercase),s(),l("ngIf",e.lowercase),s(),l("ngIf",e.specialChar),s(),l("ngIf",e.digit)}}function Te(t,o){if(t&1&&(n(0,"div",20),d(1,Ee,6,5,"div",22),i()),t&2){let e,r=c();s(),l("ngIf",(e=r.userForm.get("password"))==null?null:e.errors)}}function Ne(t,o){t&1&&(n(0,"div",20),a(1," New Password didn't match "),i())}var T=class t{constructor(o,e,r){this.fb=o;this.authService=e;this.toast=r;this.userForm=this.fb.group({userId:["",S.required],password:["",[S.required,ne.password({digit:!0,lower:!0,upper:!0,length:8,special:!0})]],repeatPassword:["",S.required],branchName:[void 0,S.required]})}model;save=new v;cancel=new v;branchOptions=[];setting;authUser=new y;branchMap={};modalTitle="Add User";userForm;eCustomerStatus=se;eOtpType=le;dialogRef;userNotUnique=!1;ngOnInit(){}ngOnChanges(o){this.modalTitle=(this.model,"Edit User");let e=this.model||new y;this.userForm.patchValue({userId:e.userId,branchName:this.authUser.branchName})}onSave(){return x(this,null,function*(){let o=new ie;try{if(o.show(),this.userNotUnique=!1,this.userForm.valid){let e=new y;if(e.fill(this.userForm.value),e.password=(0,fe.sha256)(e.password),this.model)yield this.authService.update(e),this.toast.success("Customer information updated successfully.");else{if(!(yield this.authService.verifyUserIsUnique(e))){o.hide(),this.userNotUnique=!0;return}yield this.authService.create(e),this.toast.success("Customer added successfully.")}this.save.emit(this.userForm.value),this.dialogRef.close(e),o.hide()}else this.userForm.markAllAsTouched()}catch{}finally{o.hide()}})}onCancel(){this.dialogRef.close(void 0),this.cancel.emit()}get formControls(){return this.userForm.controls}static \u0275fac=function(e){return new(e||t)(p(te),p(M),p(oe))};static \u0275cmp=b({type:t,selectors:[["app-user-create-modal"]],inputs:{model:"model",branchOptions:"branchOptions",setting:"setting",authUser:"authUser",branchMap:"branchMap"},outputs:{save:"save",cancel:"cancel"},standalone:!1,features:[L([C]),D],decls:34,vars:8,consts:[[1,"modal-content",3,"formGroup"],[1,"tsway-modal-header"],[1,"tsway-modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"tsway-modal-body"],[1,"row"],[1,"mb-3","col-md-12"],[1,"form-label"],[1,"form-control"],["class","text-danger",4,"ngIf"],["for","userId",1,"form-label"],["id","userId","formControlName","userId","placeholder","Enter Username",1,"form-control"],["class","text-danger","role","alert",4,"ngIf"],["for","password",1,"form-label"],["id","password","formControlName","password","placeholder","Password",1,"form-control"],["for","repeatPassword",1,"form-label"],["id","repeatPassword","formControlName","repeatPassword","placeholder","Repeat Password",1,"form-control"],[1,"tsway-modal-footer","d-flex","flex-row-reverse","justify-content-start"],[1,"btn","btn-primary",3,"click","disabled"],[1,"btn","btn-danger","me-2","text-white",3,"click"],[1,"text-danger"],["role","alert",1,"text-danger"],[4,"ngIf"]],template:function(e,r){e&1&&(n(0,"form",0)(1,"div",1)(2,"h5",2),a(3,"Add User"),i(),n(4,"button",3),f("click",function(){return r.onCancel()}),i()(),n(5,"div",4)(6,"div",5)(7,"div",6)(8,"label",7),a(9,"Branch Name"),i(),n(10,"div",8),a(11),i(),d(12,Ce,2,0,"div",9),i(),n(13,"div",6)(14,"label",10),a(15,"Username"),i(),u(16,"input",11),d(17,Ue,2,0,"div",9)(18,we,2,0,"div",12),i(),n(19,"div",6)(20,"label",13),a(21,"Password"),i(),u(22,"tsway-password",14),d(23,Te,2,1,"div",9),i(),n(24,"div",6)(25,"label",15),a(26,"Repeat Password"),i(),u(27,"tsway-password",16),d(28,Ne,2,0,"div",9),i()()(),n(29,"div",17)(30,"button",18),f("click",function(){return r.onSave()}),a(31," Save "),i(),n(32,"button",19),f("click",function(){return r.onCancel()}),a(33," Cancel "),i()()()),e&2&&(l("formGroup",r.userForm),s(11),_(r.branchMap[r.authUser.branchName]),s(),l("ngIf",r.formControls.branchName.touched&&r.formControls.branchName.invalid),s(5),l("ngIf",r.formControls.userId.touched&&r.formControls.userId.invalid),s(),l("ngIf",r.userNotUnique),s(5),l("ngIf",r.formControls.password.touched&&r.formControls.password.invalid),s(5),l("ngIf",r.formControls.repeatPassword.touched&&r.formControls.repeatPassword.value!==r.formControls.password.value),s(2),l("disabled",r.userForm.invalid))},dependencies:[g,Y,K,W,X,Z,ee,ae],styles:["[_nghost-%COMP%]{font-size:.875rem!important}"]})};function Fe(t,o){if(t&1&&(n(0,"th",3),a(1),i()),t&2){let e=o.$implicit;l("width",e.width),s(),_(e.label)}}function ke(t,o){if(t&1){let e=I();n(0,"button",5),f("click",function(){U(e);let m=c(),h=m.$implicit,P=m.index,ve=c();return w(ve.deleteClick.emit({model:h,index:P}))}),u(1,"i",6),a(2," Delete "),i()}}function Pe(t,o){if(t&1&&(n(0,"tr")(1,"td"),a(2),i(),n(3,"td"),a(4),i(),n(5,"td"),d(6,ke,3,0,"button",4),i()()),t&2){let e=o.$implicit,r=c();s(2),_(e.userId),s(2),_(r.branchMaps[e.branchName]||e.branchName),s(2),l("ngIf",r.currentUser.userId!==e.userId)}}var N=class t{models=[];branchMaps={};editClick=new v;deleteClick=new v;currentUser;columns=[{label:"Username",width:"10%"},{label:"Branch",width:"60%"},{label:"Action",width:"15%"}];static \u0275fac=function(e){return new(e||t)};static \u0275cmp=b({type:t,selectors:[["app-user-table"]],inputs:{models:"models",branchMaps:"branchMaps",currentUser:"currentUser"},outputs:{editClick:"editClick",deleteClick:"deleteClick"},standalone:!1,decls:6,vars:2,consts:[[1,"tsway-datatable","striped"],[3,"width",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[3,"width"],["class","btn btn-sm btn-danger btn-long text-white",3,"click",4,"ngIf"],[1,"btn","btn-sm","btn-danger","btn-long","text-white",3,"click"],[1,"bi","bi-trash"]],template:function(e,r){e&1&&(n(0,"table",0)(1,"thead")(2,"tr"),d(3,Fe,2,2,"th",1),i()(),n(4,"tbody"),d(5,Pe,7,3,"tr",2),i()()),e&2&&(s(3),l("ngForOf",r.columns),s(2),l("ngForOf",r.models))},dependencies:[Q,g],encapsulation:2})};function De(t,o){if(t&1){let e=I();V(0),n(1,"app-user-table",8),f("deleteClick",function(m){U(e);let h=c();return w(h.deleteModel(m))}),i(),B()}if(t&2){let e=c();s(),l("models",e.models)("branchMaps",e.branchMaps)("currentUser",e.currentUser)}}function Re(t,o){t&1&&(n(0,"div",9)(1,"div"),u(2,"i",10),n(3,"p",4),a(4,"No Users found."),i()()())}var F=class t extends me{constructor(e,r,m,h){super(r);this.settingService=m;this.bankService=h;this.modelService=e}currentUser;setting;branches=[];branchMaps={};getFilterParams(){return[{branchName:J(this.currentUser.branchName)}]}ngOnInit(){this.currentUser=this.modelService.authUser(),this.loadModels().then(),this.settingService.find().then(e=>{this.setting=e}),this.bankService.get().then(e=>{this.branches=e,this.branches.forEach(r=>{this.branchMaps[r.branchCode]=r.branchName})})}applyFilters(){}openDialog(e){return x(this,null,function*(){(yield this.dialog.open(T,{model:e,setting:this.setting,authUser:this.currentUser,branchOptions:this.branches,branchMap:this.branchMaps},{width:"22.5%"})).closed.subscribe(m=>{m&&m.branchName===this.currentUser.branchName&&this.models.push(m)})})}static \u0275fac=function(r){return new(r||t)(p(M),p(R),p(C),p(E))};static \u0275cmp=b({type:t,selectors:[["app-user"]],standalone:!1,features:[j],decls:11,vars:2,consts:[["button",""],["noData",""],[1,"container-fluid","py-4","d-flex","flex-column","vh-100"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"mb-0"],[1,"btn","btn-danger","text-white",3,"click"],[1,"bi","bi-plus-lg","me-1"],[4,"ngIf","ngIfElse"],[3,"deleteClick","models","branchMaps","currentUser"],[1,"d-flex","justify-content-center","align-items-center","h-100","text-muted","text-center","px-4"],[1,"bi","bi-search","display-6","d-block","mb-2"]],template:function(r,m){if(r&1){let h=I();n(0,"div",2)(1,"div",3)(2,"h2",4),a(3,"Users"),i(),n(4,"button",5,0),f("click",function(){return U(h),w(m.addModel())}),u(6,"i",6),a(7,"Add New User "),i()(),d(8,De,2,3,"ng-container",7)(9,Re,5,0,"ng-template",null,1,$),i()}if(r&2){let h=q(10);s(8),l("ngIf",m.models.length>0)("ngIfElse",h)}},dependencies:[g,N],encapsulation:2})};var Ae=[{path:"",component:F}],he=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=A({type:t});static \u0275inj=O({providers:[E,C],imports:[ce,z,H.forChild(Ae),re,de]})};export{he as UserModule};
