import{a as j,c as B}from"./chunk-7VL2AYZC.js";import{a as p}from"./chunk-ZGLSKZPV.js";import{$ as x,Cb as L,Ua as E,Ub as F,Vb as Q,W as O,c as P,eb as K,fb as I,gb as r,ib as q,jb as N,qb as c,u as h,v as R,vb as A,wb as S,x as g,xb as _,yb as M}from"./chunk-Y6X5IISN.js";import{g as C,h as k}from"./chunk-ENRHZQ2S.js";var z=(i=>(i[i.Created=0]="Created",i[i.Registered=1]="Registered",i[i.Enrolled=2]="Enrolled",i[i.Active=3]="Active",i[i.Revoked=4]="Revoked",i[i.Unknown=-1]="Unknown",i))(z||{}),U={otpType:"otptype",bankCode:"bank_cd",branchCode:"branch_cd",sequenceNumber:"seqno",otpKey:"otp_key",createdDate:"create_date",status:"status",manufacturingDispatchDate:"out_date",productDeliveryDate:"in_date",keyAssignedDate:"register_date"},d=class extends I{otpType=2;bankCode="";branchCode="";sequenceNumber=0;otpKey="";createdDate=new p;status=0;manufacturingDispatchDate;productDeliveryDate;keyAssignedDate;constructor(){super(),this._mapper=new S(U)}getSoftDelete(){}getPrimaryKeyName(){return"sequenceNumber"}setCreatedDate(e){this.createdDate=new p(e)}setStatus(e){this.status=Number(e)}setOtpType(e){this.otpType=Number(e)}setSequenceNumber(e){this.sequenceNumber=Number(e)}};C([M("seqno")],d.prototype,"sequenceNumber",2),d=C([_("keymst")],d);var y=class u extends A{constructor(e){super(e,d)}getName(){return"serialkey"}generateKey(e){return this.http.post(this.url(),e,{headers:{service:"OTPSVR"}}).then(t=>{if(t?.result.toLocaleLowerCase()==="error")throw console.error(t),t})}getCount(e){let o=this.processQueryParams(this.getQueryBuilder(),e).aggregate({count:"sequenceNumber"}).buildParameterized();return this.http.post(this.url(),c(o)).then(s=>Number(s[0].count_sequenceNumber)||0)}getLastMaxCount(e,t,o){let n=this.getQueryBuilder().aggregate({max:"sequenceNumber"}).where("bankCode",r(e)).where("branchCode",r(t)).where("otpType",r(o)).select().buildParameterized();return this.http.post(this.url(),c(n)).then(i=>Number(i[0].max_sequenceNumber)||0)}getAssignableKeys(e,t,o,s){let n=[{status:r(2)},{bankCode:r(e)},{branchCode:r(t)}];return o&&n.push({otpType:r(o)}),s&&n.push({sequenceNumber:r(s)}),this.get(n).then(i=>i.sort((a,l)=>a.sequenceNumber-l.sequenceNumber))}getFreshKeys(e,t){return this.get([{status:r(2)},{bankCode:r(e)},{branchCode:r(t)}]).then(o=>o.sort((s,n)=>s.sequenceNumber-n.sequenceNumber))}getAssignedKeys(e,t,o){return o||(o=[]),this.get([{status:r(3),bankCode:r(e),branchCode:r(t)}]).then(s=>s.sort((n,i)=>n.sequenceNumber-i.sequenceNumber))}getRangesForStatus(e,t,o,s){let i=this.getQueryBuilder().where("bankCode",r(e)).where("branchCode",r(t)).where("status",r(s)).where("otpType",r(o)).aggregate({min:"sequenceNumber",max:"sequenceNumber"}).select().buildParameterized();return this.http.post(this.url(),c(i)).then(a=>a.length>0?isNaN(a[0].min_sequenceNumber)||isNaN(a[0].max_sequenceNumber)?[0,0]:[+a[0].min_sequenceNumber,+a[0].max_sequenceNumber]:[0,0])}sendForManufacturing(e,t,o,s){let i=this.getQueryBuilder().where("sequenceNumber",q(o)).where("sequenceNumber",N(s)).where("bankCode",r(e)).where("branchCode",r(t)).where("status",r(0)).update({status:1,manufacturingDispatchDate:new p},!1).buildParameterized();return this.http.post(this.url(),c(i)).then()}markAsDelivered(e,t,o,s){let i=this.getQueryBuilder().where("sequenceNumber",q(o)).where("sequenceNumber",N(s)).where("bankCode",r(e)).where("branchCode",r(t)).where("status",r(1)).update({status:2,productDeliveryDate:new p},!1).buildParameterized();return this.http.post(this.url(),c(i)).then()}markAsAssigned(e,t,o){let n=this.getQueryBuilder().where("sequenceNumber",r(o)).where("bankCode",r(e)).where("branchCode",r(t)).where("status",r(2)).update({status:3,keyAssignedDate:new p},!1).buildParameterized();return this.http.post(this.url(),c(n)).then()}voidProduct(e,t,o){let n=this.getQueryBuilder().where("sequenceNumber",r(o)).where("bankCode",r(e)).where("branchCode",r(t)).where("status",r(3)).update({status:4},!1).buildParameterized();return this.http.post(this.url(),c(n)).then()}static \u0275fac=function(t){return new(t||u)(g(L))};static \u0275prov=h({token:u,factory:u.\u0275fac})};var f=class{constructor(e){this.closeFn=e}_closed=new P;closed=this._closed.asObservable();close(e){this._closed.next(e),this._closed.complete(),this.closeFn(e)}};var v=class u{constructor(e){this.appRef=e}getOptions(e){return{clickToClose:e?.clickToClose??!0,className:e?.className??"",width:e?.width??"auto"}}open(e,t,o,s=!0){let{clickToClose:n,className:i}=this.getOptions(o),a=document.createElement("div"),l=document.createElement("div");l.classList.add("modal-dialog"),i&&a.classList.add(...i.split(" ")),o?.width&&(l.style.width=o.width),a.appendChild(l),a.classList.add("dialog-wrapper","tsway-modal","fade-in");let w=()=>k(this,null,function*(){a.classList.remove("fade-in"),yield this.delay(50),a.classList.add("fade-out"),yield this.delay(300),this.appRef.detachView(b.hostView),b.destroy();try{a&&document.body.removeChild(a)}catch{}document.removeEventListener("keyup",T)}),T=m=>{m.key==="Escape"&&(w(),document.removeEventListener("keyup",T))};if(document.addEventListener("keyup",T),s){let m=document.createElement("div");m.classList.add("dialog-overlay","position-fixed","top-0","start-0","w-100","h-100","bg-dark","opacity-50"),a.appendChild(m),n&&a.addEventListener("click",V=>{V.target===m&&w()})}document.body.appendChild(a);let b=this.appRef.bootstrap(e,l);if(t)for(let m in t)b.setInput(m,t[m]);let D=new f(w);return b.instance.dialogRef=D,Promise.resolve(D)}delay(e){return new Promise(t=>setTimeout(t,e))}static \u0275fac=function(t){return new(t||u)(g(x))};static \u0275prov=h({token:u,factory:u.\u0275fac})};var H=class u{static \u0275fac=function(t){return new(t||u)};static \u0275mod=O({type:u});static \u0275inj=R({providers:[v,j,y],imports:[Q,E,K,B,F]})};export{v as a,z as b,y as c,H as d};
