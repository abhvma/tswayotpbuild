import{a as l}from"./chunk-ENRHZQ2S.js";function h(o){return{operator:"=",value:o}}function b(o){return{operator:"<>",value:o}}function N(o){return{operator:">=",value:o}}function x(o){return{operator:"<=",value:o}}function O(o){return{operator:"LIKE",value:o}}function $(o){return{operator:"IN",value:o}}var y=class{constructor(e){this.entity=e;this._mapper=this.entity.getMapper?.()}_selection="*";_filters={};_orFilters={};_orderBy={};_updateData={};_insertData={};_queryType="SELECT";_mapper;_limit="";_aggregates=[];_rawSql=null;_rawParams=[];mapKey(e){return this._mapper?.getApiKey?.(e)??e}raw(e,t=[]){return this._rawSql=e,this._rawParams=t,this}aggregate(e){this._aggregates=[];for(let[t,r]of Object.entries(e)){let n=t.toUpperCase();if(!["COUNT","SUM","AVG","MIN","MAX"].includes(n))throw new Error(`Unsupported aggregate function: ${t}`);let i,a;if(typeof r=="string")i=this.mapKey(r),a=`${t}_${r}`;else if(Array.isArray(r)&&r.length===2)i=this.mapKey(r[0]),a=r[1];else throw new Error(`Invalid aggregate value for ${t}`);this._aggregates.push(`${n}(${i}) AS ${a}`)}return this._queryType="SELECT",this}select(e="*"){return this._selection=e==="*"?"*":e.map(t=>this.mapKey(t)),this._queryType="SELECT",this}where(e){let t=this.mapFilters(e);for(let r in t)this._filters[r]||(this._filters[r]=[]),this._filters[r].push(...t[r]);return this}orWhere(e){let t=this.mapFilters(e);for(let r in t)this._orFilters[r]||(this._orFilters[r]=[]),this._orFilters[r].push(...t[r]);return this}order(e){let t={};for(let[r,n]of Object.entries(e))if(n==="ASC"||n==="DESC")t[this.mapKey(r)]=n;else throw new Error(`Invalid order direction for key "${r}": ${n}`);return this._orderBy=l(l({},this._orderBy),t),this}update(e){this._queryType="UPDATE",this._updateData=e.toJson();let t=this.entity.constructor.__primaryKey,r=this.entity.constructor.__modelKey;return delete this._updateData[r],this.where({[t]:h(e[r])}),this}delete(e){if(this._queryType="DELETE",e){let t=this.entity.constructor.__primaryKey,r=this.entity.constructor.__modelKey;this.where({[t]:h(e[r])})}return this}insert(e){return this._queryType="INSERT",this._insertData=e.toJson(),this}limit(e,t){return this._limit=`LIMIT ${e}`,t&&(this._limit+=`, ${t}`),this}build(){if(this._rawSql!==null)return this._rawSql;let e=this.getEntityName(),t="";switch(this._queryType){case"SELECT":{let r=this._aggregates.length>0?this._aggregates.join(", "):this._selection==="*"?"*":this._selection.join(", "),n=this.buildWhereClause(),i=Object.entries(this._orderBy).map(([a,s])=>`${a} ${s}`).join(", ");t=`SELECT ${r} FROM ${e}${n}${i?` ORDER BY ${i}`:""}`;break}case"UPDATE":{let r=Object.entries(this._updateData).map(([n,i])=>`${this.mapKey(n)} = '${i}'`);t=`UPDATE ${e} SET ${r.join(", ")}${this.buildWhereClause()}`;break}case"DELETE":t=`DELETE FROM ${e}${this.buildWhereClause()}`;break;case"INSERT":{let r=Object.keys(this._insertData).map(i=>this.mapKey(i)),n=Object.values(this._insertData).map(i=>`'${i}'`);t=`INSERT INTO ${e} (${r.join(", ")}) VALUES (${n.join(", ")})`;break}default:throw new Error("Invalid query type")}return this._limit&&(t=`${t} ${this._limit}`),t}buildParameterized(){if(this._rawSql!==null)return[this._rawSql,this._rawParams];let e=[],t=this.getEntityName(),r="",n=[];switch(this._queryType){case"SELECT":{let i=this._aggregates.length>0?this._aggregates.join(", "):this._selection==="*"?"*":this._selection.join(", "),a=this.buildWhereClauseParameterized(e),s=Object.entries(this._orderBy).map(([p,c])=>`${p} ${c}`).join(", ");r=`SELECT ${i} FROM ${t}${a}${s?` ORDER BY ${s}`:""}`;break}case"UPDATE":{let i=Object.entries(this._updateData).map(([s,p])=>(e.push(p),`${this.mapKey(s)} = ?`)),a=this.buildWhereClauseParameterized(e);r=`UPDATE ${t} SET ${i.join(", ")}${a}`;break}case"DELETE":{let i=this.buildWhereClauseParameterized(e);r=`DELETE FROM ${t}${i}`;break}case"INSERT":{let i=Object.keys(this._insertData).map(s=>this.mapKey(s)),a=i.map(()=>"?");Object.values(this._insertData).forEach(s=>e.push(s)),r=`INSERT INTO ${t} (${i.join(", ")}) VALUES (${a.join(", ")})`;break}default:throw new Error("Invalid query type")}if(this._limit){let i=this._limit.match(/LIMIT (\d+)(?:, *(\d+))?/);if(i){let[,a,s]=i;r+=" LIMIT ?,?",n.push(Number(a)),s!==void 0?n.push(Number(s)):(n=[Number(a)],r=r.replace("?,?","?"))}}return[r,[...e,...n]]}mapFilters(e){let t=this.entity.getSoftDelete();t&&(e=l(l({},e),t));let r={};for(let[n,i]of Object.entries(e)){let a=this.mapKey(n),s=typeof i=="object"&&i!==null&&"operator"in i?i:{operator:"=",value:i};typeof s.value>"u"||s.value===null||(r[a]||(r[a]=[]),r[a].push(s))}return r}buildWhereClause(){let e=(a,s,p)=>{switch(s){case"IN":case"NOT IN":return!Array.isArray(p)||p.length===0?"":`${a} ${s} (${p.map(c=>`'${c}'`).join(", ")})`;case"IS NULL":case"IS NOT NULL":return`${a} ${s}`;default:return`${a} ${s} '${p}'`}},t=[];for(let[a,s]of Object.entries(this._filters))for(let p of s){let c=e(a,p.operator,p.value);c&&t.push(c)}let r=[];for(let[a,s]of Object.entries(this._orFilters))for(let p of s){let c=e(a,p.operator,p.value);c&&r.push(c)}if(!t.length&&!r.length)return"";let n=t.join(" AND "),i=r.join(" OR ");return` WHERE ${[n,i].filter(Boolean).join(" OR ")}`}buildWhereClauseParameterized(e){let t=(s,p,c)=>{switch(p){case"IN":case"NOT IN":if(!Array.isArray(c)||c.length===0)return"";c.forEach(g=>e.push(g));let u=c.map(()=>"?").join(", ");return`${s} ${p} (${u})`;case"IS NULL":case"IS NOT NULL":return`${s} ${p}`;default:return e.push(c),`${s} ${p} ?`}},r=[];for(let[s,p]of Object.entries(this._filters))for(let c of p){let u=t(s,c.operator,c.value);u&&r.push(u)}let n=[];for(let[s,p]of Object.entries(this._orFilters))for(let c of p){let u=t(s,c.operator,c.value);u&&n.push(u)}if(!r.length&&!n.length)return"";let i=r.join(" AND "),a=n.join(" OR ");return` WHERE ${[i,a].filter(Boolean).join(" OR ")}`}getEntityName(){let e=this.entity.constructor.__tableName;if(!e)throw new Error(`Table name not found for entity ${this.entity.constructor.name}. Did you forget to add @Table()?`);return e}};var d={"01":"Nepal Bank Ltd","02":"Rastriya Banijya Bank","03":"Agricultural Development Bank","04":"Standard Chartered Bank Nepal","09":"Himalayan Bank",19:"Siddhartha Bank",21:"Nabil Bank",24:"Nepal SBI Bank",25:"Machhapuchchhre Bank",29:"Nepal Investment Mega Bank",32:"Kumari Bank",33:"Laxmi Sunrise Bank",34:"Citizens Bank International",35:"Prabhu Bank",36:"NIC Asia Bank",37:"Sanima Bank",38:"Global IME Bank",39:"Prime Commercial Bank",40:"NMB Bank"},f=Object.entries(d).map(([o,e])=>({code:o,name:e})),_={"001":"Head Office","002":"Main Branch","003":"City Center Branch","004":"Downtown Branch","005":"Suburban Branch"},P=Object.entries(_).map(([o,e])=>({code:o,name:e}));var T=f[0],L={api:"https://192.168.1.150:9200",bankName:T.name,bankCode:T.code,branchName:"Head Office",branchCode:"001",expiryDateLimit:5,retryLimit:3};var E=class o{_mapper;getMapper(){return this._mapper}setPropertyValue(e,t){let r=this;if(Object.hasOwn(r,e)){let n="set"+e.charAt(0).toUpperCase()+e.slice(1);typeof r[n]=="function"?r[n](t):r[e]=t}}copy(){let e=new this.constructor;return e.fill(o.create(e.constructor,this.toJson())),e}fill(e){for(let t in e)Object.hasOwn(this,t)&&this.setPropertyValue(t,e[t])}toJson(){let e={};for(let t in this){if(this.constructor.__ignoredProperties&&this.constructor.__ignoredProperties.indexOf(t)>-1)continue;let r="get"+t.charAt(0).toUpperCase()+t.slice(1);if(typeof this[t]!="function"&&t[0]!=="_")if(this._mapper){let n=this._mapper.getApiKey(t);n&&(e[n]=this[t],typeof this[r]=="function"&&(e[n]=this[r]()))}else e[t]=this[t],typeof this[r]=="function"&&(e[t]=this[r]())}return e}static create(e,t){let r=new e;for(let n in t){let i=r.getMapper().getModelKey(n),a=r.getMapper().getApiKey(i);if(t.hasOwnProperty(a)){let s="set"+i.charAt(0).toUpperCase()+i.slice(1);typeof r[s]=="function"?r[s](t[n]):r[i]=t[n],r.setPropertyValue(i,t[n])}}return r}static createFromList(e,t){return t.map(r=>o.create(e,r))}};var m=class{constructor(e={}){this.config=e}getModelKey(e){let t=Object.entries(this.config).find(([r,n])=>n===e);return t?t[0]:e.replace(/_([a-z])/g,(r,n)=>n.toUpperCase())}getApiKey(e){return this.config[e]?this.config[e]:e.replace(/([A-Z])/g,"_$1").toLowerCase()}};function q(o){return function(e){e.__tableName=o}}function K(o){return function(e,t){e.constructor.__primaryKey=o||t,e.constructor.__modelKey=t}}function R(){return function(o,e){o.constructor.__ignoredProperties||(o.constructor.__ignoredProperties=[]),o.constructor.__ignoredProperties.push(e)}}export{E as a,h as b,b as c,N as d,x as e,O as f,$ as g,y as h,d as i,f as j,_ as k,P as l,L as m,m as n,q as o,K as p,R as q};
