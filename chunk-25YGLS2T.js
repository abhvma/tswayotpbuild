import{a as _e}from"./chunk-ECNNFCQD.js";import{a as Se}from"./chunk-IUBWDM65.js";import{a as ye}from"./chunk-XDAN63FQ.js";import{a as Pe,b as w}from"./chunk-7EI4JI2G.js";import{a as O,b as M}from"./chunk-RSQTPDTL.js";import{a as X,b as U}from"./chunk-KZY5ZNMI.js";import{a as I}from"./chunk-HVPVQXOI.js";import{a as G,h as xe}from"./chunk-CQZ4ATFG.js";import{$a as ve,Ab as Ce,B as d,Bb as j,C as f,D as E,Ea as me,Ga as ce,H as c,Ha as pe,Ia as W,L as l,N as ne,P as o,Q as i,R as m,S as ie,Sa as fe,T as oe,U as ae,Ua as Te,V as u,W as y,Wa as ue,ba as re,ca as r,da as g,ea as h,ja as T,k,ka as se,kb as he,lb as b,mb as B,nb as F,pb as D,q as ee,qa as le,r as te,rb as L,sb as A,t as Q,tb as ge,ub as be,vb as we,wa as P,xa as x,y as s,ya as de,yb as R}from"./chunk-3IBPSVRT.js";import{f as Ee,h as S}from"./chunk-ENRHZQ2S.js";var Be=()=>({exact:!1});function Fe(t,n){if(t&1&&(o(0,"li",6)(1,"a",9),m(2,"i"),r(3),i()()),t&2){let e=n.$implicit;s(),l("routerLink",e.path)("routerLinkActiveOptions",se(5,Be)),s(),ne("bi "+e.icon),s(),h(" ",e.label," ")}}var V=class t{constructor(){}brandName="OTP Management System";navLinks=[{label:"Dashboard",path:"/manage/dashboard",icon:"bi-speedometer2"},{label:"Customers",path:"/manage/customers",icon:"bi-people"},{label:"Cards & Tokens",path:"/manage/cards-tokens",icon:"bi-key"},{label:"Transaction Logs",path:"/manage/transactions",icon:"bi-file-earmark-text"},{label:"OTP Logs",path:"/manage/otplogs",icon:"bi-shield-lock"},{label:"Users",path:"/manage/users",icon:"bi-people"},{label:"Settings",path:"/manage/settings",icon:"bi-gear"}];static \u0275fac=function(e){return new(e||t)};static \u0275cmp=f({type:t,selectors:[["app-navbar"]],standalone:!1,decls:11,vars:2,consts:[[1,"sidebar","d-flex","flex-column","p-3","bg-primary","text-white"],[1,"sidebar-rounded"],[1,"brand-container"],[1,"brandname","fs-5","fw-bold","text-decoration-none"],[1,"nav","nav-pills","flex-column"],["class","nav-item mb-2",4,"ngFor","ngForOf"],[1,"nav-item","mb-2"],["role","button",1,"nav-link","d-flex","align-items-center","gap-2"],[1,"bi","bi-file-earmark-pdf"],["routerLinkActive","active",1,"nav-link","d-flex","align-items-center","gap-2",3,"routerLink","routerLinkActiveOptions"]],template:function(e,a){e&1&&(o(0,"aside",0)(1,"div",1)(2,"div",2)(3,"a",3),r(4),i()(),o(5,"ul",4),c(6,Fe,4,6,"li",5),o(7,"li",6)(8,"a",7),m(9,"i",8),r(10," Download Manual"),i()()()()()),e&2&&(s(4),h(" ",a.brandName," "),s(2),l("ngForOf",a.navLinks))},dependencies:[P,ce,pe],styles:[".sidebar[_ngcontent-%COMP%]{position:fixed;height:100vh;width:16rem;top:0;left:0;padding-top:1rem;z-index:1000}.brand-container[_ngcontent-%COMP%]{margin-bottom:2rem}.brandname[_ngcontent-%COMP%]{color:var(--bs-white-rgb);margin-bottom:3rem}.nav-link.active[_ngcontent-%COMP%]{background-color:#0d6efd;color:#fff!important}.nav-link[_ngcontent-%COMP%]{color:var(--bs-white);background-color:transparent;border-radius:.375rem;transition:background-color .2s ease,color .2s ease}.nav-link[_ngcontent-%COMP%]:hover{background-color:rgba(var(--bs-white-rgb),.1);color:var(--bs-white)}.nav-link.active[_ngcontent-%COMP%]{background-color:var(--bs-danger);color:var(--bs-white)!important}.nav-link[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.1rem}"]})};var Ie=Ee(Te());function Re(t,n){if(t&1&&(o(0,"div",17),r(1),i()),t&2){let e=y();s(),g(e.errorMessage)}}function je(t,n){t&1&&(o(0,"div",17),r(1," Old Password is required "),i())}function Ge(t,n){t&1&&(o(0,"div"),r(1," New password is required "),i())}function Ue(t,n){if(t&1&&(o(0,"div"),r(1),i()),t&2){let e=y().ngIf;s(),h(" Password must be at least ",e.minLength.requiredLength," characters ")}}function Ve(t,n){t&1&&(o(0,"div"),r(1," Password must contain at least one uppercase letter "),i())}function qe(t,n){t&1&&(o(0,"div"),r(1," Password must contain at least one lowercase letter "),i())}function He(t,n){t&1&&(o(0,"div"),r(1," Password must contain at least one special character "),i())}function ze(t,n){t&1&&(o(0,"div"),r(1," Password must contain at least one number "),i())}function $e(t,n){if(t&1&&(o(0,"div",17),c(1,Ge,2,0,"div",18)(2,Ue,2,1,"div",18)(3,Ve,2,0,"div",18)(4,qe,2,0,"div",18)(5,He,2,0,"div",18)(6,ze,2,0,"div",18),i()),t&2){let e=n.ngIf;s(),l("ngIf",e.required),s(),l("ngIf",e.minLength),s(),l("ngIf",e.uppercase),s(),l("ngIf",e.lowercase),s(),l("ngIf",e.specialChar),s(),l("ngIf",e.digit)}}function Ke(t,n){if(t&1&&(o(0,"div",17),c(1,$e,7,6,"div",5),i()),t&2){let e,a=y();s(),l("ngIf",(e=a.form.get("newPassword"))==null?null:e.errors)}}function Ye(t,n){t&1&&(o(0,"div",17),r(1," New password is required "),i())}function Je(t,n){t&1&&(o(0,"div",17),r(1," New Password didn't match "),i())}var q=class t{constructor(n,e,a){this.fb=n;this.toast=e;this.userService=a;this.form=this.fb.group({oldPassword:["",b.required],newPassword:["",[b.required,b.minLength(8),_e.password({digit:!0,length:8,lower:!0,upper:!0,special:!0})]],repeatPassword:["",[b.required,b.minLength(8)]]})}model;save=new Q;cancel=new Q;modalTitle="Change Password";errorMessage="";form;dialogRef;customerNotUnique=!1;onSave(){this.errorMessage="";let n=new I,e=this.form.value;if(e.oldPassword!==this.model.plainPassword){this.errorMessage="Your old password didn't match. Please try again";return}if(e.oldPassword===e.newPassword){this.errorMessage="New password cannot be same as the old one.";return}let a=new O;a.fill({userId:this.model?.userId,password:(0,Ie.sha256)(this.form.value.newPassword),branchName:this.model?.branchName,plainPassword:this.form.value.newPassword}),n.show(),this.userService.update(a).then(()=>{this.toast.success("Password updated successfully"),this.dialogRef.close(void 0),window.location.reload()}).finally(()=>{n.hide()})}onCancel(){this.dialogRef.close(void 0),this.cancel.emit()}get formControls(){return this.form.controls}static \u0275fac=function(e){return new(e||t)(d(R),d(j),d(M))};static \u0275cmp=f({type:t,selectors:[["app-password-change-modal"]],inputs:{model:"model"},outputs:{save:"save",cancel:"cancel"},standalone:!1,features:[T([])],decls:29,vars:6,consts:[[1,"modal-content",3,"formGroup"],[1,"tsway-modal-header"],[1,"tsway-modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"tsway-modal-body"],["class","text-danger",4,"ngIf"],[1,"row"],[1,"mb-3","col-md-12"],["for","oldPasswod",1,"form-label"],["id","oldPasswod","formControlName","oldPassword","placeholder","Old Password",1,"form-control"],["for","newPassword",1,"form-label"],["id","newPassword","formControlName","newPassword","placeholder","New Password",1,"form-control"],["for","repeatPassword",1,"form-label"],["id","repeatPassword","formControlName","repeatPassword","placeholder","Repeat Password",1,"form-control"],[1,"tsway-modal-footer","d-flex","flex-row-reverse","justify-content-start"],[1,"btn","btn-primary",3,"click"],[1,"btn","btn-danger","me-2","text-white",3,"click"],[1,"text-danger"],[4,"ngIf"]],template:function(e,a){e&1&&(o(0,"form",0)(1,"div",1)(2,"h5",2),r(3,"Change Password"),i(),o(4,"button",3),u("click",function(){return a.onCancel()}),i()(),o(5,"div",4),c(6,Re,2,1,"div",5),o(7,"div",6)(8,"div",7)(9,"label",8),r(10,"Old Password"),i(),m(11,"tsway-password",9),c(12,je,2,0,"div",5),i(),o(13,"div",7)(14,"label",10),r(15,"New Password"),i(),m(16,"tsway-password",11),c(17,Ke,2,1,"div",5),i(),o(18,"div",7)(19,"label",12),r(20,"Repeat Password"),i(),m(21,"tsway-password",13),c(22,Ye,2,0,"div",5)(23,Je,2,0,"div",5),i()()(),o(24,"div",14)(25,"button",15),u("click",function(){return a.onSave()}),r(26,"Save"),i(),o(27,"button",16),u("click",function(){return a.onCancel()}),r(28," Cancel "),i()()()),e&2&&(l("formGroup",a.form),s(6),l("ngIf",a.errorMessage),s(6),l("ngIf",a.formControls.oldPassword.touched&&a.formControls.oldPassword.invalid),s(5),l("ngIf",a.formControls.newPassword.touched&&a.formControls.newPassword.invalid),s(5),l("ngIf",a.formControls.repeatPassword.touched&&a.formControls.repeatPassword.invalid),s(),l("ngIf",a.formControls.repeatPassword.touched&&a.formControls.repeatPassword.value!==a.formControls.newPassword.value))},dependencies:[D,B,F,L,A,x,Se],styles:["[_nghost-%COMP%]{font-size:.875rem!important}"]})};var H=class t{constructor(n,e,a,p){this.authService=n;this.ctxMenuService=e;this.dialog=a;this.branchService=p}username="";branchName="";navItems=[{label:"Change Password",enabled:!0,icon:"bi bi-key",name:"changepassword"},{label:"Logout",enabled:!0,icon:"bi bi-box-arrow-left",name:"logout"}];ngOnInit(){this.username=this.authService.authUser()?.userId||"",this.branchService.get().then(n=>{this.branchName=this.branchService.getBranchForCode(this.authService.authUser()?.branchName)?.branchName})}ngAfterViewInit(){this.ctxMenuService.itemSelected.subscribe(n=>{n.name==="changepassword"&&this.dialog.open(q,{model:this.authService.authUser()},{width:"30%"}),n.name==="logout"&&this.authService.logout()})}onAvatarClick(n){this.ctxMenuService.show(this.navItems,n.target,"bottom")}static \u0275fac=function(e){return new(e||t)(d(M),d(ye),d(G),d(w))};static \u0275cmp=f({type:t,selectors:[["app-top-navbar"]],standalone:!1,decls:10,vars:3,consts:[[1,"navbar","navbar-light","bg-light"],[1,"container-fluid","justify-content-end"],["role","button",1,"d-flex","align-items-center",3,"click"],[1,"avatar","bg-primary","text-white","rounded-circle","d-flex","align-items-center","justify-content-center","me-2",2,"width","40px","height","40px"],[1,"d-flex","flex-column"],[1,"fw-bold"],[1,"text-muted"]],template:function(e,a){e&1&&(o(0,"nav",0)(1,"div",1)(2,"div",2),u("click",function(v){return a.onAvatarClick(v)}),o(3,"div",3),r(4),i(),o(5,"div",4)(6,"span",5),r(7),i(),o(8,"small",6),r(9),i()()()()()),e&2&&(s(4),h(" ",a.username.charAt(0)," "),s(3),g(a.username),s(2),g(a.branchName))},styles:[".navbar[_ngcontent-%COMP%]{width:100%;position:fixed;padding-left:24px;z-index:900}.navbar[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:40px;height:40px;font-weight:700}"]})};var z=class t{static \u0275fac=function(e){return new(e||t)};static \u0275cmp=f({type:t,selectors:[["app-admin"]],standalone:!1,decls:5,vars:0,consts:[[1,"d-flex","flex-row"],[1,"main-content","flex-fill"]],template:function(e,a){e&1&&(o(0,"div",0),m(1,"app-navbar")(2,"app-top-navbar"),o(3,"div",1),m(4,"router-outlet"),i()())},dependencies:[me,V,H],styles:[".main-content[_ngcontent-%COMP%]{margin-top:56px;margin-left:17rem}"]})};function Xe(t,n){if(t&1&&(o(0,"tr")(1,"td"),r(2),i(),o(3,"td"),r(4),i()()),t&2){let e=n.$implicit;s(2),g(e.branchName),s(2),g(e.branchCode)}}function Ze(t,n){if(t&1&&(ie(0),o(1,"table",7)(2,"thead")(3,"tr")(4,"th"),r(5,"Branch Name"),i(),o(6,"th"),r(7,"Branch Code"),i()()(),o(8,"tbody"),c(9,Xe,5,2,"tr",8),i()(),oe()),t&2){let e=y();s(9),l("ngForOf",e.models)}}function et(t,n){t&1&&(o(0,"div",9)(1,"div",10),m(2,"i",11),o(3,"p",12),r(4,"No Branch Found."),i()()())}var $=class t{constructor(n){this.modelService=n}models=[];dialogRef;ngOnInit(){this.modelService.get(void 0,{branchName:"ASC"}).then(n=>{this.models=n})}onCancel(){this.dialogRef.close(void 0)}static \u0275fac=function(e){return new(e||t)(d(w))};static \u0275cmp=f({type:t,selectors:[["app-branch-list-modal"]],standalone:!1,decls:9,vars:2,consts:[["noData",""],[1,"modal-content","pb-5"],[1,"tsway-modal-header"],[1,"tsway-modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"tsway-modal-body"],[4,"ngIf","ngIfElse"],[1,"tsway-datatable","striped"],[4,"ngFor","ngForOf"],[1,"d-flex","justify-content-center","align-items-center","h-100","text-muted","text-center","px-4"],[1,"pt-5"],[1,"bi","bi-search","display-6","d-block","mb-2"],[1,"mb-0"]],template:function(e,a){if(e&1){let p=ae();o(0,"div",1)(1,"div",2)(2,"h5",3),r(3,"Branches"),i(),o(4,"button",4),u("click",function(){return ee(p),te(a.onCancel())}),i()(),o(5,"div",5),c(6,Ze,10,1,"ng-container",6)(7,et,5,0,"ng-template",null,0,le),i()()}if(e&2){let p=re(8);s(6),l("ngIf",a.models.length>0)("ngIfElse",p)}},dependencies:[P,x],encapsulation:2})};function tt(t,n){t&1&&(o(0,"div",25),r(1," Retry limit must be atleast 1 "),i())}function nt(t,n){if(t&1&&(o(0,"option",26),r(1),i()),t&2){let e=n.$implicit;l("value",e.code),s(),h(" ",e.name," ")}}var K=class t{constructor(n,e,a,p,v,C){this.settingService=n;this.toast=a;this.bankService=p;this.authService=v;this.dialog=C;this.formGroup=e.group({id:[""],bankCode:[""],branchCode:[""],otpRetryLimit:["",b.min(1)],smtpServer:[""],smtpPort:[""],smtpUser:[""],smtpPass:[""]})}bankOptions=fe;branchOptions=[];settingModel=new X;formGroup;ngOnInit(){return S(this,null,function*(){let n=new I;try{let e=yield this.settingService.get();e.length>0&&(this.settingModel=e[0],this.formGroup.patchValue(this.settingModel))}catch{}finally{n.hide()}})}saveSettings(){return S(this,null,function*(){let n=new I;try{let e=new X;e.fill(this.formGroup.value),e.id=this.settingModel.id,n.show(),e.id?yield this.settingService.update(e):yield this.settingService.create(e),this.toast.success("Settings updated.")}finally{n.hide()}})}createUserForBranch(n){return S(this,null,function*(){let e=new O;return e.userId=n.bankCode.padStart(4,"0")+n.branchCode.padStart(4,"0"),e.branchName=n.branchCode,e.password=ve(`secret${e.userId}`),this.authService.create(e).then()})}uploadBranches(n){return S(this,null,function*(){try{let e=n.target.files?.item(0);if(n.target.value="",!e){this.toast.error("Please select a file to upload.");return}if(e.type!=="text/csv"){this.toast.error("The file type should be a csv file.");return}if(!this.settingModel.bankCode){this.toast.error("You must select a default bank before you can upload branches.");return}let a=yield ue(e);if(a.length===0)return;let p=yield this.bankService.get();for(let v of a){if(v.length<2){let J="The csv should have the format of branchCode,BranchName";throw new Error(J)}let C=new Pe;if(C.bankCode=this.settingModel.bankCode,C.branchCode=v[0],C.branchName=v[1],!p.find(J=>J.branchCode===C.branchCode)){yield this.bankService.create(C);try{yield this.createUserForBranch(C)}catch{}}}this.toast.success("Branch information updated successfully.")}catch(e){this.toast.error("Failed upload.  "+e)}})}viewBranches(){return S(this,null,function*(){yield this.dialog.open($,void 0,{width:"40%"})})}static \u0275fac=function(e){return new(e||t)(d(U),d(R),d(j),d(w),d(M),d(G))};static \u0275cmp=f({type:t,selectors:[["app-settings"]],standalone:!1,features:[T([U,w])],decls:42,vars:4,consts:[[1,"container","py-5",3,"formGroup"],[1,"mb-4","fw-semibold"],[1,"d-flex","justify-content-end","mb-2"],[1,"me-3"],["role","button","for","uploadBranch",1,"btn-link","text-muted","small","text-decoration-none"],["id","uploadBranch","type","file","hidden","","accept","text/csv",3,"change"],[1,"bi","bi-filetype-csv","me-1"],["title","The content of the file should be branchcode,branchname.",1,"bi","bi-question-circle","ms-2"],["role","button",1,"btn-link","text-muted","small","text-decoration-none",3,"click"],[1,"mb-5"],[1,"tsway-card"],[1,"tsway-card-header"],[1,"mb-0"],[1,"tsway-card-body","pt-3","pe-3","ps-3"],[1,"mb-3","row"],[1,"col-sm-4","col-form-label"],[1,"col-sm-8"],["formControlName","otpRetryLimit","type","text","placeholder","Enter max retry limit",1,"form-control"],["class","text-danger",4,"ngIf"],[1,"tsway-card","tsway-card"],["formControlName","bankCode","placeholder","Enter default bank name or code",1,"form-control"],["disabled",""],[3,"value",4,"ngFor","ngForOf"],[1,"text-end"],[1,"btn","btn-primary","btn-lg","px-5",3,"click","disabled"],[1,"text-danger"],[3,"value"]],template:function(e,a){e&1&&(o(0,"form",0)(1,"h2",1),r(2,"Settings"),i(),o(3,"div",2)(4,"div",3)(5,"label",4)(6,"input",5),u("change",function(v){return a.uploadBranches(v)}),i(),m(7,"i",6),r(8,"Upload Branch"),i(),m(9,"i",7),i(),o(10,"div")(11,"a",8),u("click",function(){return a.viewBranches()}),r(12," View Branches"),i()()(),o(13,"section",9)(14,"div",10)(15,"div",11)(16,"h6",12),r(17,"OTP Settings"),i()(),o(18,"div",13)(19,"div",14)(20,"label",15),r(21,"Max Retry Limit for OTPs"),i(),o(22,"div",16),m(23,"input",17),c(24,tt,2,0,"div",18),i()()()()(),o(25,"section",9)(26,"div",19)(27,"div",11)(28,"h6",12),r(29,"Bank Settings"),i()(),o(30,"div",13)(31,"div",14)(32,"label",15),r(33,"Default Bank"),i(),o(34,"div",16)(35,"select",20)(36,"option",21),r(37,"Select One"),i(),c(38,nt,2,2,"option",22),i()()()()()(),o(39,"div",23)(40,"button",24),u("click",function(){return a.saveSettings()}),r(41," Save Settings "),i()()()),e&2&&(l("formGroup",a.formGroup),s(24),l("ngIf",a.formGroup.controls.otpRetryLimit.invalid),s(14),l("ngForOf",a.bankOptions),s(2),l("disabled",a.formGroup.invalid))},dependencies:[P,x,D,be,we,he,ge,B,F,L,A],encapsulation:2})};var it=[{path:"",component:z,children:[{path:"",redirectTo:"dashboard",pathMatch:"full"},{path:"dashboard",loadChildren:()=>import("./chunk-MI7DWLJB.js").then(t=>t.DashboardModule)},{path:"customers",loadChildren:()=>import("./chunk-E7OHWDW5.js").then(t=>t.HomeModule)},{path:"transactions",loadChildren:()=>import("./chunk-P7PUX5M2.js").then(t=>t.TransactionLogModule)},{path:"otplogs",loadChildren:()=>import("./chunk-P232X7UK.js").then(t=>t.OtpCheckModule)},{path:"users",loadChildren:()=>import("./chunk-N34AKLFG.js").then(t=>t.UserModule)},{path:"cards-tokens",loadChildren:()=>import("./chunk-5VEJZOM7.js").then(t=>t.OtpSerialKeyModule)},{path:"settings",component:K}]}],Y=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=E({type:t});static \u0275inj=k({imports:[W.forChild(it),W]})};var ke=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=E({type:t});static \u0275inj=k({imports:[Y,xe,de,Ce]})};export{ke as AdminModule};
