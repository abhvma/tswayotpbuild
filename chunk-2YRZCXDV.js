import{a as le,b as me}from"./chunk-TFFLQK24.js";import{b as re}from"./chunk-IDTBANS2.js";import{a as z}from"./chunk-5ZKVGYZB.js";import{c as ae}from"./chunk-U6LKOZVF.js";import{b as S}from"./chunk-44S3GGHA.js";import"./chunk-HVPVQXOI.js";import{a as H,d as $,e as K,n as J,o as U}from"./chunk-MXDAFLWT.js";import{A as F,B as D,Ca as V,D as N,E as T,Ma as A,N as a,Na as G,Oa as Q,R as h,U as p,V as P,Y as k,Z as d,_a as B,aa as m,bb as W,cb as X,db as L,ea as r,eb as Y,fa as o,fb as Z,ga as c,gb as ee,ha as O,hb as te,ia as j,ib as ne,ja as y,ka as b,la as v,ob as oe,pb as ie,sa as R,t as E,ta as l,u as q,ua as f,w as M}from"./chunk-VL4RAH5U.js";import"./chunk-FK6H3RFT.js";import{g as w}from"./chunk-ENRHZQ2S.js";var de={traceDate:"trace_date",traceSequence:"trace_seq",terminalIp:"terminal_ip",sqlText:"sql_txt"},g=class extends H{traceDate="";traceSequence="";terminalIp="";sqlText="";constructor(){super(),this._mapper=new J(de)}getPrimaryKeyName(){return""}getSoftDelete(){}};g=w([U("trlog")],g);var u=class n extends z{constructor(t){super(t,g)}getName(){return"transtactions"}static \u0275fac=function(e){return new(e||n)(M(W))};static \u0275prov=E({token:n,factory:n.\u0275fac})};function ge(n,t){if(n&1&&(r(0,"th",3),l(1),o()),n&2){let e=t.$implicit;m("width",e.width),a(),f(e.label)}}function ue(n,t){if(n&1&&(r(0,"tr")(1,"td"),l(2),o(),r(3,"td"),l(4),o(),r(5,"td"),l(6),o(),r(7,"td"),l(8),o()()),n&2){let e=t.$implicit;a(2),f(e.traceSequence),a(2),f(e.terminalIp),a(2),f(e.sqlText),a(2),f(e.traceDate)}}var x=class n{models=[];editClick=new T;deleteClick=new T;columns=[{label:"Trace Sequence",width:"10%"},{label:"Terminal IP",width:"20%"},{label:"SQL Text",width:"60%"},{label:"Trace Date",width:"20%"}];static \u0275fac=function(e){return new(e||n)};static \u0275cmp=p({type:n,selectors:[["app-transaction-log-table"]],inputs:{models:"models"},outputs:{editClick:"editClick",deleteClick:"deleteClick"},standalone:!1,decls:6,vars:2,consts:[[1,"tsway-datatable","striped"],[3,"width",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[3,"width"]],template:function(e,i){e&1&&(r(0,"table",0)(1,"thead")(2,"tr"),d(3,ge,2,2,"th",1),o()(),r(4,"tbody"),d(5,ue,9,4,"tr",2),o()()),e&2&&(a(3),m("ngForOf",i.columns),a(2),m("ngForOf",i.models))},dependencies:[A],encapsulation:2})};var I=class n{constructor(t){this.fb=t;this.filterForm=this.fb.group({traceDateTo:["",L.required],traceDateFrom:["",L.required],terminalIp:""})}filterChange=new T;filterForm;subscriptions=[];emitFilter(){this.filterChange.emit(this.filterForm.value)}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe())}static \u0275fac=function(e){return new(e||n)(h(oe))};static \u0275cmp=p({type:n,selectors:[["app-transaction-log-filterbar"]],outputs:{filterChange:"filterChange"},standalone:!1,decls:14,vars:2,consts:[[1,"filterbar","mb-3"],[1,"row","g-3","align-items-end","filter-form-container",3,"formGroup"],[1,"col-md-2"],["for","traceDateFrom",1,"form-label","small","mb-1"],["type","date","id","traceDateFrom","formControlName","traceDateFrom",1,"form-control"],["for","traceDateTo",1,"form-label","small","mb-1"],["type","date","id","traceDateTo","formControlName","traceDateTo",1,"form-control"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"bi","bi-search","me-1"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"form",1)(2,"div",2)(3,"label",3),l(4,"Trace From"),o(),c(5,"input",4),o(),r(6,"div",2)(7,"label",5),l(8,"Trace To"),o(),c(9,"input",6),o(),r(10,"div",2)(11,"button",7),b("click",function(){return i.emitFilter()}),c(12,"i",8),l(13,"Search "),o()()()()),e&2&&(a(),m("formGroup",i.filterForm),a(10),m("disabled",i.filterForm.invalid))},dependencies:[ee,X,Y,Z,te,ne],encapsulation:2})};function he(n,t){if(n&1){let e=y();r(0,"div",7)(1,"a",8),b("click",function(){F(e);let s=v();return D(s.downloadTable())}),c(2,"i",9),l(3," Download PDF "),o()()}}function ve(n,t){if(n&1&&(O(0),c(1,"app-transaction-log-table",10),j()),n&2){let e=v();a(),m("models",e.models)}}function Ce(n,t){n&1&&(r(0,"div")(1,"p",3),l(2,"Search for Transaction logs"),o()())}function xe(n,t){n&1&&(r(0,"div")(1,"p",3),l(2,"No transaction log found."),o()())}function Ie(n,t){if(n&1&&(r(0,"div",11)(1,"div"),c(2,"i",12),d(3,Ce,3,0,"div",13)(4,xe,3,0,"div",13),o()()),n&2){let e=v();a(3),m("ngIf",!e.hasSearched),a(),m("ngIf",e.hasSearched)}}var _=class n extends re{hasSearched=!1;currentPage=0;itemLimit=100;constructor(t){super(t),this.modelService=t.get(u)}ngOnInit(){}loadModels(){let t=[];return this.modelFilters.traceDateFrom&&t.push({traceDate:$(new S(this.modelFilters.traceDateFrom))}),this.modelFilters.traceDateTo&&t.push({traceDate:K(new S(this.modelFilters.traceDateTo))}),this.modelService.paginate(t,{traceDate:"DESC"},this.currentPage,this.itemLimit).then(e=>(this.models=e,this.hasSearched=!0,this.models)).catch(e=>(this.toast.error("Failed to load transaction logs"),[]))}openDialog(t){throw new Error("Method not implemented.")}applyFilters(){throw new Error("Method not implemented.")}onFilterChange(t){this.modelFilters=t,this.loadModels()}downloadTable(){let t=new le;t.setFontSize(12);let e=this.models.map(i=>({traceSequence:i.traceSequence,terminalIp:i.terminalIp,sqlText:i.sqlText,traceDate:i.traceDate.toLocaleString()}));me(t,{head:[["Trace Sequence","Terminal IP","Sql Text","Trace Date"]],body:e.map(i=>[i.traceSequence,i.terminalIp,i.sqlText,i.traceDate])}),t.save(`transaction-log${new Date().toDateString()}.pdf`)}static \u0275fac=function(e){return new(e||n)(h(N))};static \u0275cmp=p({type:n,selectors:[["app-transaction-log"]],standalone:!1,features:[k],decls:9,vars:3,consts:[["noData",""],[1,"container-fluid","py-4","d-flex","flex-column","vh-100"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"mb-0"],[3,"filterChange"],["class","d-flex justify-content-end mb-2",4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"d-flex","justify-content-end","mb-2"],["role","button",1,"btn-link","text-muted","small","text-decoration-none",3,"click"],[1,"bi","bi-file-earmark-pdf","me-1"],[3,"models"],[1,"d-flex","justify-content-center","align-items-center","h-100","text-muted","text-center","px-4"],[1,"bi","bi-search","display-6","d-block","mb-2"],[4,"ngIf"]],template:function(e,i){if(e&1){let s=y();r(0,"div",1)(1,"div",2)(2,"h2",3),l(3,"Transaction Logs"),o()(),r(4,"app-transaction-log-filterbar",4),b("filterChange",function(pe){return F(s),D(i.onFilterChange(pe))}),o(),d(5,he,4,0,"div",5)(6,ve,2,1,"ng-container",6)(7,Ie,5,2,"ng-template",null,0,V),o()}if(e&2){let s=R(8);a(5),m("ngIf",i.models.length>0),a(),m("ngIf",i.models.length>0)("ngIfElse",s)}},dependencies:[G,x,I],encapsulation:2})};var _e=[{path:"",component:_}],se=class n{static \u0275fac=function(e){return new(e||n)};static \u0275mod=P({type:n});static \u0275inj=q({providers:[u],imports:[ae,Q,B.forChild(_e),ie]})};export{se as TransactionLogModule};
