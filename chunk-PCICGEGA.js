import{r as K,s as T}from"./chunk-CCX2XD6M.js";import{$ as P,B as C,C as k,E as B,P as u,Qa as L,T as M,W as F,Y as R,cb as j,da as D,ga as E,ha as y,ia as m,ma as N,na as b,oa as S,u as O,x as A,xa as g,ya as w}from"./chunk-SDMJB54G.js";import{a as f,g as h}from"./chunk-WR2VUDLS.js";function $(s){return{operator:"=",value:s}}function et(s){return{operator:"<>",value:s}}function rt(s){return{operator:">=",value:s}}function it(s){return{operator:"<=",value:s}}function nt(s){return{operator:"LIKE",value:s}}function st(s){return{operator:"IN",value:s}}function q(s,t="YYYY-MM-DD HH:mm:ss"){let e=s.getFullYear(),r=String(s.getMonth()+1).padStart(2,"0"),i=String(s.getDate()).padStart(2,"0"),n=String(s.getHours()).padStart(2,"0"),a=String(s.getMinutes()).padStart(2,"0"),o=String(s.getSeconds()).padStart(2,"0");return`${e}-${r}-${i} ${n}:${a}:${o}`}var Q=class extends Date{toString(){return q(this)}};var X={"01":"Nepal Bank Ltd","02":"Rastriya Banijya Bank","03":"Agricultural Development Bank","04":"Standard Chartered Bank Nepal","09":"Himalayan Bank",19:"Siddhartha Bank",21:"Nabil Bank",24:"Nepal SBI Bank",25:"Machhapuchchhre Bank",29:"Nepal Investment Mega Bank",32:"Kumari Bank",33:"Laxmi Sunrise Bank",34:"Citizens Bank International",35:"Prabhu Bank",36:"NIC Asia Bank",37:"Sanima Bank",38:"Global IME Bank",39:"Prime Commercial Bank",40:"NMB Bank"},U=Object.entries(X).map(([s,t])=>({code:s,name:t}));var z=U[0],H={api:"https://192.168.1.150:9200",bankName:z.name,bankCode:z.code,expiryDateLimit:5,retryLimit:3};var d=class s{_mapper;getMapper(){return this._mapper}setPropertyValue(t,e){let r=this;if(Object.hasOwn(r,t)){let i="set"+t.charAt(0).toUpperCase()+t.slice(1);typeof r[i]=="function"?r[i](e):r[t]=e}}copy(){let t=new this.constructor;return t.fill(s.create(t.constructor,this.toJson())),t}fill(t){for(let e in t)Object.hasOwn(this,e)&&this.setPropertyValue(e,t[e])}toJson(){let t={};for(let e in this){if(this.constructor.__ignoredProperties&&this.constructor.__ignoredProperties.indexOf(e)>-1)continue;let r="get"+e.charAt(0).toUpperCase()+e.slice(1);if(typeof this[e]!="function"&&e[0]!=="_")if(this._mapper){let i=this._mapper.getApiKey(e);i&&(t[i]=this[e],typeof this[r]=="function"&&(t[i]=this[r]()))}else t[e]=this[e],typeof this[r]=="function"&&(t[e]=this[r]())}return t}static create(t,e){let r=new t;for(let i in e){let n=r.getMapper().getModelKey(i),a=r.getMapper().getApiKey(n);if(e.hasOwnProperty(a)){let o="set"+n.charAt(0).toUpperCase()+n.slice(1);typeof r[o]=="function"?r[o](e[i]):r[n]=e[i],r.setPropertyValue(n,e[i])}}return r}static createFromList(t,e){return e.map(r=>s.create(t,r))}};var _=class{constructor(t){this.entity=t;this._mapper=this.entity.getMapper?.()}_selection="*";_filters={};_orFilters={};_orderBy={};_updateData={};_insertData={};_queryType="SELECT";_mapper;_limit="";_aggregates=[];mapKey(t){return this._mapper?.getApiKey?.(t)??t}aggregate(t){this._aggregates=[];for(let[e,r]of Object.entries(t)){let i=e.toUpperCase();if(!["COUNT","SUM","AVG","MIN","MAX"].includes(i))throw new Error(`Unsupported aggregate function: ${e}`);let n,a;if(typeof r=="string")n=this.mapKey(r),a=`${e}_${r}`;else if(Array.isArray(r)&&r.length===2)n=this.mapKey(r[0]),a=r[1];else throw new Error(`Invalid aggregate value for ${e}`);this._aggregates.push(`${i}(${n}) AS ${a}`)}return this._queryType="SELECT",this}select(t="*"){return this._selection=t==="*"?"*":t.map(e=>this.mapKey(e)),this._queryType="SELECT",this}where(t){let e=this.mapFilters(t);for(let r in e)this._filters[r]||(this._filters[r]=[]),this._filters[r].push(...e[r]);return this}orWhere(t){let e=this.mapFilters(t);for(let r in e)this._orFilters[r]||(this._orFilters[r]=[]),this._orFilters[r].push(...e[r]);return this}order(t){let e={};for(let[r,i]of Object.entries(t))if(i==="ASC"||i==="DESC")e[this.mapKey(r)]=i;else throw new Error(`Invalid order direction for key "${r}": ${i}`);return this._orderBy=f(f({},this._orderBy),e),this}update(t){this._queryType="UPDATE",this._updateData=t.toJson();let e=this.entity.constructor.__primaryKey,r=this.entity.constructor.__modelKey;return delete this._updateData[r],this.where({[e]:$(t[r])}),this}delete(t){if(this._queryType="DELETE",t){let e=this.entity.constructor.__primaryKey,r=this.entity.constructor.__modelKey;this.where({[e]:$(t[r])})}return this}insert(t){return this._queryType="INSERT",this._insertData=t.toJson(),this}limit(t,e){return this._limit=`LIMIT ${t}`,e&&(this._limit+=`, ${e}`),this}build(){let t=this.getEntityName(),e="";switch(this._queryType){case"SELECT":{let r=this._aggregates.length>0?this._aggregates.join(", "):this._selection==="*"?"*":this._selection.join(", "),i=this.buildWhereClause(),n=Object.entries(this._orderBy).map(([a,o])=>`${a} ${o}`).join(", ");e=`SELECT ${r} FROM ${t}${i}${n?` ORDER BY ${n}`:""}`;break}case"UPDATE":{let r=Object.entries(this._updateData).map(([i,n])=>`${this.mapKey(i)} = '${n}'`);e=`UPDATE ${t} SET ${r.join(", ")}${this.buildWhereClause()}`;break}case"DELETE":e=`DELETE FROM ${t}${this.buildWhereClause()}`;break;case"INSERT":{let r=Object.keys(this._insertData).map(n=>this.mapKey(n)),i=Object.values(this._insertData).map(n=>`'${n}'`);e=`INSERT INTO ${t} (${r.join(", ")}) VALUES (${i.join(", ")})`;break}default:throw new Error("Invalid query type")}return this._limit&&(e=`${e} ${this._limit}`),e}buildParameterized(){let t=[],e=this.getEntityName(),r="",i=[];switch(this._queryType){case"SELECT":{let n=this._aggregates.length>0?this._aggregates.join(", "):this._selection==="*"?"*":this._selection.join(", "),a=this.buildWhereClauseParameterized(t),o=Object.entries(this._orderBy).map(([l,c])=>`${l} ${c}`).join(", ");r=`SELECT ${n} FROM ${e}${a}${o?` ORDER BY ${o}`:""}`;break}case"UPDATE":{let n=Object.entries(this._updateData).map(([o,l])=>(t.push(l),`${this.mapKey(o)} = ?`)),a=this.buildWhereClauseParameterized(t);r=`UPDATE ${e} SET ${n.join(", ")}${a}`;break}case"DELETE":{let n=this.buildWhereClauseParameterized(t);r=`DELETE FROM ${e}${n}`;break}case"INSERT":{let n=Object.keys(this._insertData).map(o=>this.mapKey(o)),a=n.map(()=>"?");Object.values(this._insertData).forEach(o=>t.push(o)),r=`INSERT INTO ${e} (${n.join(", ")}) VALUES (${a.join(", ")})`;break}default:throw new Error("Invalid query type")}if(this._limit){let n=this._limit.match(/LIMIT (\d+)(?:, *(\d+))?/);if(n){let[,a,o]=n;r+=" LIMIT ?,?",i.push(Number(a)),o!==void 0?i.push(Number(o)):(i=[Number(a)],r=r.replace("?,?","?"))}}return[r,[...t,...i]]}mapFilters(t){let e=this.entity.getSoftDelete();e&&(t=f(f({},t),e));let r={};for(let[i,n]of Object.entries(t)){let a=this.mapKey(i),o=typeof n=="object"&&n!==null&&"operator"in n?n:{operator:"=",value:n};typeof o.value>"u"||o.value===null||(r[a]||(r[a]=[]),r[a].push(o))}return r}buildWhereClause(){let t=(a,o,l)=>{switch(o){case"IN":case"NOT IN":return!Array.isArray(l)||l.length===0?"":`${a} ${o} (${l.map(c=>`'${c}'`).join(", ")})`;case"IS NULL":case"IS NOT NULL":return`${a} ${o}`;default:return`${a} ${o} '${l}'`}},e=[];for(let[a,o]of Object.entries(this._filters))for(let l of o){let c=t(a,l.operator,l.value);c&&e.push(c)}let r=[];for(let[a,o]of Object.entries(this._orFilters))for(let l of o){let c=t(a,l.operator,l.value);c&&r.push(c)}if(!e.length&&!r.length)return"";let i=e.join(" AND "),n=r.join(" OR ");return` WHERE ${[i,n].filter(Boolean).join(" OR ")}`}buildWhereClauseParameterized(t){let e=(o,l,c)=>{switch(l){case"IN":case"NOT IN":if(!Array.isArray(c)||c.length===0)return"";c.forEach(J=>t.push(J));let p=c.map(()=>"?").join(", ");return`${o} ${l} (${p})`;case"IS NULL":case"IS NOT NULL":return`${o} ${l}`;default:return t.push(c),`${o} ${l} ?`}},r=[];for(let[o,l]of Object.entries(this._filters))for(let c of l){let p=e(o,c.operator,c.value);p&&r.push(p)}let i=[];for(let[o,l]of Object.entries(this._orFilters))for(let c of l){let p=e(o,c.operator,c.value);p&&i.push(p)}if(!r.length&&!i.length)return"";let n=r.join(" AND "),a=i.join(" OR ");return` WHERE ${[n,a].filter(Boolean).join(" OR ")}`}getEntityName(){let t=this.entity.constructor.__tableName;if(!t)throw new Error(`Table name not found for entity ${this.entity.constructor.name}. Did you forget to add @Table()?`);return t}};var V=class{constructor(t,e){this.http=t;this.entityClass=e}entityClass;url(){return H.api}createBody(t){let e=[];for(let i=0;i<t[1].length;i++){let n="string";switch(typeof t[1][i]){case"number":n="int";break;case"string":n="string";break;case"boolean":n="int";break;default:n="string"}e.push({type:n,value:`${t[1][i]}`})}return{sql:t[0],params:e,term_ip:"192.168.1.11",service:""}}getQueryBuilder(){return new _(new this.entityClass)}_getOrPaginate(t,e,r,i){let n=this.getQueryBuilder();t&&t.forEach(o=>{for(let l in o)if(Object.prototype.hasOwnProperty.call(o,l)){let c=o[l];c!=null&&n.where({[l]:c})}}),Number.isInteger(r)&&r!==null&&r!==void 0&&(i&&(r=r*i),n.limit(r,i)),e&&n.order(e);let a=this.createBody(n.buildParameterized());return this.http.post(this.url(),a).then(o=>{if(!Array.isArray(o))throw new Error("Invalid response from Service.");return d.createFromList(this.entityClass,o)})}find(t){let e=this.getQueryBuilder(),r=new this.entityClass().getPrimaryKeyName();e.where({[r]:t}).limit(1);let i=this.createBody(e.buildParameterized());return this.http.post(this.url(),i).then(n=>{if(!Array.isArray(n))throw new Error("Invalid response from Service.");return d.create(this.entityClass,n[0])})}get(t,e){return this._getOrPaginate(t,e)}paginate(t,e,r=1,i=100){return this._getOrPaginate(t,e,r,i)}create(t){let e=this.getQueryBuilder().insert(t).buildParameterized();return this.http.post(this.url(),this.createBody(e)).then(r=>d.create(this.entityClass,r))}update(t){let e=this.getQueryBuilder().update(t).buildParameterized();return this.http.post(this.url(),this.createBody(e)).then(r=>d.create(this.entityClass,r))}delete(t){let e=this.getQueryBuilder().delete(t).buildParameterized();return this.http.post(this.url(),this.createBody(e))}};var I=class{constructor(t,e=40){this.size=e;this.container=t||document.body}spinnerElement=null;container;show(){if(this.spinnerElement)return;let t=document.createElement("div");t.style.position=this.container===document.body?"fixed":"absolute",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="rgba(255, 255, 255, 0.6)",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.zIndex="9999",t.style.pointerEvents="auto";let e=document.createElement("div");e.style.width=`${this.size}px`,e.style.height=`${this.size}px`,e.style.border="4px solid #ccc",e.style.borderTop="4px solid #333",e.style.borderRadius="50%",e.style.animation="spin 1s linear infinite",t.appendChild(e),this.container.style.position=this.container===document.body?this.container.style.position:"relative",this.container.appendChild(t),this.spinnerElement=t;let r=document.createElement("style");r.innerHTML=`
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    `,document.head.appendChild(r)}hide(){this.spinnerElement&&(this.container.removeChild(this.spinnerElement),this.spinnerElement=null)}};function Z(s,t){if(s&1){let e=N();y(0,"button",7),b("click",function(){C(e);let i=S();return k(i.onCancel())}),m()}}function tt(s,t){if(s&1){let e=N();y(0,"button",8),b("click",function(){C(e);let i=S();return k(i.onCancel())}),g(1,"Cancel"),m()}}var x=class s{dialogRef;type="info";title="Alert";message="";showCancel=!0;onOk(){this.dialogRef.close(!0)}onCancel(){this.dialogRef.close(!1)}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=F({type:s,selectors:[["app-alert-dialog"]],inputs:{type:"type",title:"title",message:"message",showCancel:"showCancel"},decls:12,vars:13,consts:[[1,"modal-title"],["type","button","class","btn-close","aria-label","Close",3,"click",4,"ngIf"],[1,"modal-body"],[1,"mb-0"],[1,"modal-footer"],["type","button","class","btn btn-secondary",3,"click",4,"ngIf"],["type","button",3,"click"],["type","button","aria-label","Close",1,"btn-close",3,"click"],["type","button",1,"btn","btn-secondary",3,"click"]],template:function(e,r){e&1&&(y(0,"div")(1,"div")(2,"h5",0),g(3),m(),P(4,Z,1,0,"button",1),m(),y(5,"div",2)(6,"p",3),g(7),m()(),y(8,"div",4),P(9,tt,2,0,"button",5),y(10,"button",6),b("click",function(){return r.onOk()}),g(11,"OK"),m()()()),e&2&&(E("modal-content border border-2 border-",r.type,""),u(),E("modal-header bg-",r.type," text-white"),u(2),w(r.title),u(),D("ngIf",r.showCancel),u(3),w(r.message),u(2),D("ngIf",r.showCancel),u(),E("btn btn-",r.type,""))},dependencies:[L],encapsulation:2})};var v=class s{constructor(t){this.dialog=t}show(t,e,r="info",i=!0){return h(this,null,function*(){let n=yield this.dialog.open(x,{title:t,message:e,type:r,showCancel:i});return new Promise(a=>{n.closed.subscribe(o=>{a(o)})})})}static \u0275fac=function(e){return new(e||s)(A(T))};static \u0275prov=O({token:s,factory:s.\u0275fac,providedIn:"root"})};var G=class s{models=[];filteredModels=[];paginatedModels=[];modelFilters={};modelService;dialog;alert;toast;router;paginationOption={currentPage:1,pageSize:25,startPage:1,total:0};constructor(t){this.dialog=t.get(T),this.alert=t.get(v),this.toast=t.get(K),this.router=t.get(j)}getFilterParams(){return[]}loadModels(){let t=new I;return t.show(),this.modelService.get(this.getFilterParams()).then(e=>(t.hide(),this.models=e,this.models)).catch(e=>[]).finally(()=>t.hide())}ngOnInit(){}addModel(){return h(this,null,function*(){yield this.openDialog()})}updateModel(e){return h(this,arguments,function*({model:t}){this.openDialog(t)})}deleteModel(e){return h(this,arguments,function*({model:t}){(yield this.alert.show("Delete Item","Are you sure you want to delete this item?","danger"))&&this.modelService.delete(t).then(i=>{for(let n=0;n<this.models.length;n++)if(this.models[n][this.models[n].getPrimaryKeyName()]===t[t.getPrimaryKeyName()]){this.models.splice(n,1);break}this.toast.success("Item deleted successfully."),this.applyFilters()})})}onFilterChange(t){this.modelFilters=t,this.applyFilters()}static \u0275fac=function(e){return new(e||s)(M(B))};static \u0275dir=R({type:s})};var Y=class{constructor(t={}){this.config=t}getModelKey(t){let e=Object.entries(this.config).find(([r,i])=>i===t);return e?e[0]:t.replace(/_([a-z])/g,(r,i)=>i.toUpperCase())}getApiKey(t){return this.config[t]?this.config[t]:t.replace(/([A-Z])/g,"_$1").toLowerCase()}};function Lt(s){return function(t){t.__tableName=s}}function jt(s){return function(t,e){t.constructor.__primaryKey=s||e,t.constructor.__modelKey=e}}function Kt(){return function(s,t){s.constructor.__ignoredProperties||(s.constructor.__ignoredProperties=[]),s.constructor.__ignoredProperties.push(t)}}export{q as a,d as b,Y as c,Lt as d,jt as e,Kt as f,$ as g,et as h,rt as i,it as j,nt as k,st as l,Q as m,X as n,U as o,H as p,V as q,I as r,G as s};
