import{a as Q,c as B}from"./chunk-7VL2AYZC.js";import{a as c}from"./chunk-ZGLSKZPV.js";import{$ as K,Cb as F,Ua as I,Ub as _,Vb as j,W as O,c as P,eb as x,fb as A,gb as i,ib as w,jb as q,qb as p,u as h,v as R,vb as M,wb as E,x as f,xb as L,yb as S}from"./chunk-Y6X5IISN.js";import{g as D,h as N}from"./chunk-ENRHZQ2S.js";var z=(r=>(r[r.Created=0]="Created",r[r.Manufacturing=1]="Manufacturing",r[r.Delivered=2]="Delivered",r[r.Assigned=3]="Assigned",r[r.Void=4]="Void",r[r.Unknown=-1]="Unknown",r))(z||{}),U={otpType:"otptype",bankCode:"bank_cd",branchCode:"branch_cd",sequenceNumber:"seqno",otpKey:"otp_key",createdDate:"create_date",status:"status",manufacturingDispatchDate:"out_date",productDeliveryDate:"in_date",keyAssignedDate:"register_date"},d=class extends A{otpType=2;bankCode="";branchCode="";sequenceNumber=0;otpKey="";createdDate=new c;status=0;manufacturingDispatchDate;productDeliveryDate;keyAssignedDate;constructor(){super(),this._mapper=new E(U)}getSoftDelete(){}getPrimaryKeyName(){return"sequenceNumber"}setCreatedDate(e){this.createdDate=new c(e)}setStatus(e){this.status=Number(e)}setOtpType(e){this.otpType=Number(e)}setSequenceNumber(e){this.sequenceNumber=Number(e)}};D([S("seqno")],d.prototype,"sequenceNumber",2),d=D([L("keymst")],d);var g=class a extends M{constructor(e){super(e,d)}getName(){return"serialkey"}generateKey(e){return this.http.post(this.url(),e,{headers:{service:"OTPSVR"}}).then(t=>{if(t?.result.toLocaleLowerCase()==="error")throw console.error(t),t})}getCount(e){let o=this.processQueryParams(this.getQueryBuilder(),e).aggregate({count:"sequenceNumber"}).buildParameterized();return this.http.post(this.url(),p(o)).then(s=>Number(s[0].count_sequenceNumber)||0)}getLastMaxCount(e,t,o){let n=this.getQueryBuilder().aggregate({max:"sequenceNumber"}).where("bankCode",i(e)).where("branchCode",i(t)).where("otpType",i(o)).select().buildParameterized();return this.http.post(this.url(),p(n)).then(r=>Number(r[0].max_sequenceNumber)||0)}getAssignableKeys(e,t,o,s){let n=[{status:i(2)},{bankCode:i(e)},{branchCode:i(t)}];return o&&n.push({otpType:i(o)}),s&&n.push({sequenceNumber:i(s)}),this.get(n).then(r=>r.sort((u,l)=>u.sequenceNumber-l.sequenceNumber))}getFreshKeys(e,t){return this.get([{status:i(2)},{bankCode:i(e)},{branchCode:i(t)}]).then(o=>o.sort((s,n)=>s.sequenceNumber-n.sequenceNumber))}getAssignedKeys(e,t,o){return o||(o=[]),this.get([{status:i(3),bankCode:i(e),branchCode:i(t)}]).then(s=>s.sort((n,r)=>n.sequenceNumber-r.sequenceNumber))}sendForManufacturing(e,t,o,s){let r=this.getQueryBuilder().where("sequenceNumber",w(o)).where("sequenceNumber",q(s)).where("bankCode",i(e)).where("branchCode",i(t)).update({status:1,manufacturingDispatchDate:new c},!1).buildParameterized();return this.http.post(this.url(),p(r)).then()}markAsDelivered(e,t,o,s){let r=this.getQueryBuilder().where("sequenceNumber",w(o)).where("sequenceNumber",q(s)).where("bankCode",i(e)).where("branchCode",i(t)).update({status:2,productDeliveryDate:new c},!1).buildParameterized();return this.http.post(this.url(),p(r)).then()}markAsAssigned(e,t,o){let n=this.getQueryBuilder().where("sequenceNumber",i(o)).where("bankCode",i(e)).where("branchCode",i(t)).update({status:3,keyAssignedDate:new c},!1).buildParameterized();return this.http.post(this.url(),p(n)).then()}voidProduct(e,t,o){let n=this.getQueryBuilder().where("sequenceNumber",i(o)).where("bankCode",i(e)).where("branchCode",i(t)).update({status:4},!1).buildParameterized();return this.http.post(this.url(),p(n)).then()}static \u0275fac=function(t){return new(t||a)(f(F))};static \u0275prov=h({token:a,factory:a.\u0275fac})};var y=class{constructor(e){this.closeFn=e}_closed=new P;closed=this._closed.asObservable();close(e){this._closed.next(e),this._closed.complete(),this.closeFn(e)}};var v=class a{constructor(e){this.appRef=e}getOptions(e){return{clickToClose:e?.clickToClose??!0,className:e?.className??"",width:e?.width??"auto"}}open(e,t,o,s=!0){let{clickToClose:n,className:r}=this.getOptions(o),u=document.createElement("div"),l=document.createElement("div");l.classList.add("modal-dialog"),r&&u.classList.add(...r.split(" ")),o?.width&&(l.style.width=o.width),u.appendChild(l),u.classList.add("dialog-wrapper","tsway-modal","fade-in");let T=()=>N(this,null,function*(){u.classList.remove("fade-in"),yield this.delay(50),u.classList.add("fade-out"),yield this.delay(300),this.appRef.detachView(b.hostView),b.destroy();try{u&&document.body.removeChild(u)}catch{}document.removeEventListener("keyup",C)}),C=m=>{m.key==="Escape"&&(T(),document.removeEventListener("keyup",C))};if(document.addEventListener("keyup",C),s){let m=document.createElement("div");m.classList.add("dialog-overlay","position-fixed","top-0","start-0","w-100","h-100","bg-dark","opacity-50"),u.appendChild(m),n&&u.addEventListener("click",H=>{H.target===m&&T()})}document.body.appendChild(u);let b=this.appRef.bootstrap(e,l);if(t)for(let m in t)b.setInput(m,t[m]);let k=new y(T);return b.instance.dialogRef=k,Promise.resolve(k)}delay(e){return new Promise(t=>setTimeout(t,e))}static \u0275fac=function(t){return new(t||a)(f(K))};static \u0275prov=h({token:a,factory:a.\u0275fac})};var G=class a{static \u0275fac=function(t){return new(t||a)};static \u0275mod=O({type:a});static \u0275inj=R({providers:[v,Q,g],imports:[j,I,x,B,_]})};export{v as a,z as b,g as c,G as d};
