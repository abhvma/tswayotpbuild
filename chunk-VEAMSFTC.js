import{a as h}from"./chunk-DPED3STO.js";import{a as Y,b as Z}from"./chunk-DRM7ZKYO.js";import{b as W}from"./chunk-6WKN5HJ4.js";import"./chunk-HVPVQXOI.js";import{c as X}from"./chunk-QLKXYMQI.js";import{a as Q,b as y,c as B,d as $,e as z,f as H,g as J,m as K,n as U}from"./chunk-PV2HAKDE.js";import{b as I}from"./chunk-44S3GGHA.js";import{A as _,B as x,D as w,Da as k,E as u,O as a,Pa as O,Qa as j,Ra as R,S as T,V as p,W as E,Z as N,_ as d,bb as V,ca as m,fb as G,ga as r,gb as A,ha as o,ia as c,ja as M,ka as q,la as D,ma as g,na as b,u as S,ua as P,va as l,wa as f}from"./chunk-24GG73RQ.js";import"./chunk-FK6H3RFT.js";import"./chunk-WR2VUDLS.js";function ie(n,t){if(n&1&&(r(0,"th",3),l(1),o()),n&2){let e=t.$implicit;m("width",e.width),a(),f(e.label)}}function re(n,t){if(n&1&&(r(0,"tr")(1,"td"),l(2),o(),r(3,"td"),l(4),o(),r(5,"td"),l(6),o(),r(7,"td"),l(8),o()()),n&2){let e=t.$implicit;a(2),f(e.traceSequence),a(2),f(e.terminalIp),a(2),f(e.sqlText),a(2),f(e.traceDate)}}var v=class n{models=[];editClick=new u;deleteClick=new u;columns=[{label:"Trace Sequence",width:"10%"},{label:"Terminal IP",width:"20%"},{label:"SQL Text",width:"60%"},{label:"Trace Date",width:"20%"}];static \u0275fac=function(e){return new(e||n)};static \u0275cmp=p({type:n,selectors:[["app-transaction-log-table"]],inputs:{models:"models"},outputs:{editClick:"editClick",deleteClick:"deleteClick"},standalone:!1,decls:6,vars:2,consts:[[1,"tsway-datatable","striped"],[3,"width",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[3,"width"]],template:function(e,i){e&1&&(r(0,"table",0)(1,"thead")(2,"tr"),d(3,ie,2,2,"th",1),o()(),r(4,"tbody"),d(5,re,9,4,"tr",2),o()()),e&2&&(a(3),m("ngForOf",i.columns),a(2),m("ngForOf",i.models))},dependencies:[O],encapsulation:2})};var C=class n{constructor(t){this.fb=t;this.filterForm=this.fb.group({traceDateTo:["",y.required],traceDateFrom:["",y.required],terminalIp:""})}filterChange=new u;filterForm;subscriptions=[];emitFilter(){this.filterChange.emit(this.filterForm.value)}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe())}static \u0275fac=function(e){return new(e||n)(T(K))};static \u0275cmp=p({type:n,selectors:[["app-transaction-log-filterbar"]],outputs:{filterChange:"filterChange"},standalone:!1,decls:14,vars:2,consts:[[1,"filterbar","mb-3"],[1,"row","g-3","align-items-end","filter-form-container",3,"formGroup"],[1,"col-md-2"],["for","traceDateFrom",1,"form-label","small","mb-1"],["type","date","id","traceDateFrom","formControlName","traceDateFrom",1,"form-control"],["for","traceDateTo",1,"form-label","small","mb-1"],["type","date","id","traceDateTo","formControlName","traceDateTo",1,"form-control"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"bi","bi-search","me-1"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"form",1)(2,"div",2)(3,"label",3),l(4,"Trace From"),o(),c(5,"input",4),o(),r(6,"div",2)(7,"label",5),l(8,"Trace To"),o(),c(9,"input",6),o(),r(10,"div",2)(11,"button",7),g("click",function(){return i.emitFilter()}),c(12,"i",8),l(13,"Search "),o()()()()),e&2&&(a(),m("formGroup",i.filterForm),a(10),m("disabled",i.filterForm.invalid))},dependencies:[z,Q,B,$,H,J],encapsulation:2})};function me(n,t){if(n&1){let e=D();r(0,"div",7)(1,"a",8),g("click",function(){_(e);let s=b();return x(s.downloadTable())}),c(2,"i",9),l(3," Download PDF "),o()()}}function ce(n,t){if(n&1&&(M(0),c(1,"app-transaction-log-table",10),q()),n&2){let e=b();a(),m("models",e.models)}}function se(n,t){n&1&&(r(0,"div")(1,"p",3),l(2,"Search for Transaction logs"),o()())}function pe(n,t){n&1&&(r(0,"div")(1,"p",3),l(2,"No transaction log found."),o()())}function de(n,t){if(n&1&&(r(0,"div",11)(1,"div"),c(2,"i",12),d(3,se,3,0,"div",13)(4,pe,3,0,"div",13),o()()),n&2){let e=b();a(3),m("ngIf",!e.hasSearched),a(),m("ngIf",e.hasSearched)}}var F=class n extends W{hasSearched=!1;currentPage=0;itemLimit=100;constructor(t){super(t),this.modelService=t.get(h)}ngOnInit(){}loadModels(){let t=[];return this.modelFilters.traceDateFrom&&t.push({traceDate:G(new I(this.modelFilters.traceDateFrom))}),this.modelFilters.traceDateTo&&t.push({traceDate:A(new I(this.modelFilters.traceDateTo))}),this.modelService.paginate(t,{traceDate:"DESC"},this.currentPage,this.itemLimit).then(e=>(this.models=e,this.hasSearched=!0,this.models)).catch(e=>(this.toast.error("Failed to load transaction logs"),[]))}openDialog(t){throw new Error("Method not implemented.")}applyFilters(){throw new Error("Method not implemented.")}onFilterChange(t){this.modelFilters=t,this.loadModels()}downloadTable(){let t=new Y;t.setFontSize(12);let e=this.models.map(i=>({traceSequence:i.traceSequence,terminalIp:i.terminalIp,sqlText:i.sqlText,traceDate:i.traceDate.toLocaleString()}));Z(t,{head:[["Trace Sequence","Terminal IP","Sql Text","Trace Date"]],body:e.map(i=>[i.traceSequence,i.terminalIp,i.sqlText,i.traceDate])}),t.save(`transaction-log${new Date().toDateString()}.pdf`)}static \u0275fac=function(e){return new(e||n)(T(w))};static \u0275cmp=p({type:n,selectors:[["app-transaction-log"]],standalone:!1,features:[N],decls:9,vars:3,consts:[["noData",""],[1,"container-fluid","py-4","d-flex","flex-column","vh-100"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"mb-0"],[3,"filterChange"],["class","d-flex justify-content-end mb-2",4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"d-flex","justify-content-end","mb-2"],["role","button",1,"btn-link","text-muted","small","text-decoration-none",3,"click"],[1,"bi","bi-file-earmark-pdf","me-1"],[3,"models"],[1,"d-flex","justify-content-center","align-items-center","h-100","text-muted","text-center","px-4"],[1,"bi","bi-search","display-6","d-block","mb-2"],[4,"ngIf"]],template:function(e,i){if(e&1){let s=D();r(0,"div",1)(1,"div",2)(2,"h2",3),l(3,"Transaction Logs"),o()(),r(4,"app-transaction-log-filterbar",4),g("filterChange",function(ne){return _(s),x(i.onFilterChange(ne))}),o(),d(5,me,4,0,"div",5)(6,ce,2,1,"ng-container",6)(7,de,5,2,"ng-template",null,0,k),o()}if(e&2){let s=P(8);a(5),m("ngIf",i.models.length>0),a(),m("ngIf",i.models.length>0)("ngIfElse",s)}},dependencies:[j,v,C],encapsulation:2})};var fe=[{path:"",component:F}],te=class n{static \u0275fac=function(e){return new(e||n)};static \u0275mod=E({type:n});static \u0275inj=S({providers:[h],imports:[X,R,V.forChild(fe),U]})};export{te as TransactionLogModule};
