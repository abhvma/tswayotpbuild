import{a as j,c as B}from"./chunk-7VL2AYZC.js";import{a as m}from"./chunk-ZGLSKZPV.js";import{$ as K,Cb as L,Ua as x,Ub as F,Vb as Q,W as O,c as P,eb as A,fb as E,gb as r,ib as C,jb as q,qb as p,u as b,v as R,vb as I,wb as S,x as g,xb as M,yb as _}from"./chunk-Y6X5IISN.js";import{g as T,h as k}from"./chunk-ENRHZQ2S.js";var z=(i=>(i[i.Created=0]="Created",i[i.Registered=1]="Registered",i[i.Enrolled=2]="Enrolled",i[i.Active=3]="Active",i[i.Revoked=4]="Revoked",i[i.Unknown=-1]="Unknown",i))(z||{}),U={otpType:"otptype",bankCode:"bank_cd",branchCode:"branch_cd",sequenceNumber:"seqno",otpKey:"otp_key",createdDate:"create_date",status:"status",manufacturingDispatchDate:"out_date",productDeliveryDate:"in_date",keyAssignedDate:"register_date"},d=class extends E{otpType=2;bankCode="";branchCode="";sequenceNumber=0;otpKey="";createdDate=new m;status=0;manufacturingDispatchDate;productDeliveryDate;keyAssignedDate;constructor(){super(),this._mapper=new S(U)}getSoftDelete(){}getPrimaryKeyName(){return"sequenceNumber"}setManufacturingDispatchDate(e){if(!e){this.manufacturingDispatchDate=void 0;return}this.manufacturingDispatchDate=new m(e)}setProductDeliveryDate(e){if(!e){this.productDeliveryDate=void 0;return}this.productDeliveryDate=new m(e)}setKeyAssignedDate(e){if(!e){this.keyAssignedDate=void 0;return}this.keyAssignedDate=new m(e)}setCreatedDate(e){this.createdDate=new m(e)}setStatus(e){this.status=Number(e)}setOtpType(e){this.otpType=Number(e)}setSequenceNumber(e){this.sequenceNumber=Number(e)}};T([_("seqno")],d.prototype,"sequenceNumber",2),d=T([M("keymst")],d);var f=class u extends I{constructor(e){super(e,d)}getName(){return"serialkey"}generateKey(e){return this.http.post(this.url(),e,{headers:{service:"OTPSVR"}}).then(t=>{if(t?.result.toLocaleLowerCase()==="error")throw console.error(t),t})}getCount(e){let s=this.processQueryParams(this.getQueryBuilder(),e).aggregate({count:"sequenceNumber"}).buildParameterized();return this.http.post(this.url(),p(s)).then(n=>Number(n[0].count_sequenceNumber)||0)}getLastMaxCount(e,t,s){let o=this.getQueryBuilder().aggregate({max:"sequenceNumber"}).where("bankCode",r(e)).where("branchCode",r(t)).where("otpType",r(s)).select().buildParameterized();return this.http.post(this.url(),p(o)).then(i=>Number(i[0].max_sequenceNumber)||0)}getAssignableKeys(e,t,s,n){let o=[{status:r(2)},{bankCode:r(e)},{branchCode:r(t)}];return s&&o.push({otpType:r(s)}),n&&o.push({sequenceNumber:r(n)}),this.get(o).then(i=>i.sort((a,l)=>a.sequenceNumber-l.sequenceNumber))}getFreshKeys(e,t){return this.get([{status:r(2)},{bankCode:r(e)},{branchCode:r(t)}]).then(s=>s.sort((n,o)=>n.sequenceNumber-o.sequenceNumber))}getAssignedKeys(e,t,s){return s||(s=[]),this.get([{status:r(3),bankCode:r(e),branchCode:r(t)}]).then(n=>n.sort((o,i)=>o.sequenceNumber-i.sequenceNumber))}getRangesForStatus(e,t,s,n){let i=this.getQueryBuilder().where("bankCode",r(e)).where("branchCode",r(t)).where("status",r(n)).where("otpType",r(s)).aggregate({min:"sequenceNumber",max:"sequenceNumber"}).select().buildParameterized();return this.http.post(this.url(),p(i)).then(a=>a.length>0?isNaN(a[0].min_sequenceNumber)||isNaN(a[0].max_sequenceNumber)?[0,0]:[+a[0].min_sequenceNumber,+a[0].max_sequenceNumber]:[0,0])}sendForManufacturing(e,t,s,n){let i=this.getQueryBuilder().where("sequenceNumber",C(s)).where("sequenceNumber",q(n)).where("bankCode",r(e)).where("branchCode",r(t)).where("status",r(0)).update({status:1,manufacturingDispatchDate:new m},!1).buildParameterized();return this.http.post(this.url(),p(i)).then()}markAsDelivered(e,t,s,n){let i=this.getQueryBuilder().where("sequenceNumber",C(s)).where("sequenceNumber",q(n)).where("bankCode",r(e)).where("branchCode",r(t)).where("status",r(1)).update({status:2,productDeliveryDate:new m},!1).buildParameterized();return this.http.post(this.url(),p(i)).then()}markAsAssigned(e,t,s){let o=this.getQueryBuilder().where("sequenceNumber",r(s)).where("bankCode",r(e)).where("branchCode",r(t)).where("status",r(2)).update({status:3,keyAssignedDate:new m},!1).buildParameterized();return this.http.post(this.url(),p(o)).then()}voidProduct(e,t,s){let o=this.getQueryBuilder().where("sequenceNumber",r(s)).where("bankCode",r(e)).where("branchCode",r(t)).where("status",r(3)).update({status:4},!1).buildParameterized();return this.http.post(this.url(),p(o)).then()}static \u0275fac=function(t){return new(t||u)(g(L))};static \u0275prov=b({token:u,factory:u.\u0275fac})};var y=class{constructor(e){this.closeFn=e}_closed=new P;closed=this._closed.asObservable();close(e){this._closed.next(e),this._closed.complete(),this.closeFn(e)}};var v=class u{constructor(e){this.appRef=e}getOptions(e){return{clickToClose:e?.clickToClose??!0,className:e?.className??"",width:e?.width??"auto"}}open(e,t,s,n=!0){let{clickToClose:o,className:i}=this.getOptions(s),a=document.createElement("div"),l=document.createElement("div");l.classList.add("modal-dialog"),i&&a.classList.add(...i.split(" ")),s?.width&&(l.style.width=s.width),a.appendChild(l),a.classList.add("dialog-wrapper","tsway-modal","fade-in");let D=()=>k(this,null,function*(){a.classList.remove("fade-in"),yield this.delay(50),a.classList.add("fade-out"),yield this.delay(300),this.appRef.detachView(h.hostView),h.destroy();try{a&&document.body.removeChild(a)}catch{}document.removeEventListener("keyup",w)}),w=c=>{c.key==="Escape"&&(D(),document.removeEventListener("keyup",w))};if(document.addEventListener("keyup",w),n){let c=document.createElement("div");c.classList.add("dialog-overlay","position-fixed","top-0","start-0","w-100","h-100","bg-dark","opacity-50"),a.appendChild(c),o&&a.addEventListener("click",V=>{V.target===c&&D()})}document.body.appendChild(a);let h=this.appRef.bootstrap(e,l);if(t)for(let c in t)h.setInput(c,t[c]);let N=new y(D);return h.instance.dialogRef=N,Promise.resolve(N)}delay(e){return new Promise(t=>setTimeout(t,e))}static \u0275fac=function(t){return new(t||u)(g(K))};static \u0275prov=b({token:u,factory:u.\u0275fac})};var H=class u{static \u0275fac=function(t){return new(t||u)};static \u0275mod=O({type:u});static \u0275inj=R({providers:[v,j,f],imports:[Q,x,A,B,F]})};export{v as a,z as b,f as c,H as d};
